// Worker Bundle - Built 2025-11-04T05:40:12.143Z
// Version: 0.0.0
var Zi=Object.defineProperty;var st=(t,e)=>{for(var r in e)Zi(t,r,{get:e[r],enumerable:!0})};var or=(t,e,r)=>(o,s)=>{let i=-1;return a(0);async function a(l){if(l<=i)throw new Error("next() called multiple times");i=l;let c,d=!1,u;if(t[l]?(u=t[l][0][0],o.req.routeIndex=l):u=l===t.length&&s||void 0,u)try{c=await u(o,()=>a(l+1))}catch(h){if(h instanceof Error&&e)o.error=h,c=await e(h,o),d=!0;else throw h}else o.finalized===!1&&r&&(c=await r(o));return c&&(o.finalized===!1||d)&&(o.res=c),o}};var to=Symbol();var ro=async(t,e=Object.create(null))=>{let{all:r=!1,dot:o=!1}=e,i=(t instanceof nt?t.raw.headers:t.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?ea(t,{all:r,dot:o}):{}};async function ea(t,e){let r=await t.formData();return r?ta(r,e):{}}function ta(t,e){let r=Object.create(null);return t.forEach((o,s)=>{e.all||s.endsWith("[]")?ra(r,s,o):r[s]=o}),e.dot&&Object.entries(r).forEach(([o,s])=>{o.includes(".")&&(oa(r,o,s),delete r[o])}),r}var ra=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:e.endsWith("[]")?t[e]=[r]:t[e]=r},oa=(t,e,r)=>{let o=t,s=e.split(".");s.forEach((i,a)=>{a===s.length-1?o[i]=r:((!o[i]||typeof o[i]!="object"||Array.isArray(o[i])||o[i]instanceof File)&&(o[i]=Object.create(null)),o=o[i])})};var nr=t=>{let e=t.split("/");return e[0]===""&&e.shift(),e},oo=t=>{let{groups:e,path:r}=sa(t),o=nr(r);return na(o,e)},sa=t=>{let e=[];return t=t.replace(/\{[^}]+\}/g,(r,o)=>{let s=`@${o}`;return e.push([s,r]),s}),{groups:e,path:t}},na=(t,e)=>{for(let r=e.length-1;r>=0;r--){let[o]=e[r];for(let s=t.length-1;s>=0;s--)if(t[s].includes(o)){t[s]=t[s].replace(o,e[r][1]);break}}return t},it={},so=(t,e)=>{if(t==="*")return"*";let r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let o=`${t}#${e}`;return it[o]||(r[2]?it[o]=e&&e[0]!==":"&&e[0]!=="*"?[o,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:it[o]=[t,r[1],!0]),it[o]}return null},at=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},ia=t=>at(t,decodeURI),ir=t=>{let e=t.url,r=e.indexOf("/",e.indexOf(":")+4),o=r;for(;o<e.length;o++){let s=e.charCodeAt(o);if(s===37){let i=e.indexOf("?",o),a=e.slice(r,i===-1?void 0:i);return ia(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(s===63)break}return e.slice(r,o)};var no=t=>{let e=ir(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},Z=(t,e,...r)=>(r.length&&(e=Z(e,...r)),`${t?.[0]==="/"?"":"/"}${t}${e==="/"?"":`${t?.at(-1)==="/"?"":"/"}${e?.[0]==="/"?e.slice(1):e}`}`),ct=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;let e=t.split("/"),r=[],o="";return e.forEach(s=>{if(s!==""&&!/\:/.test(s))o+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&o===""?r.push("/"):r.push(o);let i=s.replace("?","");o+="/"+i,r.push(o)}else o+="/"+s}),r.filter((s,i,a)=>a.indexOf(s)===i)},sr=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?at(t,ar):t):t,io=(t,e,r)=>{let o;if(!r&&e&&!/[%+]/.test(e)){let a=t.indexOf(`?${e}`,8);for(a===-1&&(a=t.indexOf(`&${e}`,8));a!==-1;){let l=t.charCodeAt(a+e.length+1);if(l===61){let c=a+e.length+2,d=t.indexOf("&",c);return sr(t.slice(c,d===-1?void 0:d))}else if(l==38||isNaN(l))return"";a=t.indexOf(`&${e}`,a+1)}if(o=/[%+]/.test(t),!o)return}let s={};o??=/[%+]/.test(t);let i=t.indexOf("?",8);for(;i!==-1;){let a=t.indexOf("&",i+1),l=t.indexOf("=",i);l>a&&a!==-1&&(l=-1);let c=t.slice(i+1,l===-1?a===-1?void 0:a:l);if(o&&(c=sr(c)),i=a,c==="")continue;let d;l===-1?d="":(d=t.slice(l+1,a===-1?void 0:a),o&&(d=sr(d))),r?(s[c]&&Array.isArray(s[c])||(s[c]=[]),s[c].push(d)):s[c]??=d}return e?s[e]:s},ao=io,co=(t,e)=>io(t,e,!0),ar=decodeURIComponent;var lo=t=>at(t,ar),nt=class{raw;#t;#e;routeIndex=0;path;bodyCache={};constructor(t,e="/",r=[[]]){this.raw=t,this.path=e,this.#e=r,this.#t={}}param(t){return t?this.#r(t):this.#n()}#r(t){let e=this.#e[0][this.routeIndex][1][t],r=this.#s(e);return r?/\%/.test(r)?lo(r):r:void 0}#n(){let t={},e=Object.keys(this.#e[0][this.routeIndex][1]);for(let r of e){let o=this.#s(this.#e[0][this.routeIndex][1][r]);o&&typeof o=="string"&&(t[r]=/\%/.test(o)?lo(o):o)}return t}#s(t){return this.#e[1]?this.#e[1][t]:t}query(t){return ao(this.url,t)}queries(t){return co(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;let e={};return this.raw.headers.forEach((r,o)=>{e[o]=r}),e}async parseBody(t){return this.bodyCache.parsedBody??=await ro(this,t)}#o=t=>{let{bodyCache:e,raw:r}=this,o=e[t];if(o)return o;let s=Object.keys(e)[0];return s?e[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[t]())):e[t]=r[t]()};json(){return this.#o("text").then(t=>JSON.parse(t))}text(){return this.#o("text")}arrayBuffer(){return this.#o("arrayBuffer")}blob(){return this.#o("blob")}formData(){return this.#o("formData")}addValidatedData(t,e){this.#t[t]=e}valid(t){return this.#t[t]}get url(){return this.raw.url}get method(){return this.raw.method}get[to](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,t]])=>t)}get routePath(){return this.#e[0].map(([[,t]])=>t)[this.routeIndex].path}};var uo={Stringify:1,BeforeStream:2,Stream:3},aa=(t,e)=>{let r=new String(t);return r.isEscaped=!0,r.callbacks=e,r};var cr=async(t,e,r,o,s)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));let i=t.callbacks;if(!i?.length)return Promise.resolve(t);s?s[0]+=t:s=[t];let a=Promise.all(i.map(l=>l({phase:e,buffer:s,context:o}))).then(l=>Promise.all(l.filter(Boolean).map(c=>cr(c,e,!1,o,s))).then(()=>s[0]));return r?aa(await a,i):a};var ca="text/plain; charset=UTF-8",lr=(t,e)=>({"Content-Type":t,...e}),ho=class{#t;#e;env={};#r;finalized=!1;error;#n;#s;#o;#u;#c;#l;#a;#d;#h;constructor(t,e){this.#t=t,e&&(this.#s=e.executionCtx,this.env=e.env,this.#l=e.notFoundHandler,this.#h=e.path,this.#d=e.matchResult)}get req(){return this.#e??=new nt(this.#t,this.#h,this.#d),this.#e}get event(){if(this.#s&&"respondWith"in this.#s)return this.#s;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#s)return this.#s;throw Error("This context has no ExecutionContext")}get res(){return this.#o||=new Response(null,{headers:this.#a??=new Headers})}set res(t){if(this.#o&&t){t=new Response(t.body,t);for(let[e,r]of this.#o.headers.entries())if(e!=="content-type")if(e==="set-cookie"){let o=this.#o.headers.getSetCookie();t.headers.delete("set-cookie");for(let s of o)t.headers.append("set-cookie",s)}else t.headers.set(e,r)}this.#o=t,this.finalized=!0}render=(...t)=>(this.#c??=e=>this.html(e),this.#c(...t));setLayout=t=>this.#u=t;getLayout=()=>this.#u;setRenderer=t=>{this.#c=t};header=(t,e,r)=>{this.finalized&&(this.#o=new Response(this.#o.body,this.#o));let o=this.#o?this.#o.headers:this.#a??=new Headers;e===void 0?o.delete(t):r?.append?o.append(t,e):o.set(t,e)};status=t=>{this.#n=t};set=(t,e)=>{this.#r??=new Map,this.#r.set(t,e)};get=t=>this.#r?this.#r.get(t):void 0;get var(){return this.#r?Object.fromEntries(this.#r):{}}#i(t,e,r){let o=this.#o?new Headers(this.#o.headers):this.#a??new Headers;if(typeof e=="object"&&"headers"in e){let i=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(let[a,l]of i)a.toLowerCase()==="set-cookie"?o.append(a,l):o.set(a,l)}if(r)for(let[i,a]of Object.entries(r))if(typeof a=="string")o.set(i,a);else{o.delete(i);for(let l of a)o.append(i,l)}let s=typeof e=="number"?e:e?.status??this.#n;return new Response(t,{status:s,headers:o})}newResponse=(...t)=>this.#i(...t);body=(t,e,r)=>this.#i(t,e,r);text=(t,e,r)=>!this.#a&&!this.#n&&!e&&!r&&!this.finalized?new Response(t):this.#i(t,e,lr(ca,r));json=(t,e,r)=>this.#i(JSON.stringify(t),e,lr("application/json",r));html=(t,e,r)=>{let o=s=>this.#i(s,e,lr("text/html; charset=UTF-8",r));return typeof t=="object"?cr(t,uo.Stringify,!1,{}).then(o):o(t)};redirect=(t,e)=>{let r=String(t);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,e??302)};notFound=()=>(this.#l??=()=>new Response,this.#l(this))};var A="ALL",po="all",mo=["get","post","put","delete","options","patch"],lt="Can not add a route since the matcher is already built.",ut=class extends Error{};var fo="__COMPOSED_HANDLER";var la=t=>t.text("404 Not Found",404),go=(t,e)=>{if("getResponse"in t){let r=t.getResponse();return e.newResponse(r.body,r)}return console.error(t),e.text("Internal Server Error",500)},ur=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(t={}){[...mo,po].forEach(s=>{this[s]=(i,...a)=>(typeof i=="string"?this.#t=i:this.#n(s,this.#t,i),a.forEach(l=>{this.#n(s,this.#t,l)}),this)}),this.on=(s,i,...a)=>{for(let l of[i].flat()){this.#t=l;for(let c of[s].flat())a.map(d=>{this.#n(c.toUpperCase(),this.#t,d)})}return this},this.use=(s,...i)=>(typeof s=="string"?this.#t=s:(this.#t="*",i.unshift(s)),i.forEach(a=>{this.#n(A,this.#t,a)}),this);let{strict:r,...o}=t;Object.assign(this,o),this.getPath=r??!0?t.getPath??ir:no}#e(){let t=new ur({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,t.#r=this.#r,t.routes=this.routes,t}#r=la;errorHandler=go;route(t,e){let r=this.basePath(t);return e.routes.map(o=>{let s;e.errorHandler===go?s=o.handler:(s=async(i,a)=>(await or([],e.errorHandler)(i,()=>o.handler(i,a))).res,s[fo]=o.handler),r.#n(o.method,o.path,s)}),this}basePath(t){let e=this.#e();return e._basePath=Z(this._basePath,t),e}onError=t=>(this.errorHandler=t,this);notFound=t=>(this.#r=t,this);mount(t,e,r){let o,s;r&&(typeof r=="function"?s=r:(s=r.optionHandler,r.replaceRequest===!1?o=l=>l:o=r.replaceRequest));let i=s?l=>{let c=s(l);return Array.isArray(c)?c:[c]}:l=>{let c;try{c=l.executionCtx}catch{}return[l.env,c]};o||=(()=>{let l=Z(this._basePath,t),c=l==="/"?0:l.length;return d=>{let u=new URL(d.url);return u.pathname=u.pathname.slice(c)||"/",new Request(u,d)}})();let a=async(l,c)=>{let d=await e(o(l.req.raw),...i(l));if(d)return d;await c()};return this.#n(A,Z(t,"*"),a),this}#n(t,e,r){t=t.toUpperCase(),e=Z(this._basePath,e);let o={basePath:this._basePath,path:e,method:t,handler:r};this.router.add(t,e,[r,o]),this.routes.push(o)}#s(t,e){if(t instanceof Error)return this.errorHandler(t,e);throw t}#o(t,e,r,o){if(o==="HEAD")return(async()=>new Response(null,await this.#o(t,e,r,"GET")))();let s=this.getPath(t,{env:r}),i=this.router.match(o,s),a=new ho(t,{path:s,matchResult:i,env:r,executionCtx:e,notFoundHandler:this.#r});if(i[0].length===1){let c;try{c=i[0][0][0][0](a,async()=>{a.res=await this.#r(a)})}catch(d){return this.#s(d,a)}return c instanceof Promise?c.then(d=>d||(a.finalized?a.res:this.#r(a))).catch(d=>this.#s(d,a)):c??this.#r(a)}let l=or(i[0],this.errorHandler,this.#r);return(async()=>{try{let c=await l(a);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return this.#s(c,a)}})()}fetch=(t,...e)=>this.#o(t,e[1],e[0],t.method);request=(t,e,r,o)=>t instanceof Request?this.fetch(e?new Request(t,e):t,r,o):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${Z("/",t)}`,e),r,o));fire=()=>{addEventListener("fetch",t=>{t.respondWith(this.#o(t.request,t,void 0,t.request.method))})}};var dt="[^/]+",Oe=".*",Re="(?:|/.*)",ee=Symbol(),ua=new Set(".\\+*[^]$()");function da(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===Oe||t===Re?1:e===Oe||e===Re?-1:t===dt?1:e===dt?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var ht=class{#t;#e;#r=Object.create(null);insert(t,e,r,o,s){if(t.length===0){if(this.#t!==void 0)throw ee;if(s)return;this.#t=e;return}let[i,...a]=t,l=i==="*"?a.length===0?["","",Oe]:["","",dt]:i==="/*"?["","",Re]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(l){let d=l[1],u=l[2]||dt;if(d&&l[2]&&(u===".*"||(u=u.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(u))))throw ee;if(c=this.#r[u],!c){if(Object.keys(this.#r).some(h=>h!==Oe&&h!==Re))throw ee;if(s)return;c=this.#r[u]=new ht,d!==""&&(c.#e=o.varIndex++)}!s&&d!==""&&r.push([d,c.#e])}else if(c=this.#r[i],!c){if(Object.keys(this.#r).some(d=>d.length>1&&d!==Oe&&d!==Re))throw ee;if(s)return;c=this.#r[i]=new ht}c.insert(a,e,r,o,s)}buildRegExpStr(){let e=Object.keys(this.#r).sort(da).map(r=>{let o=this.#r[r];return(typeof o.#e=="number"?`(${r})@${o.#e}`:ua.has(r)?`\\${r}`:r)+o.buildRegExpStr()});return typeof this.#t=="number"&&e.unshift(`#${this.#t}`),e.length===0?"":e.length===1?e[0]:"(?:"+e.join("|")+")"}};var vo=class{#t={varIndex:0};#e=new ht;insert(t,e,r){let o=[],s=[];for(let a=0;;){let l=!1;if(t=t.replace(/\{[^}]+\}/g,c=>{let d=`@\\${a}`;return s[a]=[d,c],a++,l=!0,d}),!l)break}let i=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=s.length-1;a>=0;a--){let[l]=s[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(l)!==-1){i[c]=i[c].replace(l,s[a][1]);break}}return this.#e.insert(i,e,o,this.#t,r),o}buildRegExp(){let t=this.#e.buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0,r=[],o=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,a)=>i!==void 0?(r[++e]=Number(i),"$()"):(a!==void 0&&(o[Number(a)]=++e),"")),[new RegExp(`^${t}`),r,o]}};var yo=[],ha=[/^$/,[],Object.create(null)],Po=Object.create(null);function To(t){return Po[t]??=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`)}function pa(){Po=Object.create(null)}function ma(t){let e=new vo,r=[];if(t.length===0)return ha;let o=t.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,u],[h,f])=>d?1:h?-1:u.length-f.length),s=Object.create(null);for(let d=0,u=-1,h=o.length;d<h;d++){let[f,g,p]=o[d];f?s[g]=[p.map(([v])=>[v,Object.create(null)]),yo]:u++;let m;try{m=e.insert(g,u,f)}catch(v){throw v===ee?new ut(g):v}f||(r[u]=p.map(([v,y])=>{let T=Object.create(null);for(y-=1;y>=0;y--){let[P,S]=m[y];T[P]=S}return[v,T]}))}let[i,a,l]=e.buildRegExp();for(let d=0,u=r.length;d<u;d++)for(let h=0,f=r[d].length;h<f;h++){let g=r[d][h]?.[1];if(!g)continue;let p=Object.keys(g);for(let m=0,v=p.length;m<v;m++)g[p[m]]=l[g[p[m]]]}let c=[];for(let d in a)c[d]=r[a[d]];return[i,c,s]}function ie(t,e){if(t){for(let r of Object.keys(t).sort((o,s)=>s.length-o.length))if(To(r).test(e))return[...t[r]]}}var dr=class{name="RegExpRouter";#t;#e;constructor(){this.#t={[A]:Object.create(null)},this.#e={[A]:Object.create(null)}}add(t,e,r){let o=this.#t,s=this.#e;if(!o||!s)throw new Error(lt);o[t]||[o,s].forEach(l=>{l[t]=Object.create(null),Object.keys(l[A]).forEach(c=>{l[t][c]=[...l[A][c]]})}),e==="/*"&&(e="*");let i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){let l=To(e);t===A?Object.keys(o).forEach(c=>{o[c][e]||=ie(o[c],e)||ie(o[A],e)||[]}):o[t][e]||=ie(o[t],e)||ie(o[A],e)||[],Object.keys(o).forEach(c=>{(t===A||t===c)&&Object.keys(o[c]).forEach(d=>{l.test(d)&&o[c][d].push([r,i])})}),Object.keys(s).forEach(c=>{(t===A||t===c)&&Object.keys(s[c]).forEach(d=>l.test(d)&&s[c][d].push([r,i]))});return}let a=ct(e)||[e];for(let l=0,c=a.length;l<c;l++){let d=a[l];Object.keys(s).forEach(u=>{(t===A||t===u)&&(s[u][d]||=[...ie(o[u],d)||ie(o[A],d)||[]],s[u][d].push([r,i-c+l+1]))})}}match(t,e){pa();let r=this.#r();return this.match=(o,s)=>{let i=r[o]||r[A],a=i[2][s];if(a)return a;let l=s.match(i[0]);if(!l)return[[],yo];let c=l.indexOf("",1);return[i[1][c],l]},this.match(t,e)}#r(){let t=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#t)).forEach(e=>{t[e]||=this.#n(e)}),this.#t=this.#e=void 0,t}#n(t){let e=[],r=t===A;return[this.#t,this.#e].forEach(o=>{let s=o[t]?Object.keys(o[t]).map(i=>[i,o[t][i]]):[];s.length!==0?(r||=!0,e.push(...s)):t!==A&&e.push(...Object.keys(o[A]).map(i=>[i,o[A][i]]))}),r?ma(e):null}};var hr=class{name="SmartRouter";#t=[];#e=[];constructor(t){this.#t=t.routers}add(t,e,r){if(!this.#e)throw new Error(lt);this.#e.push([t,e,r])}match(t,e){if(!this.#e)throw new Error("Fatal error");let r=this.#t,o=this.#e,s=r.length,i=0,a;for(;i<s;i++){let l=r[i];try{for(let c=0,d=o.length;c<d;c++)l.add(...o[c]);a=l.match(t,e)}catch(c){if(c instanceof ut)continue;throw c}this.match=l.match.bind(l),this.#t=[l],this.#e=void 0;break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.#e||this.#t.length!==1)throw new Error("No active router has been determined yet.");return this.#t[0]}};var Ae=Object.create(null),pr=class{#t;#e;#r;#n=0;#s=Ae;constructor(t,e,r){if(this.#e=r||Object.create(null),this.#t=[],t&&e){let o=Object.create(null);o[t]={handler:e,possibleKeys:[],score:0},this.#t=[o]}this.#r=[]}insert(t,e,r){this.#n=++this.#n;let o=this,s=oo(e),i=[];for(let a=0,l=s.length;a<l;a++){let c=s[a],d=s[a+1],u=so(c,d),h=Array.isArray(u)?u[0]:c;if(h in o.#e){o=o.#e[h],u&&i.push(u[1]);continue}o.#e[h]=new pr,u&&(o.#r.push(u),i.push(u[1])),o=o.#e[h]}return o.#t.push({[t]:{handler:r,possibleKeys:i.filter((a,l,c)=>c.indexOf(a)===l),score:this.#n}}),o}#o(t,e,r,o){let s=[];for(let i=0,a=t.#t.length;i<a;i++){let l=t.#t[i],c=l[e]||l[A],d={};if(c!==void 0&&(c.params=Object.create(null),s.push(c),r!==Ae||o&&o!==Ae))for(let u=0,h=c.possibleKeys.length;u<h;u++){let f=c.possibleKeys[u],g=d[c.score];c.params[f]=o?.[f]&&!g?o[f]:r[f]??o?.[f],d[c.score]=!0}}return s}search(t,e){let r=[];this.#s=Ae;let s=[this],i=nr(e),a=[];for(let l=0,c=i.length;l<c;l++){let d=i[l],u=l===c-1,h=[];for(let f=0,g=s.length;f<g;f++){let p=s[f],m=p.#e[d];m&&(m.#s=p.#s,u?(m.#e["*"]&&r.push(...this.#o(m.#e["*"],t,p.#s)),r.push(...this.#o(m,t,p.#s))):h.push(m));for(let v=0,y=p.#r.length;v<y;v++){let T=p.#r[v],P=p.#s===Ae?{}:{...p.#s};if(T==="*"){let D=p.#e["*"];D&&(r.push(...this.#o(D,t,p.#s)),D.#s=P,h.push(D));continue}let[S,E,O]=T;if(!d&&!(O instanceof RegExp))continue;let b=p.#e[S],q=i.slice(l).join("/");if(O instanceof RegExp){let D=O.exec(q);if(D){if(P[E]=D[0],r.push(...this.#o(b,t,p.#s,P)),Object.keys(b.#e).length){b.#s=P;let j=D[0].match(/\//)?.length??0;(a[j]||=[]).push(b)}continue}}(O===!0||O.test(d))&&(P[E]=d,u?(r.push(...this.#o(b,t,P,p.#s)),b.#e["*"]&&r.push(...this.#o(b.#e["*"],t,P,p.#s))):(b.#s=P,h.push(b)))}}s=h.concat(a.shift()??[])}return r.length>1&&r.sort((l,c)=>l.score-c.score),[r.map(({handler:l,params:c})=>[l,c])]}};var mr=class{name="TrieRouter";#t;constructor(){this.#t=new pr}add(t,e,r){let o=ct(e);if(o){for(let s=0,i=o.length;s<i;s++)this.#t.insert(t,o[s],r);return}this.#t.insert(t,e,r)}match(t,e){return this.#t.search(t,e)}};var fr=class extends ur{constructor(t={}){super(t),this.router=t.router??new hr({routers:[new dr,new mr]})}};var _o=t=>{let r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...t},o=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,l){function c(u,h){a.res.headers.set(u,h)}let d=await o(a.req.header("origin")||"",a);if(d&&c("Access-Control-Allow-Origin",d),r.origin!=="*"){let u=a.req.header("Vary");u?c("Vary",u):c("Vary","Origin")}if(r.credentials&&c("Access-Control-Allow-Credentials","true"),r.exposeHeaders?.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());let u=await s(a.req.header("origin")||"",a);u.length&&c("Access-Control-Allow-Methods",u.join(","));let h=r.allowHeaders;if(!h?.length){let f=a.req.header("Access-Control-Request-Headers");f&&(h=f.split(/\s*,\s*/))}return h?.length&&(c("Access-Control-Allow-Headers",h.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await l()}};var C=class{constructor(e){this.namespace=e}async createProduct(e){let r=`product:${e.id}`,o={...e,images:Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:[]};await this.namespace.put(r,JSON.stringify(o));let s=await this.namespace.get("products:all"),i=s?JSON.parse(s):[];return i.push(e.id),await this.namespace.put("products:all",JSON.stringify(i)),o}async getProduct(e){let r=`product:${e}`,o=await this.namespace.get(r);return o?JSON.parse(o):null}async updateProduct(e,r){let o=await this.getProduct(e);if(!o)throw new Error("Product not found");let s={...o,...r,images:Array.isArray(r.images)?r.images:r.imageUrl?[r.imageUrl]:o.images||[]},i=`product:${e}`;return await this.namespace.put(i,JSON.stringify(s)),s}async deleteProduct(e){let r=`product:${e}`;await this.namespace.delete(r);let o=await this.namespace.get("products:all");if(o){let i=JSON.parse(o).filter(a=>a!==e);await this.namespace.put("products:all",JSON.stringify(i))}}async getAllProducts(){let e=await this.namespace.get("products:all");if(!e)return[];let r=JSON.parse(e);return(await Promise.all(r.map(s=>this.getProduct(s)))).filter(Boolean)}async createCollection(e){let r=`collection:${e.id}`;await this.namespace.put(r,JSON.stringify(e));let o=await this.namespace.get("collections:all"),s=o?JSON.parse(o):[];return s.push(e.id),await this.namespace.put("collections:all",JSON.stringify(s)),e}async getCollection(e){let r=`collection:${e}`,o=await this.namespace.get(r);return o?JSON.parse(o):null}async updateCollection(e,r){let o=await this.getCollection(e);if(!o)throw new Error("Collection not found");let s={...o,...r},i=`collection:${e}`;return await this.namespace.put(i,JSON.stringify(s)),s}async deleteCollection(e){let r=`collection:${e}`;await this.namespace.delete(r);let o=await this.namespace.get("collections:all");if(o){let i=JSON.parse(o).filter(a=>a!==e);await this.namespace.put("collections:all",JSON.stringify(i))}}async getAllCollections(){let e=await this.namespace.get("collections:all");if(!e)return[];let r=JSON.parse(e);return(await Promise.all(r.map(s=>this.getCollection(s)))).filter(Boolean)}async getProductsByCollection(e){return(await this.getAllProducts()).filter(o=>o.collectionId===e)}async createMediaItem(e){let r=e.id;if(!r)throw new Error("Media item missing id");let o=`media:${r}`,s={id:r,url:String(e.url||""),source:e.source||"unknown",filename:e.filename||"",mimeType:e.mimeType||"",driveFileId:e.driveFileId||"",createdAt:typeof e.createdAt=="number"?e.createdAt:Date.now(),updatedAt:Date.now()};await this.namespace.put(o,JSON.stringify(s));let i="media:all",a=await this.namespace.get(i),l=a?JSON.parse(a):[];return l.includes(r)||l.push(r),await this.namespace.put(i,JSON.stringify(l)),s}async getMediaItem(e){let r=`media:${e}`,o=await this.namespace.get(r);return o?JSON.parse(o):null}async deleteMediaItem(e){let r=`media:${e}`;await this.namespace.delete(r);let o="media:all",s=await this.namespace.get(o);if(s){let a=JSON.parse(s).filter(l=>l!==e);await this.namespace.put(o,JSON.stringify(a))}}async getAllMediaItems(){let r=await this.namespace.get("media:all");if(!r)return[];let o=JSON.parse(r);return(await Promise.all(o.map(i=>this.getMediaItem(i)))).filter(Boolean)}};function fa(t){console.log("Auth middleware - Available env bindings:",Object.keys(t));let e=["OPENSHOP-TEST3_KV","OPENSHOP_TEST3_KV","OPENSHOP_KV"];for(let s of e)if(s in t&&t[s]){console.log(`Auth middleware - Found KV namespace via direct access: ${s}`);let i=t[s];return console.log("Auth middleware - KV namespace object:",!!i,typeof i),console.log("Auth middleware - KV namespace has get method:",typeof i?.get),i}let r=Object.keys(t).find(s=>s.endsWith("_KV")||s.endsWith("-KV")||s.includes("KV"));if(console.log("Auth middleware - Found KV binding name via search:",r),r){let s=t[r];if(console.log("Auth middleware - KV namespace object via search:",!!s,typeof s),s)return s}let o=Object.values(t).find(s=>s&&typeof s.get=="function"&&typeof s.put=="function");return console.log("Auth middleware - Fallback KV namespace found:",!!o),o||(console.error("Auth middleware - No KV namespace found! Available bindings:",Object.keys(t)),console.error("Auth middleware - Environment values:",Object.values(t).map(s=>typeof s))),o}async function gr(t){if(typeof t!="string"||t.length===0)throw new Error("Token must be a non-empty string for hashing");let e=typeof globalThis<"u"?globalThis.crypto:null;if(!e||!e.subtle||typeof e.subtle.digest!="function")throw new Error("Web Crypto API is not available for hashing tokens");let o=new TextEncoder().encode(t),s=await e.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(s)).map(a=>a.toString(16).padStart(2,"0")).join("")}async function So(t,e){let r;try{t&&typeof t.header=="function"?r=t.header("X-Admin-Token")||t.header("x-admin-token"):t&&t.headers&&typeof t.headers.get=="function"?r=t.headers.get("X-Admin-Token")||t.headers.get("x-admin-token"):t&&t.raw&&t.raw.headers&&typeof t.raw.headers.get=="function"&&(r=t.raw.headers.get("X-Admin-Token")||t.raw.headers.get("x-admin-token"))}catch(o){console.error("Auth middleware - error reading admin token header:",o)}if(!r)return{isValid:!1,error:"Admin authentication required",status:401};try{let o=fa(e);if(!o)return console.error("Auth middleware - KV namespace is undefined"),{isValid:!1,error:"KV namespace not available",status:500};let i=`admin_token:${await gr(r)}`,a=await o.get(i);if(!a)return{isValid:!1,error:"Invalid or expired admin token",status:401};let l=parseInt(a);return Date.now()-l>864e5?(await o.delete(i),{isValid:!1,error:"Admin session expired",status:401}):{isValid:!0}}catch(o){return console.error("Admin auth verification error:",o),{isValid:!1,error:"Authentication verification failed",status:500}}}var Ce="storefront:theme",Pr=/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/,Tr=[{id:"inter",label:"Inter",stack:"'Inter', 'system-ui', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},{id:"roboto",label:"Roboto",stack:"'Roboto', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"},{id:"montserrat",label:"Montserrat",stack:"'Montserrat', 'Segoe UI', sans-serif"},{id:"poppins",label:"Poppins",stack:"'Poppins', 'Segoe UI', sans-serif"},{id:"lora",label:"Lora",stack:"'Lora', 'Georgia', serif"}],yr=Tr.reduce((t,e)=>(t[e.id]=e,t),{}),M={colors:{primary:"#1e293b",secondary:"#475569",accent:"#3b82f6",text:"#0f172a",background:"#f8fafc",card:"#ffffff"},typography:{fontId:"inter"},corners:{enabled:!0,radiusMultiplier:1}};function pt(t,e,r){return Math.min(Math.max(t,e),r)}function _r(t){if(!t)return null;let r=(t.length===4?`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`:t).replace("#",""),o=parseInt(r,16);return Number.isNaN(o)?null:{r:o>>16&255,g:o>>8&255,b:o&255}}function bo({r:t,g:e,b:r}){let o=s=>s.toString(16).padStart(2,"0");return`#${o(pt(Math.round(vr(t)),0,255))}${o(pt(Math.round(vr(e)),0,255))}${o(pt(Math.round(vr(r)),0,255))}`}function vr(t){return Number.isFinite(t)?t:0}function ce(t,e,r){return t+(e-t)*r}function Eo(t,e=.1){let r=_r(t);return r?bo({r:ce(r.r,255,e),g:ce(r.g,255,e),b:ce(r.b,255,e)}):t}function xo(t,e=.1){let r=_r(t);return r?bo({r:ce(r.r,0,e),g:ce(r.g,0,e),b:ce(r.b,0,e)}):t}function wo(t){let e=_r(t);return e&&(.299*e.r+.587*e.g+.114*e.b)/255>.6?"#0f172a":"#ffffff"}function ae(t,e){return typeof t!="string"?e:Pr.test(t.trim())?t.trim():e}function ga(t){return yr[t]?t:M.typography.fontId}function va(t){if(typeof t=="string"&&t.trim()!==""){let e=Number(t);Number.isNaN(e)||(t=e)}return(typeof t!="number"||Number.isNaN(t))&&(t=M.corners.radiusMultiplier),pt(Math.abs(t),0,4)}function mt(t={}){let e=t.colors||{},r=t.typography||t.font,o=t.corners||t.radius,s={primary:ae(e.primary,M.colors.primary),secondary:ae(e.secondary,M.colors.secondary),accent:ae(e.accent,M.colors.accent),text:ae(e.text,M.colors.text),background:ae(e.background,M.colors.background),card:ae(e.card,M.colors.card)},i={fontId:ga(r?.fontId??r?.font??r?.id)},a={enabled:o?.enabled!==void 0?!!o.enabled:M.corners.enabled,radiusMultiplier:va(o?.radiusMultiplier??o?.multiplier??o?.value)};return{colors:s,typography:i,corners:a}}function Oo(t){let{colors:e,typography:r,corners:o}=t,{fontId:s}=r,i=yr[s]||yr[M.typography.fontId],a=o.enabled?o.radiusMultiplier*12:0;return{colors:{onPrimary:wo(e.primary),onSecondary:wo(e.secondary),primaryHover:xo(e.primary,.12),secondaryHover:xo(e.secondary,.12),accentSoft:Eo(e.accent,.4),background:e.background,surface:"#ffffff",mutedText:Eo(e.text,.35)},typography:{fontFamily:i.stack,fontLabel:i.label},corners:{radiusPx:a,radiusSm:o.enabled?Math.max(a*.5,2):0,radiusLg:o.enabled?a*1.5:0}}}function ya(t){let e=mt(t),r=Oo(e);return{"--storefront-color-primary":e.colors.primary,"--storefront-color-primary-hover":r.colors.primaryHover,"--storefront-color-primary-contrast":r.colors.onPrimary,"--storefront-color-secondary":e.colors.secondary,"--storefront-color-secondary-hover":r.colors.secondaryHover,"--storefront-color-secondary-contrast":r.colors.onSecondary,"--storefront-color-accent":e.colors.accent,"--storefront-color-accent-soft":r.colors.accentSoft,"--storefront-color-text":e.colors.text,"--storefront-color-text-muted":r.colors.mutedText,"--storefront-color-background":r.colors.background,"--storefront-color-surface":r.colors.surface,"--storefront-color-card":e.colors.card,"--storefront-font-family":r.typography.fontFamily,"--storefront-radius-base":`${r.corners.radiusPx}px`,"--storefront-radius-sm":`${r.corners.radiusSm}px`,"--storefront-radius-lg":`${r.corners.radiusLg}px`}}function le(t={}){let e=mt(t.theme??t),r={...M,...e,colors:{...M.colors,...e.colors},typography:{...M.typography,...e.typography},corners:{...M.corners,...e.corners}},{typography:o,corners:s}=Oo(r);return{...r,typography:{...r.typography,fontFamily:o.fontFamily,fontLabel:o.fontLabel},corners:{...r.corners,radiusPx:s.radiusPx,radiusSm:s.radiusSm,radiusLg:s.radiusLg},meta:{updatedAt:t.updatedAt??null},cssVariables:ya(r)}}var Kl=globalThis.crypto||{};var Ro=t=>({update:()=>{},digest:e=>""});var Ie=class{constructor(){}on(){return this}emit(){return!1}once(){return this}removeListener(){return this}};var z=class{computeHMACSignature(e,r){throw new Error("computeHMACSignature not implemented.")}computeHMACSignatureAsync(e,r){throw new Error("computeHMACSignatureAsync not implemented.")}computeSHA256Async(e){throw new Error("computeSHA256 not implemented.")}},ue=class extends Error{};var ft=class extends z{computeHMACSignature(e,r){return(void 0)("sha256",r).update(e,"utf8").digest("hex")}async computeHMACSignatureAsync(e,r){return await this.computeHMACSignature(e,r)}async computeSHA256Async(e){return new Uint8Array(await Ro("sha256").update(e).digest())}};var Er={};st(Er,{default:()=>Sr,get:()=>Ta,request:()=>Pa});var Sr={},Pa=()=>{},Ta=()=>{};var wr={};st(wr,{default:()=>xr,get:()=>Sa,request:()=>_a});var xr={},_a=()=>{},Sa=()=>{};var N=class t{getClientName(){throw new Error("getClientName not implemented.")}makeRequest(e,r,o,s,i,a,l,c){throw new Error("makeRequest not implemented.")}static makeTimeoutError(){let e=new TypeError(t.TIMEOUT_ERROR_CODE);return e.code=t.TIMEOUT_ERROR_CODE,e}};N.CONNECTION_CLOSED_ERROR_CODES=["ECONNRESET","EPIPE"];N.TIMEOUT_ERROR_CODE="ETIMEDOUT";var W=class{constructor(e,r){this._statusCode=e,this._headers=r}getStatusCode(){return this._statusCode}getHeaders(){return this._headers}getRawResponse(){throw new Error("getRawResponse not implemented.")}toStream(e){throw new Error("toStream not implemented.")}toJSON(){throw new Error("toJSON not implemented.")}};var Ao=Sr||Er,Co=xr||wr,Ea=new Ao.Agent({keepAlive:!0}),xa=new Co.Agent({keepAlive:!0}),ke=class extends N{constructor(e){super(),this._agent=e}getClientName(){return"node"}makeRequest(e,r,o,s,i,a,l,c){let d=l==="http",u=this._agent;return u||(u=d?Ea:xa),new Promise((f,g)=>{let p=(d?Ao:Co).request({host:e,port:r,path:o,method:s,agent:u,headers:i,ciphers:"DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2:!MD5"});p.setTimeout(c,()=>{p.destroy(N.makeTimeoutError())}),p.on("response",m=>{f(new br(m))}),p.on("error",m=>{g(m)}),p.once("socket",m=>{m.connecting?m.once(d?"connect":"secureConnect",()=>{p.write(a),p.end()}):(p.write(a),p.end())})})}},br=class extends W{constructor(e){super(e.statusCode,e.headers||{}),this._res=e}getRawResponse(){return this._res}toStream(e){return this._res.once("end",()=>e()),this._res}toJSON(){return new Promise((e,r)=>{let o="";this._res.setEncoding("utf8"),this._res.on("data",s=>{o+=s}),this._res.once("end",()=>{try{e(JSON.parse(o))}catch(s){r(s)}})})}};var Io=t=>new URLSearchParams(t).toString();var Or=["apiKey","idempotencyKey","stripeAccount","apiVersion","maxNetworkRetries","timeout","host","authenticator","stripeContext","additionalHeaders","streaming"];function ko(t){return t&&typeof t=="object"&&Or.some(e=>Object.prototype.hasOwnProperty.call(t,e))}function J(t,e){return Io(t,{serializeDate:r=>Math.floor(r.getTime()/1e3).toString(),arrayFormat:e=="v2"?"repeat":"indices"}).replace(/%5B/g,"[").replace(/%5D/g,"]")}var vt=(()=>{let t={"\n":"\\n",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"};return e=>{let r=e.replace(/["\n\r\u2028\u2029]/g,o=>t[o]);return o=>r.replace(/\{([\s\S]+?)\}/g,(s,i)=>{let a=o[i];return ba(a)?encodeURIComponent(a):""})}})();function ba(t){return["number","string","boolean"].includes(typeof t)}function Mo(t){let e=t.match(/\{\w+\}/g);return e?e.map(r=>r.replace(/[{}]/g,"")):[]}function de(t){if(!Array.isArray(t)||!t[0]||typeof t[0]!="object")return{};if(!ko(t[0]))return t.shift();let e=Object.keys(t[0]),r=e.filter(o=>Or.includes(o));return r.length>0&&r.length!==e.length&&De(`Options found in arguments (${r.join(", ")}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options.`),{}}function yt(t){let e={host:null,headers:{},settings:{},streaming:!1};if(t.length>0){let r=t[t.length-1];if(typeof r=="string")e.authenticator=gt(t.pop());else if(ko(r)){let o=Object.assign({},t.pop()),s=Object.keys(o).filter(i=>!Or.includes(i));if(s.length&&De(`Invalid options found (${s.join(", ")}); ignoring.`),o.apiKey&&(e.authenticator=gt(o.apiKey)),o.idempotencyKey&&(e.headers["Idempotency-Key"]=o.idempotencyKey),o.stripeAccount&&(e.headers["Stripe-Account"]=o.stripeAccount),o.stripeContext){if(e.headers["Stripe-Account"])throw new Error("Can't specify both stripeAccount and stripeContext.");e.headers["Stripe-Context"]=o.stripeContext}if(o.apiVersion&&(e.headers["Stripe-Version"]=o.apiVersion),Number.isInteger(o.maxNetworkRetries)&&(e.settings.maxNetworkRetries=o.maxNetworkRetries),Number.isInteger(o.timeout)&&(e.settings.timeout=o.timeout),o.host&&(e.host=o.host),o.authenticator){if(o.apiKey)throw new Error("Can't specify both apiKey and authenticator.");if(typeof o.authenticator!="function")throw new Error("The authenticator must be a function receiving a request as the first parameter.");e.authenticator=o.authenticator}o.additionalHeaders&&(e.headers=o.additionalHeaders),o.streaming&&(e.streaming=!0)}}return e}function Do(t){let e=this,r=Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(...o){e.apply(this,o)};return Object.assign(r,e),r.prototype=Object.create(e.prototype),Object.assign(r.prototype,t),r}function Pt(t){if(typeof t!="object")throw new Error("Argument must be an object");return Object.keys(t).reduce((e,r)=>(t[r]!=null&&(e[r]=t[r]),e),{})}function jo(t){return t&&typeof t=="object"?Object.keys(t).reduce((e,r)=>(e[Oa(r)]=t[r],e),{}):t}function Oa(t){return t.split("-").map(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()).join("-")}function Me(t,e){return e?t.then(r=>{setTimeout(()=>{e(null,r)},0)},r=>{setTimeout(()=>{e(r,null)},0)}):t}function Go(t){return t==="OAuth"?"oauth":t[0].toLowerCase()+t.substring(1)}function De(t){return typeof process.emitWarning!="function"?console.warn(`Stripe: ${t}`):process.emitWarning(t,"Stripe")}function Ra(t){let e=typeof t;return(e==="function"||e==="object")&&!!t}function No(t){let e={},r=(o,s)=>{Object.entries(o).forEach(([i,a])=>{let l=s?`${s}[${i}]`:i;if(Ra(a)){if(!(a instanceof Uint8Array)&&!Object.prototype.hasOwnProperty.call(a,"data"))return r(a,l);e[l]=a}else e[l]=String(a)})};return r(t,null),e}function Tt(t,e,r){if(!Number.isInteger(e)){if(r!==void 0)return r;throw new Error(`${t} must be an integer`)}return e}function qo(){return typeof process>"u"?{}:{lang_version:process.version,platform:process.platform}}function gt(t){let e=r=>(r.headers.Authorization="Bearer "+t,Promise.resolve());return e._apiKey=t,e}function Ho(t){let e=t.reduce((s,i)=>s+i.length,0),r=new Uint8Array(e),o=0;return t.forEach(s=>{r.set(s,o),o+=s.length}),r}function Aa(t,e){return this[t]instanceof Date?Math.floor(this[t].getTime()/1e3).toString():e}function Lo(t){return JSON.stringify(t,Aa)}function he(t){return t&&t.startsWith("/v2")?"v2":"v1"}function _t(t){return Array.isArray(t)?t.join(", "):String(t)}function Uo(t){let e=Array.isArray(t)?t[0]:t;return Number(e)}function Fo(t){return Object.entries(t).map(([e,r])=>[e,_t(r)])}var St=class t extends N{constructor(e){if(super(),!e){if(!globalThis.fetch)throw new Error("fetch() function not provided and is not defined in the global scope. You must provide a fetch implementation.");e=globalThis.fetch}globalThis.AbortController?this._fetchFn=t.makeFetchWithAbortTimeout(e):this._fetchFn=t.makeFetchWithRaceTimeout(e)}static makeFetchWithRaceTimeout(e){return(r,o,s)=>{let i,a=new Promise((c,d)=>{i=setTimeout(()=>{i=null,d(N.makeTimeoutError())},s)}),l=e(r,o);return Promise.race([l,a]).finally(()=>{i&&clearTimeout(i)})}}static makeFetchWithAbortTimeout(e){return async(r,o,s)=>{let i=new AbortController,a=setTimeout(()=>{a=null,i.abort(N.makeTimeoutError())},s);try{return await e(r,Object.assign(Object.assign({},o),{signal:i.signal}))}catch(l){throw l.name==="AbortError"?N.makeTimeoutError():l}finally{a&&clearTimeout(a)}}}getClientName(){return"fetch"}async makeRequest(e,r,o,s,i,a,l,c){let d=l==="http",u=new URL(o,`${d?"http":"https"}://${e}`);u.port=r;let h=s=="POST"||s=="PUT"||s=="PATCH",f=a||(h?"":void 0),g=await this._fetchFn(u.toString(),{method:s,headers:Fo(i),body:typeof f=="object"?JSON.stringify(f):f},c);return new Rr(g)}},Rr=class t extends W{constructor(e){super(e.status,t._transformHeadersToObject(e.headers)),this._res=e}getRawResponse(){return this._res}toStream(e){return e(),this._res.body}toJSON(){return this._res.json()}static _transformHeadersToObject(e){let r={};for(let o of e){if(!Array.isArray(o)||o.length!=2)throw new Error("Response objects produced by the fetch function given to FetchHttpClient do not have an iterable headers map. Response#headers should be an iterable object.");r[o[0]]=o[1]}return r}};var Et=class extends z{constructor(e){super(),this.subtleCrypto=e||crypto.subtle}computeHMACSignature(e,r){throw new ue("SubtleCryptoProvider cannot be used in a synchronous context.")}async computeHMACSignatureAsync(e,r){let o=new TextEncoder,s=await this.subtleCrypto.importKey("raw",o.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),i=await this.subtleCrypto.sign("hmac",s,o.encode(e)),a=new Uint8Array(i),l=new Array(a.length);for(let c=0;c<a.length;c++)l[c]=Ar[a[c]];return l.join("")}async computeSHA256Async(e){return new Uint8Array(await this.subtleCrypto.digest("SHA-256",e))}},Ar=new Array(256);for(let t=0;t<Ar.length;t++)Ar[t]=t.toString(16).padStart(2,"0");var xt=class{constructor(){this._fetchFn=null,this._agent=null}getUname(){throw new Error("getUname not implemented.")}uuid4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)})}secureCompare(e,r){if(e.length!==r.length)return!1;let o=e.length,s=0;for(let i=0;i<o;++i)s|=e.charCodeAt(i)^r.charCodeAt(i);return s===0}createEmitter(){throw new Error("createEmitter not implemented.")}tryBufferData(e){throw new Error("tryBufferData not implemented.")}createNodeHttpClient(e){throw new Error("createNodeHttpClient not implemented.")}createFetchHttpClient(e){return new St(e)}createDefaultHttpClient(){throw new Error("createDefaultHttpClient not implemented.")}createNodeCryptoProvider(){throw new Error("createNodeCryptoProvider not implemented.")}createSubtleCryptoProvider(e){return new Et(e)}createDefaultCryptoProvider(){throw new Error("createDefaultCryptoProvider not implemented.")}};var Ct={};st(Ct,{StripeAPIError:()=>pe,StripeAuthenticationError:()=>me,StripeCardError:()=>wt,StripeConnectionError:()=>Ne,StripeError:()=>I,StripeIdempotencyError:()=>bt,StripeInvalidGrantError:()=>Ot,StripeInvalidRequestError:()=>je,StripePermissionError:()=>Ge,StripeRateLimitError:()=>fe,StripeSignatureVerificationError:()=>L,StripeUnknownError:()=>Rt,TemporarySessionExpiredError:()=>At,generateV1Error:()=>qe,generateV2Error:()=>Cr});var qe=t=>{switch(t.type){case"card_error":return new wt(t);case"invalid_request_error":return new je(t);case"api_error":return new pe(t);case"authentication_error":return new me(t);case"rate_limit_error":return new fe(t);case"idempotency_error":return new bt(t);case"invalid_grant":return new Ot(t);default:return new Rt(t)}},Cr=t=>{switch(t.type){case"temporary_session_expired":return new At(t)}switch(t.code){case"invalid_fields":return new je(t)}return qe(t)},I=class extends Error{constructor(e={},r=null){var o;super(e.message),this.type=r||this.constructor.name,this.raw=e,this.rawType=e.type,this.code=e.code,this.doc_url=e.doc_url,this.param=e.param,this.detail=e.detail,this.headers=e.headers,this.requestId=e.requestId,this.statusCode=e.statusCode,this.message=(o=e.message)!==null&&o!==void 0?o:"",this.userMessage=e.user_message,this.charge=e.charge,this.decline_code=e.decline_code,this.payment_intent=e.payment_intent,this.payment_method=e.payment_method,this.payment_method_type=e.payment_method_type,this.setup_intent=e.setup_intent,this.source=e.source}};I.generate=qe;var wt=class extends I{constructor(e={}){super(e,"StripeCardError")}},je=class extends I{constructor(e={}){super(e,"StripeInvalidRequestError")}},pe=class extends I{constructor(e={}){super(e,"StripeAPIError")}},me=class extends I{constructor(e={}){super(e,"StripeAuthenticationError")}},Ge=class extends I{constructor(e={}){super(e,"StripePermissionError")}},fe=class extends I{constructor(e={}){super(e,"StripeRateLimitError")}},Ne=class extends I{constructor(e={}){super(e,"StripeConnectionError")}},L=class extends I{constructor(e,r,o={}){super(o,"StripeSignatureVerificationError"),this.header=e,this.payload=r}},bt=class extends I{constructor(e={}){super(e,"StripeIdempotencyError")}},Ot=class extends I{constructor(e={}){super(e,"StripeInvalidGrantError")}},Rt=class extends I{constructor(e={}){super(e,"StripeUnknownError")}},At=class extends I{constructor(e={}){super(e,"TemporarySessionExpiredError")}};var $o=()=>Promise.resolve({stdout:"",stderr:""});var Ir=class extends I{},It=class extends xt{constructor(){super(),this._exec=$o,this._UNAME_CACHE=null}uuid4(){return void 0?(void 0)():super.uuid4()}getUname(){return this._UNAME_CACHE||(this._UNAME_CACHE=new Promise((e,r)=>{try{this._exec("uname -a",(o,s)=>{if(o)return e(null);e(s)})}catch{e(null)}})),this._UNAME_CACHE}secureCompare(e,r){if(!e||!r)throw new Error("secureCompare must receive two arguments");if(e.length!==r.length)return!1;if(void 0){let o=new TextEncoder,s=o.encode(e),i=o.encode(r);return(void 0)(s,i)}return super.secureCompare(e,r)}createEmitter(){return new Ie}tryBufferData(e){if(!(e.file.data instanceof Ie))return Promise.resolve(e);let r=[];return new Promise((o,s)=>{e.file.data.on("data",i=>{r.push(i)}).once("end",()=>{let i=Object.assign({},e);i.file.data=Ho(r),o(i)}).on("error",i=>{s(new Ir({message:"An error occurred while attempting to process the file for upload.",detail:i}))})})}createNodeHttpClient(e){return new ke(e)}createDefaultHttpClient(){return new ke}createNodeCryptoProvider(){return new ft}createDefaultCryptoProvider(){return this.createNodeCryptoProvider()}};var Ca=60,kt=class t{constructor(e,r){this._stripe=e,this._maxBufferedRequestMetric=r}_addHeadersDirectlyToObject(e,r){e.requestId=r["request-id"],e.stripeAccount=e.stripeAccount||r["stripe-account"],e.apiVersion=e.apiVersion||r["stripe-version"],e.idempotencyKey=e.idempotencyKey||r["idempotency-key"]}_makeResponseEvent(e,r,o){let s=Date.now(),i=s-e.request_start_time;return Pt({api_version:o["stripe-version"],account:o["stripe-account"],idempotency_key:o["idempotency-key"],method:e.method,path:e.path,status:r,request_id:this._getRequestId(o),elapsed:i,request_start_time:e.request_start_time,request_end_time:s})}_getRequestId(e){return e["request-id"]}_streamingResponseHandler(e,r,o){return s=>{let i=s.getHeaders(),a=()=>{let c=this._makeResponseEvent(e,s.getStatusCode(),i);this._stripe._emitter.emit("response",c),this._recordRequestMetrics(this._getRequestId(i),c.elapsed,r)},l=s.toStream(a);return this._addHeadersDirectlyToObject(l,i),o(null,l)}}_jsonResponseHandler(e,r,o,s){return i=>{let a=i.getHeaders(),l=this._getRequestId(a),c=i.getStatusCode(),d=this._makeResponseEvent(e,c,a);this._stripe._emitter.emit("response",d),i.toJSON().then(u=>{if(u.error){let h;throw typeof u.error=="string"&&(u.error={type:u.error,message:u.error_description}),u.error.headers=a,u.error.statusCode=c,u.error.requestId=l,c===401?h=new me(u.error):c===403?h=new Ge(u.error):c===429?h=new fe(u.error):r==="v2"?h=Cr(u.error):h=qe(u.error),h}return u},u=>{throw new pe({message:"Invalid JSON received from the Stripe API",exception:u,requestId:a["request-id"]})}).then(u=>{this._recordRequestMetrics(l,d.elapsed,o);let h=i.getRawResponse();this._addHeadersDirectlyToObject(h,a),Object.defineProperty(u,"lastResponse",{enumerable:!1,writable:!1,value:h}),s(null,u)},u=>s(u,null))}}static _generateConnectionErrorMessage(e){return`An error occurred with our connection to Stripe.${e>0?` Request was retried ${e} times.`:""}`}static _shouldRetry(e,r,o,s){return s&&r===0&&N.CONNECTION_CLOSED_ERROR_CODES.includes(s.code)?!0:r>=o?!1:e?e.getHeaders()["stripe-should-retry"]==="false"?!1:e.getHeaders()["stripe-should-retry"]==="true"||e.getStatusCode()===409||e.getStatusCode()>=500:!0}_getSleepTimeInMS(e,r=null){let o=this._stripe.getInitialNetworkRetryDelay(),s=this._stripe.getMaxNetworkRetryDelay(),i=Math.min(o*Math.pow(2,e-1),s);return i*=.5*(1+Math.random()),i=Math.max(o,i),Number.isInteger(r)&&r<=Ca&&(i=Math.max(i,r)),i*1e3}_getMaxNetworkRetries(e={}){return e.maxNetworkRetries!==void 0&&Number.isInteger(e.maxNetworkRetries)?e.maxNetworkRetries:this._stripe.getMaxNetworkRetries()}_defaultIdempotencyKey(e,r,o){let s=this._getMaxNetworkRetries(r),i=()=>`stripe-node-retry-${this._stripe._platformFunctions.uuid4()}`;if(o==="v2"){if(e==="POST"||e==="DELETE")return i()}else if(o==="v1"&&e==="POST"&&s>0)return i();return null}_makeHeaders({contentType:e,contentLength:r,apiVersion:o,clientUserAgent:s,method:i,userSuppliedHeaders:a,userSuppliedSettings:l,stripeAccount:c,stripeContext:d,apiMode:u}){let h={Accept:"application/json","Content-Type":e,"User-Agent":this._getUserAgentString(u),"X-Stripe-Client-User-Agent":s,"X-Stripe-Client-Telemetry":this._getTelemetryHeader(),"Stripe-Version":o,"Stripe-Account":c,"Stripe-Context":d,"Idempotency-Key":this._defaultIdempotencyKey(i,l,u)},f=i=="POST"||i=="PUT"||i=="PATCH";return(f||r)&&(f||De(`${i} method had non-zero contentLength but no payload is expected for this verb`),h["Content-Length"]=r),Object.assign(Pt(h),jo(a))}_getUserAgentString(e){let r=this._stripe.getConstant("PACKAGE_VERSION"),o=this._stripe._appInfo?this._stripe.getAppInfoAsString():"";return`Stripe/${e} NodeBindings/${r} ${o}`.trim()}_getTelemetryHeader(){if(this._stripe.getTelemetryEnabled()&&this._stripe._prevRequestMetrics.length>0){let e=this._stripe._prevRequestMetrics.shift();return JSON.stringify({last_request_metrics:e})}}_recordRequestMetrics(e,r,o){if(this._stripe.getTelemetryEnabled()&&e)if(this._stripe._prevRequestMetrics.length>this._maxBufferedRequestMetric)De("Request metrics buffer is full, dropping telemetry message.");else{let s={request_id:e,request_duration_ms:r};o&&o.length>0&&(s.usage=o),this._stripe._prevRequestMetrics.push(s)}}_rawRequest(e,r,o,s){return new Promise((a,l)=>{let c;try{let g=e.toUpperCase();if(g!=="POST"&&o&&Object.keys(o).length!==0)throw new Error("rawRequest only supports params on POST requests. Please pass null and add your parameters to path.");let p=[].slice.call([o,s]),m=de(p),v=g==="POST"?Object.assign({},m):null,y=yt(p),T=y.headers,P=y.authenticator;c={requestMethod:g,requestPath:r,bodyData:v,queryData:{},authenticator:P,headers:T,host:y.host,streaming:!!y.streaming,settings:{},usage:["raw_request"]}}catch(g){l(g);return}function d(g,p){g?l(g):a(p)}let{headers:u,settings:h}=c,f=c.authenticator;this._request(c.requestMethod,c.host,r,c.bodyData,f,{headers:u,settings:h,streaming:c.streaming},c.usage,d)})}_request(e,r,o,s,i,a,l=[],c,d=null){var u;let h;i=(u=i??this._stripe._authenticator)!==null&&u!==void 0?u:null;let f=he(o),g=(v,y,T,P,S)=>setTimeout(v,this._getSleepTimeInMS(P,S),y,T,P+1),p=(v,y,T)=>{let P=a.settings&&a.settings.timeout&&Number.isInteger(a.settings.timeout)&&a.settings.timeout>=0?a.settings.timeout:this._stripe.getApiField("timeout"),S={host:r||this._stripe.getApiField("host"),port:this._stripe.getApiField("port"),path:o,method:e,headers:Object.assign({},y),body:h,protocol:this._stripe.getApiField("protocol")};i(S).then(()=>{let E=this._stripe.getApiField("httpClient").makeRequest(S.host,S.port,S.path,S.method,S.headers,S.body,S.protocol,P),O=Date.now(),b=Pt({api_version:v,account:_t(y["Stripe-Account"]),idempotency_key:_t(y["Idempotency-Key"]),method:e,path:o,request_start_time:O}),q=T||0,D=this._getMaxNetworkRetries(a.settings||{});this._stripe._emitter.emit("request",b),E.then(j=>t._shouldRetry(j,q,D)?g(p,v,y,q,Uo(j.getHeaders()["retry-after"])):a.streaming&&j.getStatusCode()<400?this._streamingResponseHandler(b,l,c)(j):this._jsonResponseHandler(b,f,l,c)(j)).catch(j=>{if(t._shouldRetry(null,q,D,j))return g(p,v,y,q,null);{let eo=j.code&&j.code===N.TIMEOUT_ERROR_CODE;return c(new Ne({message:eo?`Request aborted due to timeout being reached (${P}ms)`:t._generateConnectionErrorMessage(q),detail:j}))}})}).catch(E=>{throw new I({message:"Unable to authenticate the request",exception:E})})},m=(v,y)=>{if(v)return c(v);h=y,this._stripe.getClientUserAgent(T=>{let P=this._stripe.getApiField("version"),S=this._makeHeaders({contentType:f=="v2"?"application/json":"application/x-www-form-urlencoded",contentLength:h.length,apiVersion:P,clientUserAgent:T,method:e,userSuppliedHeaders:a.headers,userSuppliedSettings:a.settings,stripeAccount:f=="v2"?null:this._stripe.getApiField("stripeAccount"),stripeContext:f=="v2"?this._stripe.getApiField("stripeContext"):null,apiMode:f});p(P,S,0)})};if(d)d(e,s,a.headers,m);else{let v;f=="v2"?v=s?Lo(s):"":v=J(s||{},f),m(null,v)}}};var Mt=class{constructor(e,r,o,s){this.index=0,this.pagePromise=e,this.promiseCache={currentPromise:null},this.requestArgs=r,this.spec=o,this.stripeResource=s}async iterate(e){if(!(e&&e.data&&typeof e.data.length=="number"))throw Error("Unexpected: Stripe API response does not have a well-formed `data` array.");let r=Ko(this.requestArgs);if(this.index<e.data.length){let o=r?e.data.length-1-this.index:this.index,s=e.data[o];return this.index+=1,{value:s,done:!1}}else if(e.has_more){this.index=0,this.pagePromise=this.getNextPage(e);let o=await this.pagePromise;return this.iterate(o)}return{done:!0,value:void 0}}getNextPage(e){throw new Error("Unimplemented")}async _next(){return this.iterate(await this.pagePromise)}next(){if(this.promiseCache.currentPromise)return this.promiseCache.currentPromise;let e=(async()=>{let r=await this._next();return this.promiseCache.currentPromise=null,r})();return this.promiseCache.currentPromise=e,e}},Mr=class extends Mt{getNextPage(e){let r=Ko(this.requestArgs),o=Da(e,r);return this.stripeResource._makeRequest(this.requestArgs,this.spec,{[r?"ending_before":"starting_after"]:o})}},Dr=class extends Mt{getNextPage(e){if(!e.next_page)throw Error("Unexpected: Stripe API response does not have a well-formed `next_page` field, but `has_more` was true.");return this.stripeResource._makeRequest(this.requestArgs,this.spec,{page:e.next_page})}},jr=class{constructor(e,r,o,s){this.currentPageIterator=(async()=>(await e).data[Symbol.iterator]())(),this.nextPageUrl=(async()=>(await e).next_page_url||null)(),this.requestArgs=r,this.spec=o,this.stripeResource=s}async turnPage(){let e=await this.nextPageUrl;if(!e)return null;this.spec.fullPath=e;let r=await this.stripeResource._makeRequest([],this.spec,{});return this.nextPageUrl=Promise.resolve(r.next_page_url),this.currentPageIterator=Promise.resolve(r.data[Symbol.iterator]()),this.currentPageIterator}async next(){{let o=(await this.currentPageIterator).next();if(!o.done)return{done:!1,value:o.value}}let e=await this.turnPage();if(!e)return{done:!0,value:void 0};let r=e.next();return r.done?{done:!0,value:void 0}:{done:!1,value:r.value}}},Vo=(t,e,r,o)=>{let s=he(r.fullPath||r.path);return s!=="v2"&&r.methodType==="search"?kr(new Dr(o,e,r,t)):s!=="v2"&&r.methodType==="list"?kr(new Mr(o,e,r,t)):s==="v2"&&r.methodType==="list"?kr(new jr(o,e,r,t)):null},kr=t=>{let e=ja((...s)=>t.next(...s)),r=Ga(e),o={autoPagingEach:e,autoPagingToArray:r,next:()=>t.next(),return:()=>({}),[Ia()]:()=>o};return o};function Ia(){return typeof Symbol<"u"&&Symbol.asyncIterator?Symbol.asyncIterator:"@@asyncIterator"}function ka(t){if(t.length<2)return null;let e=t[1];if(typeof e!="function")throw Error(`The second argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);return e}function Ma(t){if(t.length===0)return;let e=t[0];if(typeof e!="function")throw Error(`The first argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);if(e.length===2)return e;if(e.length>2)throw Error(`The \`onItem\` callback function passed to autoPagingEach must accept at most two arguments; got ${e}`);return function(o,s){let i=e(o);s(i)}}function Da(t,e){let r=e?0:t.data.length-1,o=t.data[r],s=o&&o.id;if(!s)throw Error("Unexpected: No `id` found on the last item while auto-paging a list.");return s}function ja(t){return function(){let r=[].slice.call(arguments),o=Ma(r),s=ka(r);if(r.length>2)throw Error(`autoPagingEach takes up to two arguments; received ${r}`);let i=Na(t,o);return Me(i,s)}}function Ga(t){return function(r,o){let s=r&&r.limit;if(!s)throw Error("You must pass a `limit` option to autoPagingToArray, e.g., `autoPagingToArray({limit: 1000});`.");if(s>1e4)throw Error("You cannot specify a limit of more than 10,000 items to fetch in `autoPagingToArray`; use `autoPagingEach` to iterate through longer lists.");let i=new Promise((a,l)=>{let c=[];t(d=>{if(c.push(d),c.length>=s)return!1}).then(()=>{a(c)}).catch(l)});return Me(i,o)}}function Na(t,e){return new Promise((r,o)=>{function s(i){if(i.done){r();return}let a=i.value;return new Promise(l=>{e(a,l)}).then(l=>l===!1?s({done:!0,value:void 0}):t().then(s))}t().then(s).catch(o)})}function Ko(t){let e=[].slice.call(t);return!!de(e).ending_before}function Bo(t){if(t.path!==void 0&&t.fullPath!==void 0)throw new Error(`Method spec specified both a 'path' (${t.path}) and a 'fullPath' (${t.fullPath}).`);return function(...e){let r=typeof e[e.length-1]=="function"&&e.pop();t.urlParams=Mo(t.fullPath||this.createResourcePathWithSymbols(t.path||""));let o=Me(this._makeRequest(e,t,{}),r);return Object.assign(o,Vo(this,e,t,o)),o}}n.extend=Do;n.method=Bo;n.MAX_BUFFERED_REQUEST_METRICS=100;function n(t,e){if(this._stripe=t,e)throw new Error("Support for curried url params was dropped in stripe-node v7.0.0. Instead, pass two ids.");this.basePath=vt(this.basePath||t.getApiField("basePath")),this.resourcePath=this.path,this.path=vt(this.path),this.initialize(...arguments)}n.prototype={_stripe:null,path:"",resourcePath:"",basePath:null,initialize(){},requestDataProcessor:null,validateRequest:null,createFullPath(t,e){let r=[this.basePath(e),this.path(e)];if(typeof t=="function"){let o=t(e);o&&r.push(o)}else r.push(t);return this._joinUrlParts(r)},createResourcePathWithSymbols(t){return t?`/${this._joinUrlParts([this.resourcePath,t])}`:`/${this.resourcePath}`},_joinUrlParts(t){return t.join("/").replace(/\/{2,}/g,"/")},_getRequestOpts(t,e,r){var o;let s=(e.method||"GET").toUpperCase(),i=e.usage||[],a=e.urlParams||[],l=e.encode||(b=>b),c=!!e.fullPath,d=vt(c?e.fullPath:e.path||""),u=c?e.fullPath:this.createResourcePathWithSymbols(e.path),h=[].slice.call(t),f=a.reduce((b,q)=>{let D=h.shift();if(typeof D!="string")throw new Error(`Stripe: Argument "${q}" must be a string, but got: ${D} (on API request to \`${s} ${u}\`)`);return b[q]=D,b},{}),g=de(h),p=l(Object.assign({},g,r)),m=yt(h),v=m.host||e.host,y=!!e.streaming||!!m.streaming;if(h.filter(b=>b!=null).length)throw new Error(`Stripe: Unknown arguments (${h}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options. (on API request to ${s} \`${u}\`)`);let T=c?d(f):this.createFullPath(d,f),P=Object.assign(m.headers,e.headers);e.validator&&e.validator(p,{headers:P});let S=e.method==="GET"||e.method==="DELETE";return{requestMethod:s,requestPath:T,bodyData:S?null:p,queryData:S?p:{},authenticator:(o=m.authenticator)!==null&&o!==void 0?o:null,headers:P,host:v??null,streaming:y,settings:m.settings,usage:i}},_makeRequest(t,e,r){return new Promise((o,s)=>{var i;let a;try{a=this._getRequestOpts(t,e,r)}catch(f){s(f);return}function l(f,g){f?s(f):o(e.transformResponseData?e.transformResponseData(g):g)}let c=Object.keys(a.queryData).length===0,d=[a.requestPath,c?"":"?",J(a.queryData,he(a.requestPath))].join(""),{headers:u,settings:h}=a;this._stripe._requestSender._request(a.requestMethod,a.host,d,a.bodyData,a.authenticator,{headers:u,settings:h,streaming:a.streaming},a.usage,l,(i=this.requestDataProcessor)===null||i===void 0?void 0:i.bind(this))})}};function zo(t){let e={DEFAULT_TOLERANCE:300,signature:null,constructEvent(u,h,f,g,p,m){try{if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");this.signature.verifyHeader(u,h,f,g||e.DEFAULT_TOLERANCE,p,m)}catch(y){throw y instanceof ue&&(y.message+="\nUse `await constructEventAsync(...)` instead of `constructEvent(...)`"),y}return u instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(u)):JSON.parse(u)},async constructEventAsync(u,h,f,g,p,m){if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");return await this.signature.verifyHeaderAsync(u,h,f,g||e.DEFAULT_TOLERANCE,p,m),u instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(u)):JSON.parse(u)},generateTestHeaderString:function(u){let h=d(u),f=h.signature||h.cryptoProvider.computeHMACSignature(h.payloadString,h.secret);return h.generateHeaderString(f)},generateTestHeaderStringAsync:async function(u){let h=d(u),f=h.signature||await h.cryptoProvider.computeHMACSignatureAsync(h.payloadString,h.secret);return h.generateHeaderString(f)}},r={EXPECTED_SCHEME:"v1",verifyHeader(u,h,f,g,p,m){let{decodedHeader:v,decodedPayload:y,details:T,suspectPayloadType:P}=s(u,h,this.EXPECTED_SCHEME),S=/\s/.test(f);p=p||c();let E=p.computeHMACSignature(o(y,T),f);return i(y,v,T,E,g,P,S,m),!0},async verifyHeaderAsync(u,h,f,g,p,m){let{decodedHeader:v,decodedPayload:y,details:T,suspectPayloadType:P}=s(u,h,this.EXPECTED_SCHEME),S=/\s/.test(f);p=p||c();let E=await p.computeHMACSignatureAsync(o(y,T),f);return i(y,v,T,E,g,P,S,m)}};function o(u,h){return`${h.timestamp}.${u}`}function s(u,h,f){if(!u)throw new L(h,u,{message:"No webhook payload was provided."});let g=typeof u!="string"&&!(u instanceof Uint8Array),p=new TextDecoder("utf8"),m=u instanceof Uint8Array?p.decode(u):u;if(Array.isArray(h))throw new Error("Unexpected: An array was passed as a header, which should not be possible for the stripe-signature header.");if(h==null||h=="")throw new L(h,u,{message:"No stripe-signature header value was provided."});let v=h instanceof Uint8Array?p.decode(h):h,y=a(v,f);if(!y||y.timestamp===-1)throw new L(v,m,{message:"Unable to extract timestamp and signatures from header"});if(!y.signatures.length)throw new L(v,m,{message:"No signatures found with expected scheme"});return{decodedPayload:m,decodedHeader:v,details:y,suspectPayloadType:g}}function i(u,h,f,g,p,m,v,y){let T=!!f.signatures.filter(t.secureCompare.bind(t,g)).length,P=`
Learn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature`,S=v?`

Note: The provided signing secret contains whitespace. This often indicates an extra newline or space is in the value`:"";if(!T)throw m?new L(h,u,{message:`Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. 
Signature verification is impossible without access to the original signed material. 
`+P+`
`+S}):new L(h,u,{message:`No signatures found matching the expected signature for payload. Are you passing the raw request body you received from Stripe? 
 If a webhook request is being forwarded by a third-party tool, ensure that the exact request body, including JSON formatting and new line style, is preserved.
`+P+`
`+S});let E=Math.floor((typeof y=="number"?y:Date.now())/1e3)-f.timestamp;if(p>0&&E>p)throw new L(h,u,{message:"Timestamp outside the tolerance zone"});return!0}function a(u,h){return typeof u!="string"?null:u.split(",").reduce((f,g)=>{let p=g.split("=");return p[0]==="t"&&(f.timestamp=parseInt(p[1],10)),p[0]===h&&f.signatures.push(p[1]),f},{timestamp:-1,signatures:[]})}let l=null;function c(){return l||(l=t.createDefaultCryptoProvider()),l}function d(u){if(!u)throw new I({message:"Options are required"});let h=Math.floor(u.timestamp)||Math.floor(Date.now()/1e3),f=u.scheme||r.EXPECTED_SCHEME,g=u.cryptoProvider||c(),p=`${h}.${u.payload}`,m=v=>`t=${h},${f}=${v}`;return Object.assign(Object.assign({},u),{timestamp:h,scheme:f,cryptoProvider:g,payloadString:p,generateHeaderString:m})}return e.signature=r,e}var Gr="2025-08-27.basil";var we={};st(we,{Account:()=>Jr,AccountLinks:()=>In,AccountSessions:()=>kn,Accounts:()=>Jr,ApplePayDomains:()=>Mn,ApplicationFees:()=>Dn,Apps:()=>ac,Balance:()=>jn,BalanceTransactions:()=>Nn,Billing:()=>cc,BillingPortal:()=>lc,Charges:()=>qn,Checkout:()=>uc,Climate:()=>dc,ConfirmationTokens:()=>Hn,CountrySpecs:()=>Un,Coupons:()=>Fn,CreditNotes:()=>$n,CustomerSessions:()=>Vn,Customers:()=>Kn,Disputes:()=>Bn,Entitlements:()=>hc,EphemeralKeys:()=>Wn,Events:()=>Yn,ExchangeRates:()=>Qn,FileLinks:()=>Zn,Files:()=>ti,FinancialConnections:()=>pc,Forwarding:()=>mc,Identity:()=>fc,InvoiceItems:()=>ri,InvoicePayments:()=>si,InvoiceRenderingTemplates:()=>ni,Invoices:()=>ii,Issuing:()=>gc,Mandates:()=>ai,OAuth:()=>li,PaymentIntents:()=>ui,PaymentLinks:()=>di,PaymentMethodConfigurations:()=>hi,PaymentMethodDomains:()=>pi,PaymentMethods:()=>mi,Payouts:()=>fi,Plans:()=>gi,Prices:()=>vi,Products:()=>yi,PromotionCodes:()=>Pi,Quotes:()=>Ti,Radar:()=>vc,Refunds:()=>_i,Reporting:()=>yc,Reviews:()=>Si,SetupAttempts:()=>Ei,SetupIntents:()=>xi,ShippingRates:()=>wi,Sigma:()=>Pc,Sources:()=>bi,SubscriptionItems:()=>Oi,SubscriptionSchedules:()=>Ri,Subscriptions:()=>Ai,Tax:()=>Tc,TaxCodes:()=>Ii,TaxIds:()=>ki,TaxRates:()=>Mi,Terminal:()=>_c,TestHelpers:()=>Sc,Tokens:()=>ji,Topups:()=>Gi,Transfers:()=>Ni,Treasury:()=>Ec,V2:()=>xc,WebhookEndpoints:()=>qi});function qa(t,e){for(let r in e){if(!Object.prototype.hasOwnProperty.call(e,r))continue;let o=r[0].toLowerCase()+r.substring(1),s=new e[r](t);this[o]=s}}function R(t,e){return function(r){return new qa(r,e)}}var te=n.method,Wo=n.extend({retrieve:te({method:"GET",fullPath:"/v1/financial_connections/accounts/{account}"}),list:te({method:"GET",fullPath:"/v1/financial_connections/accounts",methodType:"list"}),disconnect:te({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/disconnect"}),listOwners:te({method:"GET",fullPath:"/v1/financial_connections/accounts/{account}/owners",methodType:"list"}),refresh:te({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/refresh"}),subscribe:te({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/subscribe"}),unsubscribe:te({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/unsubscribe"})});var Jo=n.method,Yo=n.extend({retrieve:Jo({method:"GET",fullPath:"/v1/entitlements/active_entitlements/{id}"}),list:Jo({method:"GET",fullPath:"/v1/entitlements/active_entitlements",methodType:"list"})});var ge=n.method,Xo=n.extend({create:ge({method:"POST",fullPath:"/v1/billing/alerts"}),retrieve:ge({method:"GET",fullPath:"/v1/billing/alerts/{id}"}),list:ge({method:"GET",fullPath:"/v1/billing/alerts",methodType:"list"}),activate:ge({method:"POST",fullPath:"/v1/billing/alerts/{id}/activate"}),archive:ge({method:"POST",fullPath:"/v1/billing/alerts/{id}/archive"}),deactivate:ge({method:"POST",fullPath:"/v1/billing/alerts/{id}/deactivate"})});var He=n.method,Qo=n.extend({retrieve:He({method:"GET",fullPath:"/v1/issuing/authorizations/{authorization}"}),update:He({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}"}),list:He({method:"GET",fullPath:"/v1/issuing/authorizations",methodType:"list"}),approve:He({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}/approve"}),decline:He({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}/decline"})});var re=n.method,Zo=n.extend({create:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations"}),capture:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/capture"}),expire:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/expire"}),finalizeAmount:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/finalize_amount"}),increment:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/increment"}),respond:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/fraud_challenges/respond"}),reverse:re({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/reverse"})});var Nr=n.method,es=n.extend({create:Nr({method:"POST",fullPath:"/v1/tax/calculations"}),retrieve:Nr({method:"GET",fullPath:"/v1/tax/calculations/{calculation}"}),listLineItems:Nr({method:"GET",fullPath:"/v1/tax/calculations/{calculation}/line_items",methodType:"list"})});var Dt=n.method,ts=n.extend({create:Dt({method:"POST",fullPath:"/v1/issuing/cardholders"}),retrieve:Dt({method:"GET",fullPath:"/v1/issuing/cardholders/{cardholder}"}),update:Dt({method:"POST",fullPath:"/v1/issuing/cardholders/{cardholder}"}),list:Dt({method:"GET",fullPath:"/v1/issuing/cardholders",methodType:"list"})});var jt=n.method,rs=n.extend({create:jt({method:"POST",fullPath:"/v1/issuing/cards"}),retrieve:jt({method:"GET",fullPath:"/v1/issuing/cards/{card}"}),update:jt({method:"POST",fullPath:"/v1/issuing/cards/{card}"}),list:jt({method:"GET",fullPath:"/v1/issuing/cards",methodType:"list"})});var Le=n.method,os=n.extend({deliverCard:Le({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/deliver"}),failCard:Le({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/fail"}),returnCard:Le({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/return"}),shipCard:Le({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/ship"}),submitCard:Le({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/submit"})});var Gt=n.method,ss=n.extend({create:Gt({method:"POST",fullPath:"/v1/billing_portal/configurations"}),retrieve:Gt({method:"GET",fullPath:"/v1/billing_portal/configurations/{configuration}"}),update:Gt({method:"POST",fullPath:"/v1/billing_portal/configurations/{configuration}"}),list:Gt({method:"GET",fullPath:"/v1/billing_portal/configurations",methodType:"list"})});var Ue=n.method,ns=n.extend({create:Ue({method:"POST",fullPath:"/v1/terminal/configurations"}),retrieve:Ue({method:"GET",fullPath:"/v1/terminal/configurations/{configuration}"}),update:Ue({method:"POST",fullPath:"/v1/terminal/configurations/{configuration}"}),list:Ue({method:"GET",fullPath:"/v1/terminal/configurations",methodType:"list"}),del:Ue({method:"DELETE",fullPath:"/v1/terminal/configurations/{configuration}"})});var Ha=n.method,is=n.extend({create:Ha({method:"POST",fullPath:"/v1/test_helpers/confirmation_tokens"})});var La=n.method,as=n.extend({create:La({method:"POST",fullPath:"/v1/terminal/connection_tokens"})});var Ua=n.method,cs=n.extend({retrieve:Ua({method:"GET",fullPath:"/v1/billing/credit_balance_summary"})});var ls=n.method,us=n.extend({retrieve:ls({method:"GET",fullPath:"/v1/billing/credit_balance_transactions/{id}"}),list:ls({method:"GET",fullPath:"/v1/billing/credit_balance_transactions",methodType:"list"})});var ve=n.method,ds=n.extend({create:ve({method:"POST",fullPath:"/v1/billing/credit_grants"}),retrieve:ve({method:"GET",fullPath:"/v1/billing/credit_grants/{id}"}),update:ve({method:"POST",fullPath:"/v1/billing/credit_grants/{id}"}),list:ve({method:"GET",fullPath:"/v1/billing/credit_grants",methodType:"list"}),expire:ve({method:"POST",fullPath:"/v1/billing/credit_grants/{id}/expire"}),voidGrant:ve({method:"POST",fullPath:"/v1/billing/credit_grants/{id}/void"})});var qr=n.method,hs=n.extend({create:qr({method:"POST",fullPath:"/v1/treasury/credit_reversals"}),retrieve:qr({method:"GET",fullPath:"/v1/treasury/credit_reversals/{credit_reversal}"}),list:qr({method:"GET",fullPath:"/v1/treasury/credit_reversals",methodType:"list"})});var Fa=n.method,ps=n.extend({fundCashBalance:Fa({method:"POST",fullPath:"/v1/test_helpers/customers/{customer}/fund_cash_balance"})});var Hr=n.method,ms=n.extend({create:Hr({method:"POST",fullPath:"/v1/treasury/debit_reversals"}),retrieve:Hr({method:"GET",fullPath:"/v1/treasury/debit_reversals/{debit_reversal}"}),list:Hr({method:"GET",fullPath:"/v1/treasury/debit_reversals",methodType:"list"})});var Fe=n.method,fs=n.extend({create:Fe({method:"POST",fullPath:"/v1/issuing/disputes"}),retrieve:Fe({method:"GET",fullPath:"/v1/issuing/disputes/{dispute}"}),update:Fe({method:"POST",fullPath:"/v1/issuing/disputes/{dispute}"}),list:Fe({method:"GET",fullPath:"/v1/issuing/disputes",methodType:"list"}),submit:Fe({method:"POST",fullPath:"/v1/issuing/disputes/{dispute}/submit"})});var gs=n.method,vs=n.extend({retrieve:gs({method:"GET",fullPath:"/v1/radar/early_fraud_warnings/{early_fraud_warning}"}),list:gs({method:"GET",fullPath:"/v1/radar/early_fraud_warnings",methodType:"list"})});var Y=n.method,ys=n.extend({create:Y({method:"POST",fullPath:"/v2/core/event_destinations"}),retrieve:Y({method:"GET",fullPath:"/v2/core/event_destinations/{id}"}),update:Y({method:"POST",fullPath:"/v2/core/event_destinations/{id}"}),list:Y({method:"GET",fullPath:"/v2/core/event_destinations",methodType:"list"}),del:Y({method:"DELETE",fullPath:"/v2/core/event_destinations/{id}"}),disable:Y({method:"POST",fullPath:"/v2/core/event_destinations/{id}/disable"}),enable:Y({method:"POST",fullPath:"/v2/core/event_destinations/{id}/enable"}),ping:Y({method:"POST",fullPath:"/v2/core/event_destinations/{id}/ping"})});var Lr=n.method,Ps=n.extend({retrieve(...t){return Lr({method:"GET",fullPath:"/v2/core/events/{id}",transformResponseData:r=>this.addFetchRelatedObjectIfNeeded(r)}).apply(this,t)},list(...t){return Lr({method:"GET",fullPath:"/v2/core/events",methodType:"list",transformResponseData:r=>Object.assign(Object.assign({},r),{data:r.data.map(this.addFetchRelatedObjectIfNeeded.bind(this))})}).apply(this,t)},addFetchRelatedObjectIfNeeded(t){return!t.related_object||!t.related_object.url?t:Object.assign(Object.assign({},t),{fetchRelatedObject:()=>Lr({method:"GET",fullPath:t.related_object.url}).apply(this,[{stripeAccount:t.context}])})}});var Nt=n.method,Ts=n.extend({create:Nt({method:"POST",fullPath:"/v1/entitlements/features"}),retrieve:Nt({method:"GET",fullPath:"/v1/entitlements/features/{id}"}),update:Nt({method:"POST",fullPath:"/v1/entitlements/features/{id}"}),list:Nt({method:"GET",fullPath:"/v1/entitlements/features",methodType:"list"})});var oe=n.method,_s=n.extend({create:oe({method:"POST",fullPath:"/v1/treasury/financial_accounts"}),retrieve:oe({method:"GET",fullPath:"/v1/treasury/financial_accounts/{financial_account}"}),update:oe({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}"}),list:oe({method:"GET",fullPath:"/v1/treasury/financial_accounts",methodType:"list"}),close:oe({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}/close"}),retrieveFeatures:oe({method:"GET",fullPath:"/v1/treasury/financial_accounts/{financial_account}/features"}),updateFeatures:oe({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}/features"})});var Ur=n.method,Ss=n.extend({fail:Ur({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/fail"}),returnInboundTransfer:Ur({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/return"}),succeed:Ur({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/succeed"})});var qt=n.method,Es=n.extend({create:qt({method:"POST",fullPath:"/v1/treasury/inbound_transfers"}),retrieve:qt({method:"GET",fullPath:"/v1/treasury/inbound_transfers/{id}"}),list:qt({method:"GET",fullPath:"/v1/treasury/inbound_transfers",methodType:"list"}),cancel:qt({method:"POST",fullPath:"/v1/treasury/inbound_transfers/{inbound_transfer}/cancel"})});var $e=n.method,xs=n.extend({create:$e({method:"POST",fullPath:"/v1/terminal/locations"}),retrieve:$e({method:"GET",fullPath:"/v1/terminal/locations/{location}"}),update:$e({method:"POST",fullPath:"/v1/terminal/locations/{location}"}),list:$e({method:"GET",fullPath:"/v1/terminal/locations",methodType:"list"}),del:$e({method:"DELETE",fullPath:"/v1/terminal/locations/{location}"})});var $a=n.method,ws=n.extend({create:$a({method:"POST",fullPath:"/v1/billing/meter_event_adjustments"})});var Va=n.method,bs=n.extend({create:Va({method:"POST",fullPath:"/v2/billing/meter_event_adjustments"})});var Ka=n.method,Os=n.extend({create:Ka({method:"POST",fullPath:"/v2/billing/meter_event_session"})});var Ba=n.method,Rs=n.extend({create:Ba({method:"POST",fullPath:"/v2/billing/meter_event_stream",host:"meter-events.stripe.com"})});var za=n.method,As=n.extend({create:za({method:"POST",fullPath:"/v1/billing/meter_events"})});var Wa=n.method,Cs=n.extend({create:Wa({method:"POST",fullPath:"/v2/billing/meter_events"})});var se=n.method,Is=n.extend({create:se({method:"POST",fullPath:"/v1/billing/meters"}),retrieve:se({method:"GET",fullPath:"/v1/billing/meters/{id}"}),update:se({method:"POST",fullPath:"/v1/billing/meters/{id}"}),list:se({method:"GET",fullPath:"/v1/billing/meters",methodType:"list"}),deactivate:se({method:"POST",fullPath:"/v1/billing/meters/{id}/deactivate"}),listEventSummaries:se({method:"GET",fullPath:"/v1/billing/meters/{id}/event_summaries",methodType:"list"}),reactivate:se({method:"POST",fullPath:"/v1/billing/meters/{id}/reactivate"})});var Ve=n.method,ks=n.extend({create:Ve({method:"POST",fullPath:"/v1/climate/orders"}),retrieve:Ve({method:"GET",fullPath:"/v1/climate/orders/{order}"}),update:Ve({method:"POST",fullPath:"/v1/climate/orders/{order}"}),list:Ve({method:"GET",fullPath:"/v1/climate/orders",methodType:"list"}),cancel:Ve({method:"POST",fullPath:"/v1/climate/orders/{order}/cancel"})});var Ht=n.method,Ms=n.extend({update:Ht({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}"}),fail:Ht({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/fail"}),post:Ht({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/post"}),returnOutboundPayment:Ht({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/return"})});var Lt=n.method,Ds=n.extend({create:Lt({method:"POST",fullPath:"/v1/treasury/outbound_payments"}),retrieve:Lt({method:"GET",fullPath:"/v1/treasury/outbound_payments/{id}"}),list:Lt({method:"GET",fullPath:"/v1/treasury/outbound_payments",methodType:"list"}),cancel:Lt({method:"POST",fullPath:"/v1/treasury/outbound_payments/{id}/cancel"})});var Ut=n.method,js=n.extend({update:Ut({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}"}),fail:Ut({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/fail"}),post:Ut({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/post"}),returnOutboundTransfer:Ut({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/return"})});var Ft=n.method,Gs=n.extend({create:Ft({method:"POST",fullPath:"/v1/treasury/outbound_transfers"}),retrieve:Ft({method:"GET",fullPath:"/v1/treasury/outbound_transfers/{outbound_transfer}"}),list:Ft({method:"GET",fullPath:"/v1/treasury/outbound_transfers",methodType:"list"}),cancel:Ft({method:"POST",fullPath:"/v1/treasury/outbound_transfers/{outbound_transfer}/cancel"})});var $t=n.method,Ns=n.extend({create:$t({method:"POST",fullPath:"/v1/issuing/personalization_designs"}),retrieve:$t({method:"GET",fullPath:"/v1/issuing/personalization_designs/{personalization_design}"}),update:$t({method:"POST",fullPath:"/v1/issuing/personalization_designs/{personalization_design}"}),list:$t({method:"GET",fullPath:"/v1/issuing/personalization_designs",methodType:"list"})});var Fr=n.method,qs=n.extend({activate:Fr({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/activate"}),deactivate:Fr({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/deactivate"}),reject:Fr({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/reject"})});var Hs=n.method,Ls=n.extend({retrieve:Hs({method:"GET",fullPath:"/v1/issuing/physical_bundles/{physical_bundle}"}),list:Hs({method:"GET",fullPath:"/v1/issuing/physical_bundles",methodType:"list"})});var Us=n.method,Fs=n.extend({retrieve:Us({method:"GET",fullPath:"/v1/climate/products/{product}"}),list:Us({method:"GET",fullPath:"/v1/climate/products",methodType:"list"})});var H=n.method,$s=n.extend({create:H({method:"POST",fullPath:"/v1/terminal/readers"}),retrieve:H({method:"GET",fullPath:"/v1/terminal/readers/{reader}"}),update:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}"}),list:H({method:"GET",fullPath:"/v1/terminal/readers",methodType:"list"}),del:H({method:"DELETE",fullPath:"/v1/terminal/readers/{reader}"}),cancelAction:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/cancel_action"}),collectInputs:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/collect_inputs"}),collectPaymentMethod:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/collect_payment_method"}),confirmPaymentIntent:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/confirm_payment_intent"}),processPaymentIntent:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/process_payment_intent"}),processSetupIntent:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/process_setup_intent"}),refundPayment:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/refund_payment"}),setReaderDisplay:H({method:"POST",fullPath:"/v1/terminal/readers/{reader}/set_reader_display"})});var $r=n.method,Vs=n.extend({presentPaymentMethod:$r({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/present_payment_method"}),succeedInputCollection:$r({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/succeed_input_collection"}),timeoutInputCollection:$r({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/timeout_input_collection"})});var Ja=n.method,Ks=n.extend({create:Ja({method:"POST",fullPath:"/v1/test_helpers/treasury/received_credits"})});var Bs=n.method,zs=n.extend({retrieve:Bs({method:"GET",fullPath:"/v1/treasury/received_credits/{id}"}),list:Bs({method:"GET",fullPath:"/v1/treasury/received_credits",methodType:"list"})});var Ya=n.method,Ws=n.extend({create:Ya({method:"POST",fullPath:"/v1/test_helpers/treasury/received_debits"})});var Js=n.method,Ys=n.extend({retrieve:Js({method:"GET",fullPath:"/v1/treasury/received_debits/{id}"}),list:Js({method:"GET",fullPath:"/v1/treasury/received_debits",methodType:"list"})});var Xa=n.method,Xs=n.extend({expire:Xa({method:"POST",fullPath:"/v1/test_helpers/refunds/{refund}/expire"})});var Vt=n.method,Qs=n.extend({create:Vt({method:"POST",fullPath:"/v1/tax/registrations"}),retrieve:Vt({method:"GET",fullPath:"/v1/tax/registrations/{id}"}),update:Vt({method:"POST",fullPath:"/v1/tax/registrations/{id}"}),list:Vt({method:"GET",fullPath:"/v1/tax/registrations",methodType:"list"})});var Vr=n.method,Zs=n.extend({create:Vr({method:"POST",fullPath:"/v1/reporting/report_runs"}),retrieve:Vr({method:"GET",fullPath:"/v1/reporting/report_runs/{report_run}"}),list:Vr({method:"GET",fullPath:"/v1/reporting/report_runs",methodType:"list"})});var en=n.method,tn=n.extend({retrieve:en({method:"GET",fullPath:"/v1/reporting/report_types/{report_type}"}),list:en({method:"GET",fullPath:"/v1/reporting/report_types",methodType:"list"})});var Kr=n.method,rn=n.extend({create:Kr({method:"POST",fullPath:"/v1/forwarding/requests"}),retrieve:Kr({method:"GET",fullPath:"/v1/forwarding/requests/{id}"}),list:Kr({method:"GET",fullPath:"/v1/forwarding/requests",methodType:"list"})});var on=n.method,sn=n.extend({retrieve:on({method:"GET",fullPath:"/v1/sigma/scheduled_query_runs/{scheduled_query_run}"}),list:on({method:"GET",fullPath:"/v1/sigma/scheduled_query_runs",methodType:"list"})});var Kt=n.method,nn=n.extend({create:Kt({method:"POST",fullPath:"/v1/apps/secrets"}),list:Kt({method:"GET",fullPath:"/v1/apps/secrets",methodType:"list"}),deleteWhere:Kt({method:"POST",fullPath:"/v1/apps/secrets/delete"}),find:Kt({method:"GET",fullPath:"/v1/apps/secrets/find"})});var Qa=n.method,an=n.extend({create:Qa({method:"POST",fullPath:"/v1/billing_portal/sessions"})});var ye=n.method,cn=n.extend({create:ye({method:"POST",fullPath:"/v1/checkout/sessions"}),retrieve:ye({method:"GET",fullPath:"/v1/checkout/sessions/{session}"}),update:ye({method:"POST",fullPath:"/v1/checkout/sessions/{session}"}),list:ye({method:"GET",fullPath:"/v1/checkout/sessions",methodType:"list"}),expire:ye({method:"POST",fullPath:"/v1/checkout/sessions/{session}/expire"}),listLineItems:ye({method:"GET",fullPath:"/v1/checkout/sessions/{session}/line_items",methodType:"list"})});var ln=n.method,un=n.extend({create:ln({method:"POST",fullPath:"/v1/financial_connections/sessions"}),retrieve:ln({method:"GET",fullPath:"/v1/financial_connections/sessions/{session}"})});var dn=n.method,hn=n.extend({retrieve:dn({method:"GET",fullPath:"/v1/tax/settings"}),update:dn({method:"POST",fullPath:"/v1/tax/settings"})});var pn=n.method,mn=n.extend({retrieve:pn({method:"GET",fullPath:"/v1/climate/suppliers/{supplier}"}),list:pn({method:"GET",fullPath:"/v1/climate/suppliers",methodType:"list"})});var Ke=n.method,fn=n.extend({create:Ke({method:"POST",fullPath:"/v1/test_helpers/test_clocks"}),retrieve:Ke({method:"GET",fullPath:"/v1/test_helpers/test_clocks/{test_clock}"}),list:Ke({method:"GET",fullPath:"/v1/test_helpers/test_clocks",methodType:"list"}),del:Ke({method:"DELETE",fullPath:"/v1/test_helpers/test_clocks/{test_clock}"}),advance:Ke({method:"POST",fullPath:"/v1/test_helpers/test_clocks/{test_clock}/advance"})});var Br=n.method,gn=n.extend({retrieve:Br({method:"GET",fullPath:"/v1/issuing/tokens/{token}"}),update:Br({method:"POST",fullPath:"/v1/issuing/tokens/{token}"}),list:Br({method:"GET",fullPath:"/v1/issuing/tokens",methodType:"list"})});var vn=n.method,yn=n.extend({retrieve:vn({method:"GET",fullPath:"/v1/treasury/transaction_entries/{id}"}),list:vn({method:"GET",fullPath:"/v1/treasury/transaction_entries",methodType:"list"})});var Pn=n.method,Tn=n.extend({retrieve:Pn({method:"GET",fullPath:"/v1/financial_connections/transactions/{transaction}"}),list:Pn({method:"GET",fullPath:"/v1/financial_connections/transactions",methodType:"list"})});var zr=n.method,_n=n.extend({retrieve:zr({method:"GET",fullPath:"/v1/issuing/transactions/{transaction}"}),update:zr({method:"POST",fullPath:"/v1/issuing/transactions/{transaction}"}),list:zr({method:"GET",fullPath:"/v1/issuing/transactions",methodType:"list"})});var Bt=n.method,Sn=n.extend({retrieve:Bt({method:"GET",fullPath:"/v1/tax/transactions/{transaction}"}),createFromCalculation:Bt({method:"POST",fullPath:"/v1/tax/transactions/create_from_calculation"}),createReversal:Bt({method:"POST",fullPath:"/v1/tax/transactions/create_reversal"}),listLineItems:Bt({method:"GET",fullPath:"/v1/tax/transactions/{transaction}/line_items",methodType:"list"})});var Wr=n.method,En=n.extend({createForceCapture:Wr({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/create_force_capture"}),createUnlinkedRefund:Wr({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/create_unlinked_refund"}),refund:Wr({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/{transaction}/refund"})});var xn=n.method,wn=n.extend({retrieve:xn({method:"GET",fullPath:"/v1/treasury/transactions/{id}"}),list:xn({method:"GET",fullPath:"/v1/treasury/transactions",methodType:"list"})});var zt=n.method,bn=n.extend({create:zt({method:"POST",fullPath:"/v1/radar/value_list_items"}),retrieve:zt({method:"GET",fullPath:"/v1/radar/value_list_items/{item}"}),list:zt({method:"GET",fullPath:"/v1/radar/value_list_items",methodType:"list"}),del:zt({method:"DELETE",fullPath:"/v1/radar/value_list_items/{item}"})});var Be=n.method,On=n.extend({create:Be({method:"POST",fullPath:"/v1/radar/value_lists"}),retrieve:Be({method:"GET",fullPath:"/v1/radar/value_lists/{value_list}"}),update:Be({method:"POST",fullPath:"/v1/radar/value_lists/{value_list}"}),list:Be({method:"GET",fullPath:"/v1/radar/value_lists",methodType:"list"}),del:Be({method:"DELETE",fullPath:"/v1/radar/value_lists/{value_list}"})});var Rn=n.method,An=n.extend({retrieve:Rn({method:"GET",fullPath:"/v1/identity/verification_reports/{report}"}),list:Rn({method:"GET",fullPath:"/v1/identity/verification_reports",methodType:"list"})});var Pe=n.method,Cn=n.extend({create:Pe({method:"POST",fullPath:"/v1/identity/verification_sessions"}),retrieve:Pe({method:"GET",fullPath:"/v1/identity/verification_sessions/{session}"}),update:Pe({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}"}),list:Pe({method:"GET",fullPath:"/v1/identity/verification_sessions",methodType:"list"}),cancel:Pe({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}/cancel"}),redact:Pe({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}/redact"})});var k=n.method,Jr=n.extend({create:k({method:"POST",fullPath:"/v1/accounts"}),retrieve(t,...e){return typeof t=="string"?k({method:"GET",fullPath:"/v1/accounts/{id}"}).apply(this,[t,...e]):(t==null&&[].shift.apply([t,...e]),k({method:"GET",fullPath:"/v1/account"}).apply(this,[t,...e]))},update:k({method:"POST",fullPath:"/v1/accounts/{account}"}),list:k({method:"GET",fullPath:"/v1/accounts",methodType:"list"}),del:k({method:"DELETE",fullPath:"/v1/accounts/{account}"}),createExternalAccount:k({method:"POST",fullPath:"/v1/accounts/{account}/external_accounts"}),createLoginLink:k({method:"POST",fullPath:"/v1/accounts/{account}/login_links"}),createPerson:k({method:"POST",fullPath:"/v1/accounts/{account}/persons"}),deleteExternalAccount:k({method:"DELETE",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),deletePerson:k({method:"DELETE",fullPath:"/v1/accounts/{account}/persons/{person}"}),listCapabilities:k({method:"GET",fullPath:"/v1/accounts/{account}/capabilities",methodType:"list"}),listExternalAccounts:k({method:"GET",fullPath:"/v1/accounts/{account}/external_accounts",methodType:"list"}),listPersons:k({method:"GET",fullPath:"/v1/accounts/{account}/persons",methodType:"list"}),reject:k({method:"POST",fullPath:"/v1/accounts/{account}/reject"}),retrieveCurrent:k({method:"GET",fullPath:"/v1/account"}),retrieveCapability:k({method:"GET",fullPath:"/v1/accounts/{account}/capabilities/{capability}"}),retrieveExternalAccount:k({method:"GET",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),retrievePerson:k({method:"GET",fullPath:"/v1/accounts/{account}/persons/{person}"}),updateCapability:k({method:"POST",fullPath:"/v1/accounts/{account}/capabilities/{capability}"}),updateExternalAccount:k({method:"POST",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),updatePerson:k({method:"POST",fullPath:"/v1/accounts/{account}/persons/{person}"})});var Za=n.method,In=n.extend({create:Za({method:"POST",fullPath:"/v1/account_links"})});var ec=n.method,kn=n.extend({create:ec({method:"POST",fullPath:"/v1/account_sessions"})});var Wt=n.method,Mn=n.extend({create:Wt({method:"POST",fullPath:"/v1/apple_pay/domains"}),retrieve:Wt({method:"GET",fullPath:"/v1/apple_pay/domains/{domain}"}),list:Wt({method:"GET",fullPath:"/v1/apple_pay/domains",methodType:"list"}),del:Wt({method:"DELETE",fullPath:"/v1/apple_pay/domains/{domain}"})});var Te=n.method,Dn=n.extend({retrieve:Te({method:"GET",fullPath:"/v1/application_fees/{id}"}),list:Te({method:"GET",fullPath:"/v1/application_fees",methodType:"list"}),createRefund:Te({method:"POST",fullPath:"/v1/application_fees/{id}/refunds"}),listRefunds:Te({method:"GET",fullPath:"/v1/application_fees/{id}/refunds",methodType:"list"}),retrieveRefund:Te({method:"GET",fullPath:"/v1/application_fees/{fee}/refunds/{id}"}),updateRefund:Te({method:"POST",fullPath:"/v1/application_fees/{fee}/refunds/{id}"})});var tc=n.method,jn=n.extend({retrieve:tc({method:"GET",fullPath:"/v1/balance"})});var Gn=n.method,Nn=n.extend({retrieve:Gn({method:"GET",fullPath:"/v1/balance_transactions/{id}"}),list:Gn({method:"GET",fullPath:"/v1/balance_transactions",methodType:"list"})});var _e=n.method,qn=n.extend({create:_e({method:"POST",fullPath:"/v1/charges"}),retrieve:_e({method:"GET",fullPath:"/v1/charges/{charge}"}),update:_e({method:"POST",fullPath:"/v1/charges/{charge}"}),list:_e({method:"GET",fullPath:"/v1/charges",methodType:"list"}),capture:_e({method:"POST",fullPath:"/v1/charges/{charge}/capture"}),search:_e({method:"GET",fullPath:"/v1/charges/search",methodType:"search"})});var rc=n.method,Hn=n.extend({retrieve:rc({method:"GET",fullPath:"/v1/confirmation_tokens/{confirmation_token}"})});var Ln=n.method,Un=n.extend({retrieve:Ln({method:"GET",fullPath:"/v1/country_specs/{country}"}),list:Ln({method:"GET",fullPath:"/v1/country_specs",methodType:"list"})});var ze=n.method,Fn=n.extend({create:ze({method:"POST",fullPath:"/v1/coupons"}),retrieve:ze({method:"GET",fullPath:"/v1/coupons/{coupon}"}),update:ze({method:"POST",fullPath:"/v1/coupons/{coupon}"}),list:ze({method:"GET",fullPath:"/v1/coupons",methodType:"list"}),del:ze({method:"DELETE",fullPath:"/v1/coupons/{coupon}"})});var X=n.method,$n=n.extend({create:X({method:"POST",fullPath:"/v1/credit_notes"}),retrieve:X({method:"GET",fullPath:"/v1/credit_notes/{id}"}),update:X({method:"POST",fullPath:"/v1/credit_notes/{id}"}),list:X({method:"GET",fullPath:"/v1/credit_notes",methodType:"list"}),listLineItems:X({method:"GET",fullPath:"/v1/credit_notes/{credit_note}/lines",methodType:"list"}),listPreviewLineItems:X({method:"GET",fullPath:"/v1/credit_notes/preview/lines",methodType:"list"}),preview:X({method:"GET",fullPath:"/v1/credit_notes/preview"}),voidCreditNote:X({method:"POST",fullPath:"/v1/credit_notes/{id}/void"})});var oc=n.method,Vn=n.extend({create:oc({method:"POST",fullPath:"/v1/customer_sessions"})});var w=n.method,Kn=n.extend({create:w({method:"POST",fullPath:"/v1/customers"}),retrieve:w({method:"GET",fullPath:"/v1/customers/{customer}"}),update:w({method:"POST",fullPath:"/v1/customers/{customer}"}),list:w({method:"GET",fullPath:"/v1/customers",methodType:"list"}),del:w({method:"DELETE",fullPath:"/v1/customers/{customer}"}),createBalanceTransaction:w({method:"POST",fullPath:"/v1/customers/{customer}/balance_transactions"}),createFundingInstructions:w({method:"POST",fullPath:"/v1/customers/{customer}/funding_instructions"}),createSource:w({method:"POST",fullPath:"/v1/customers/{customer}/sources"}),createTaxId:w({method:"POST",fullPath:"/v1/customers/{customer}/tax_ids"}),deleteDiscount:w({method:"DELETE",fullPath:"/v1/customers/{customer}/discount"}),deleteSource:w({method:"DELETE",fullPath:"/v1/customers/{customer}/sources/{id}"}),deleteTaxId:w({method:"DELETE",fullPath:"/v1/customers/{customer}/tax_ids/{id}"}),listBalanceTransactions:w({method:"GET",fullPath:"/v1/customers/{customer}/balance_transactions",methodType:"list"}),listCashBalanceTransactions:w({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance_transactions",methodType:"list"}),listPaymentMethods:w({method:"GET",fullPath:"/v1/customers/{customer}/payment_methods",methodType:"list"}),listSources:w({method:"GET",fullPath:"/v1/customers/{customer}/sources",methodType:"list"}),listTaxIds:w({method:"GET",fullPath:"/v1/customers/{customer}/tax_ids",methodType:"list"}),retrieveBalanceTransaction:w({method:"GET",fullPath:"/v1/customers/{customer}/balance_transactions/{transaction}"}),retrieveCashBalance:w({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance"}),retrieveCashBalanceTransaction:w({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance_transactions/{transaction}"}),retrievePaymentMethod:w({method:"GET",fullPath:"/v1/customers/{customer}/payment_methods/{payment_method}"}),retrieveSource:w({method:"GET",fullPath:"/v1/customers/{customer}/sources/{id}"}),retrieveTaxId:w({method:"GET",fullPath:"/v1/customers/{customer}/tax_ids/{id}"}),search:w({method:"GET",fullPath:"/v1/customers/search",methodType:"search"}),updateBalanceTransaction:w({method:"POST",fullPath:"/v1/customers/{customer}/balance_transactions/{transaction}"}),updateCashBalance:w({method:"POST",fullPath:"/v1/customers/{customer}/cash_balance"}),updateSource:w({method:"POST",fullPath:"/v1/customers/{customer}/sources/{id}"}),verifySource:w({method:"POST",fullPath:"/v1/customers/{customer}/sources/{id}/verify"})});var Jt=n.method,Bn=n.extend({retrieve:Jt({method:"GET",fullPath:"/v1/disputes/{dispute}"}),update:Jt({method:"POST",fullPath:"/v1/disputes/{dispute}"}),list:Jt({method:"GET",fullPath:"/v1/disputes",methodType:"list"}),close:Jt({method:"POST",fullPath:"/v1/disputes/{dispute}/close"})});var zn=n.method,Wn=n.extend({create:zn({method:"POST",fullPath:"/v1/ephemeral_keys",validator:(t,e)=>{if(!e.headers||!e.headers["Stripe-Version"])throw new Error("Passing apiVersion in a separate options hash is required to create an ephemeral key. See https://stripe.com/docs/api/versioning?lang=node")}}),del:zn({method:"DELETE",fullPath:"/v1/ephemeral_keys/{key}"})});var Jn=n.method,Yn=n.extend({retrieve:Jn({method:"GET",fullPath:"/v1/events/{id}"}),list:Jn({method:"GET",fullPath:"/v1/events",methodType:"list"})});var Xn=n.method,Qn=n.extend({retrieve:Xn({method:"GET",fullPath:"/v1/exchange_rates/{rate_id}"}),list:Xn({method:"GET",fullPath:"/v1/exchange_rates",methodType:"list"})});var Yt=n.method,Zn=n.extend({create:Yt({method:"POST",fullPath:"/v1/file_links"}),retrieve:Yt({method:"GET",fullPath:"/v1/file_links/{link}"}),update:Yt({method:"POST",fullPath:"/v1/file_links/{link}"}),list:Yt({method:"GET",fullPath:"/v1/file_links",methodType:"list"})});var sc=(t,e,r)=>{let o=(Math.round(Math.random()*1e16)+Math.round(Math.random()*1e16)).toString();r["Content-Type"]=`multipart/form-data; boundary=${o}`;let s=new TextEncoder,i=new Uint8Array(0),a=s.encode(`\r
`);function l(u){let h=i,f=u instanceof Uint8Array?u:new Uint8Array(s.encode(u));i=new Uint8Array(h.length+f.length+2),i.set(h),i.set(f,h.length),i.set(a,i.length-2)}function c(u){return`"${u.replace(/"|"/g,"%22").replace(/\r\n|\r|\n/g," ")}"`}let d=No(e);for(let u in d){if(!Object.prototype.hasOwnProperty.call(d,u))continue;let h=d[u];if(l(`--${o}`),Object.prototype.hasOwnProperty.call(h,"data")){let f=h;l(`Content-Disposition: form-data; name=${c(u)}; filename=${c(f.name||"blob")}`),l(`Content-Type: ${f.type||"application/octet-stream"}`),l(""),l(f.data)}else l(`Content-Disposition: form-data; name=${c(u)}`),l(""),l(h)}return l(`--${o}--`),i};function ei(t,e,r,o){if(e=e||{},t!=="POST")return o(null,J(e));this._stripe._platformFunctions.tryBufferData(e).then(s=>{let i=sc(t,s,r);return o(null,i)}).catch(s=>o(s,null))}var Yr=n.method,ti=n.extend({create:Yr({method:"POST",fullPath:"/v1/files",headers:{"Content-Type":"multipart/form-data"},host:"files.stripe.com"}),retrieve:Yr({method:"GET",fullPath:"/v1/files/{file}"}),list:Yr({method:"GET",fullPath:"/v1/files",methodType:"list"}),requestDataProcessor:ei});var We=n.method,ri=n.extend({create:We({method:"POST",fullPath:"/v1/invoiceitems"}),retrieve:We({method:"GET",fullPath:"/v1/invoiceitems/{invoiceitem}"}),update:We({method:"POST",fullPath:"/v1/invoiceitems/{invoiceitem}"}),list:We({method:"GET",fullPath:"/v1/invoiceitems",methodType:"list"}),del:We({method:"DELETE",fullPath:"/v1/invoiceitems/{invoiceitem}"})});var oi=n.method,si=n.extend({retrieve:oi({method:"GET",fullPath:"/v1/invoice_payments/{invoice_payment}"}),list:oi({method:"GET",fullPath:"/v1/invoice_payments",methodType:"list"})});var Xt=n.method,ni=n.extend({retrieve:Xt({method:"GET",fullPath:"/v1/invoice_rendering_templates/{template}"}),list:Xt({method:"GET",fullPath:"/v1/invoice_rendering_templates",methodType:"list"}),archive:Xt({method:"POST",fullPath:"/v1/invoice_rendering_templates/{template}/archive"}),unarchive:Xt({method:"POST",fullPath:"/v1/invoice_rendering_templates/{template}/unarchive"})});var G=n.method,ii=n.extend({create:G({method:"POST",fullPath:"/v1/invoices"}),retrieve:G({method:"GET",fullPath:"/v1/invoices/{invoice}"}),update:G({method:"POST",fullPath:"/v1/invoices/{invoice}"}),list:G({method:"GET",fullPath:"/v1/invoices",methodType:"list"}),del:G({method:"DELETE",fullPath:"/v1/invoices/{invoice}"}),addLines:G({method:"POST",fullPath:"/v1/invoices/{invoice}/add_lines"}),attachPayment:G({method:"POST",fullPath:"/v1/invoices/{invoice}/attach_payment"}),createPreview:G({method:"POST",fullPath:"/v1/invoices/create_preview"}),finalizeInvoice:G({method:"POST",fullPath:"/v1/invoices/{invoice}/finalize"}),listLineItems:G({method:"GET",fullPath:"/v1/invoices/{invoice}/lines",methodType:"list"}),markUncollectible:G({method:"POST",fullPath:"/v1/invoices/{invoice}/mark_uncollectible"}),pay:G({method:"POST",fullPath:"/v1/invoices/{invoice}/pay"}),removeLines:G({method:"POST",fullPath:"/v1/invoices/{invoice}/remove_lines"}),search:G({method:"GET",fullPath:"/v1/invoices/search",methodType:"search"}),sendInvoice:G({method:"POST",fullPath:"/v1/invoices/{invoice}/send"}),updateLines:G({method:"POST",fullPath:"/v1/invoices/{invoice}/update_lines"}),updateLineItem:G({method:"POST",fullPath:"/v1/invoices/{invoice}/lines/{line_item_id}"}),voidInvoice:G({method:"POST",fullPath:"/v1/invoices/{invoice}/void"})});var nc=n.method,ai=n.extend({retrieve:nc({method:"GET",fullPath:"/v1/mandates/{mandate}"})});var ci=n.method,Xr="connect.stripe.com",li=n.extend({basePath:"/",authorizeUrl(t,e){t=t||{},e=e||{};let r="oauth/authorize";return e.express&&(r=`express/${r}`),t.response_type||(t.response_type="code"),t.client_id||(t.client_id=this._stripe.getClientId()),t.scope||(t.scope="read_write"),`https://${Xr}/${r}?${J(t)}`},token:ci({method:"POST",path:"oauth/token",host:Xr}),deauthorize(t,...e){return t.client_id||(t.client_id=this._stripe.getClientId()),ci({method:"POST",path:"oauth/deauthorize",host:Xr}).apply(this,[t,...e])}});var U=n.method,ui=n.extend({create:U({method:"POST",fullPath:"/v1/payment_intents"}),retrieve:U({method:"GET",fullPath:"/v1/payment_intents/{intent}"}),update:U({method:"POST",fullPath:"/v1/payment_intents/{intent}"}),list:U({method:"GET",fullPath:"/v1/payment_intents",methodType:"list"}),applyCustomerBalance:U({method:"POST",fullPath:"/v1/payment_intents/{intent}/apply_customer_balance"}),cancel:U({method:"POST",fullPath:"/v1/payment_intents/{intent}/cancel"}),capture:U({method:"POST",fullPath:"/v1/payment_intents/{intent}/capture"}),confirm:U({method:"POST",fullPath:"/v1/payment_intents/{intent}/confirm"}),incrementAuthorization:U({method:"POST",fullPath:"/v1/payment_intents/{intent}/increment_authorization"}),search:U({method:"GET",fullPath:"/v1/payment_intents/search",methodType:"search"}),verifyMicrodeposits:U({method:"POST",fullPath:"/v1/payment_intents/{intent}/verify_microdeposits"})});var Je=n.method,di=n.extend({create:Je({method:"POST",fullPath:"/v1/payment_links"}),retrieve:Je({method:"GET",fullPath:"/v1/payment_links/{payment_link}"}),update:Je({method:"POST",fullPath:"/v1/payment_links/{payment_link}"}),list:Je({method:"GET",fullPath:"/v1/payment_links",methodType:"list"}),listLineItems:Je({method:"GET",fullPath:"/v1/payment_links/{payment_link}/line_items",methodType:"list"})});var Qt=n.method,hi=n.extend({create:Qt({method:"POST",fullPath:"/v1/payment_method_configurations"}),retrieve:Qt({method:"GET",fullPath:"/v1/payment_method_configurations/{configuration}"}),update:Qt({method:"POST",fullPath:"/v1/payment_method_configurations/{configuration}"}),list:Qt({method:"GET",fullPath:"/v1/payment_method_configurations",methodType:"list"})});var Ye=n.method,pi=n.extend({create:Ye({method:"POST",fullPath:"/v1/payment_method_domains"}),retrieve:Ye({method:"GET",fullPath:"/v1/payment_method_domains/{payment_method_domain}"}),update:Ye({method:"POST",fullPath:"/v1/payment_method_domains/{payment_method_domain}"}),list:Ye({method:"GET",fullPath:"/v1/payment_method_domains",methodType:"list"}),validate:Ye({method:"POST",fullPath:"/v1/payment_method_domains/{payment_method_domain}/validate"})});var Se=n.method,mi=n.extend({create:Se({method:"POST",fullPath:"/v1/payment_methods"}),retrieve:Se({method:"GET",fullPath:"/v1/payment_methods/{payment_method}"}),update:Se({method:"POST",fullPath:"/v1/payment_methods/{payment_method}"}),list:Se({method:"GET",fullPath:"/v1/payment_methods",methodType:"list"}),attach:Se({method:"POST",fullPath:"/v1/payment_methods/{payment_method}/attach"}),detach:Se({method:"POST",fullPath:"/v1/payment_methods/{payment_method}/detach"})});var Ee=n.method,fi=n.extend({create:Ee({method:"POST",fullPath:"/v1/payouts"}),retrieve:Ee({method:"GET",fullPath:"/v1/payouts/{payout}"}),update:Ee({method:"POST",fullPath:"/v1/payouts/{payout}"}),list:Ee({method:"GET",fullPath:"/v1/payouts",methodType:"list"}),cancel:Ee({method:"POST",fullPath:"/v1/payouts/{payout}/cancel"}),reverse:Ee({method:"POST",fullPath:"/v1/payouts/{payout}/reverse"})});var Xe=n.method,gi=n.extend({create:Xe({method:"POST",fullPath:"/v1/plans"}),retrieve:Xe({method:"GET",fullPath:"/v1/plans/{plan}"}),update:Xe({method:"POST",fullPath:"/v1/plans/{plan}"}),list:Xe({method:"GET",fullPath:"/v1/plans",methodType:"list"}),del:Xe({method:"DELETE",fullPath:"/v1/plans/{plan}"})});var Qe=n.method,vi=n.extend({create:Qe({method:"POST",fullPath:"/v1/prices"}),retrieve:Qe({method:"GET",fullPath:"/v1/prices/{price}"}),update:Qe({method:"POST",fullPath:"/v1/prices/{price}"}),list:Qe({method:"GET",fullPath:"/v1/prices",methodType:"list"}),search:Qe({method:"GET",fullPath:"/v1/prices/search",methodType:"search"})});var $=n.method,yi=n.extend({create:$({method:"POST",fullPath:"/v1/products"}),retrieve:$({method:"GET",fullPath:"/v1/products/{id}"}),update:$({method:"POST",fullPath:"/v1/products/{id}"}),list:$({method:"GET",fullPath:"/v1/products",methodType:"list"}),del:$({method:"DELETE",fullPath:"/v1/products/{id}"}),createFeature:$({method:"POST",fullPath:"/v1/products/{product}/features"}),deleteFeature:$({method:"DELETE",fullPath:"/v1/products/{product}/features/{id}"}),listFeatures:$({method:"GET",fullPath:"/v1/products/{product}/features",methodType:"list"}),retrieveFeature:$({method:"GET",fullPath:"/v1/products/{product}/features/{id}"}),search:$({method:"GET",fullPath:"/v1/products/search",methodType:"search"})});var Zt=n.method,Pi=n.extend({create:Zt({method:"POST",fullPath:"/v1/promotion_codes"}),retrieve:Zt({method:"GET",fullPath:"/v1/promotion_codes/{promotion_code}"}),update:Zt({method:"POST",fullPath:"/v1/promotion_codes/{promotion_code}"}),list:Zt({method:"GET",fullPath:"/v1/promotion_codes",methodType:"list"})});var V=n.method,Ti=n.extend({create:V({method:"POST",fullPath:"/v1/quotes"}),retrieve:V({method:"GET",fullPath:"/v1/quotes/{quote}"}),update:V({method:"POST",fullPath:"/v1/quotes/{quote}"}),list:V({method:"GET",fullPath:"/v1/quotes",methodType:"list"}),accept:V({method:"POST",fullPath:"/v1/quotes/{quote}/accept"}),cancel:V({method:"POST",fullPath:"/v1/quotes/{quote}/cancel"}),finalizeQuote:V({method:"POST",fullPath:"/v1/quotes/{quote}/finalize"}),listComputedUpfrontLineItems:V({method:"GET",fullPath:"/v1/quotes/{quote}/computed_upfront_line_items",methodType:"list"}),listLineItems:V({method:"GET",fullPath:"/v1/quotes/{quote}/line_items",methodType:"list"}),pdf:V({method:"GET",fullPath:"/v1/quotes/{quote}/pdf",host:"files.stripe.com",streaming:!0})});var Ze=n.method,_i=n.extend({create:Ze({method:"POST",fullPath:"/v1/refunds"}),retrieve:Ze({method:"GET",fullPath:"/v1/refunds/{refund}"}),update:Ze({method:"POST",fullPath:"/v1/refunds/{refund}"}),list:Ze({method:"GET",fullPath:"/v1/refunds",methodType:"list"}),cancel:Ze({method:"POST",fullPath:"/v1/refunds/{refund}/cancel"})});var Qr=n.method,Si=n.extend({retrieve:Qr({method:"GET",fullPath:"/v1/reviews/{review}"}),list:Qr({method:"GET",fullPath:"/v1/reviews",methodType:"list"}),approve:Qr({method:"POST",fullPath:"/v1/reviews/{review}/approve"})});var ic=n.method,Ei=n.extend({list:ic({method:"GET",fullPath:"/v1/setup_attempts",methodType:"list"})});var ne=n.method,xi=n.extend({create:ne({method:"POST",fullPath:"/v1/setup_intents"}),retrieve:ne({method:"GET",fullPath:"/v1/setup_intents/{intent}"}),update:ne({method:"POST",fullPath:"/v1/setup_intents/{intent}"}),list:ne({method:"GET",fullPath:"/v1/setup_intents",methodType:"list"}),cancel:ne({method:"POST",fullPath:"/v1/setup_intents/{intent}/cancel"}),confirm:ne({method:"POST",fullPath:"/v1/setup_intents/{intent}/confirm"}),verifyMicrodeposits:ne({method:"POST",fullPath:"/v1/setup_intents/{intent}/verify_microdeposits"})});var er=n.method,wi=n.extend({create:er({method:"POST",fullPath:"/v1/shipping_rates"}),retrieve:er({method:"GET",fullPath:"/v1/shipping_rates/{shipping_rate_token}"}),update:er({method:"POST",fullPath:"/v1/shipping_rates/{shipping_rate_token}"}),list:er({method:"GET",fullPath:"/v1/shipping_rates",methodType:"list"})});var et=n.method,bi=n.extend({create:et({method:"POST",fullPath:"/v1/sources"}),retrieve:et({method:"GET",fullPath:"/v1/sources/{source}"}),update:et({method:"POST",fullPath:"/v1/sources/{source}"}),listSourceTransactions:et({method:"GET",fullPath:"/v1/sources/{source}/source_transactions",methodType:"list"}),verify:et({method:"POST",fullPath:"/v1/sources/{source}/verify"})});var tt=n.method,Oi=n.extend({create:tt({method:"POST",fullPath:"/v1/subscription_items"}),retrieve:tt({method:"GET",fullPath:"/v1/subscription_items/{item}"}),update:tt({method:"POST",fullPath:"/v1/subscription_items/{item}"}),list:tt({method:"GET",fullPath:"/v1/subscription_items",methodType:"list"}),del:tt({method:"DELETE",fullPath:"/v1/subscription_items/{item}"})});var xe=n.method,Ri=n.extend({create:xe({method:"POST",fullPath:"/v1/subscription_schedules"}),retrieve:xe({method:"GET",fullPath:"/v1/subscription_schedules/{schedule}"}),update:xe({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}"}),list:xe({method:"GET",fullPath:"/v1/subscription_schedules",methodType:"list"}),cancel:xe({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}/cancel"}),release:xe({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}/release"})});var K=n.method,Ai=n.extend({create:K({method:"POST",fullPath:"/v1/subscriptions"}),retrieve:K({method:"GET",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),update:K({method:"POST",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),list:K({method:"GET",fullPath:"/v1/subscriptions",methodType:"list"}),cancel:K({method:"DELETE",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),deleteDiscount:K({method:"DELETE",fullPath:"/v1/subscriptions/{subscription_exposed_id}/discount"}),migrate:K({method:"POST",fullPath:"/v1/subscriptions/{subscription}/migrate"}),resume:K({method:"POST",fullPath:"/v1/subscriptions/{subscription}/resume"}),search:K({method:"GET",fullPath:"/v1/subscriptions/search",methodType:"search"})});var Ci=n.method,Ii=n.extend({retrieve:Ci({method:"GET",fullPath:"/v1/tax_codes/{id}"}),list:Ci({method:"GET",fullPath:"/v1/tax_codes",methodType:"list"})});var tr=n.method,ki=n.extend({create:tr({method:"POST",fullPath:"/v1/tax_ids"}),retrieve:tr({method:"GET",fullPath:"/v1/tax_ids/{id}"}),list:tr({method:"GET",fullPath:"/v1/tax_ids",methodType:"list"}),del:tr({method:"DELETE",fullPath:"/v1/tax_ids/{id}"})});var rr=n.method,Mi=n.extend({create:rr({method:"POST",fullPath:"/v1/tax_rates"}),retrieve:rr({method:"GET",fullPath:"/v1/tax_rates/{tax_rate}"}),update:rr({method:"POST",fullPath:"/v1/tax_rates/{tax_rate}"}),list:rr({method:"GET",fullPath:"/v1/tax_rates",methodType:"list"})});var Di=n.method,ji=n.extend({create:Di({method:"POST",fullPath:"/v1/tokens"}),retrieve:Di({method:"GET",fullPath:"/v1/tokens/{token}"})});var rt=n.method,Gi=n.extend({create:rt({method:"POST",fullPath:"/v1/topups"}),retrieve:rt({method:"GET",fullPath:"/v1/topups/{topup}"}),update:rt({method:"POST",fullPath:"/v1/topups/{topup}"}),list:rt({method:"GET",fullPath:"/v1/topups",methodType:"list"}),cancel:rt({method:"POST",fullPath:"/v1/topups/{topup}/cancel"})});var Q=n.method,Ni=n.extend({create:Q({method:"POST",fullPath:"/v1/transfers"}),retrieve:Q({method:"GET",fullPath:"/v1/transfers/{transfer}"}),update:Q({method:"POST",fullPath:"/v1/transfers/{transfer}"}),list:Q({method:"GET",fullPath:"/v1/transfers",methodType:"list"}),createReversal:Q({method:"POST",fullPath:"/v1/transfers/{id}/reversals"}),listReversals:Q({method:"GET",fullPath:"/v1/transfers/{id}/reversals",methodType:"list"}),retrieveReversal:Q({method:"GET",fullPath:"/v1/transfers/{transfer}/reversals/{id}"}),updateReversal:Q({method:"POST",fullPath:"/v1/transfers/{transfer}/reversals/{id}"})});var ot=n.method,qi=n.extend({create:ot({method:"POST",fullPath:"/v1/webhook_endpoints"}),retrieve:ot({method:"GET",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"}),update:ot({method:"POST",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"}),list:ot({method:"GET",fullPath:"/v1/webhook_endpoints",methodType:"list"}),del:ot({method:"DELETE",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"})});var ac=R("apps",{Secrets:nn}),cc=R("billing",{Alerts:Xo,CreditBalanceSummary:cs,CreditBalanceTransactions:us,CreditGrants:ds,MeterEventAdjustments:ws,MeterEvents:As,Meters:Is}),lc=R("billingPortal",{Configurations:ss,Sessions:an}),uc=R("checkout",{Sessions:cn}),dc=R("climate",{Orders:ks,Products:Fs,Suppliers:mn}),hc=R("entitlements",{ActiveEntitlements:Yo,Features:Ts}),pc=R("financialConnections",{Accounts:Wo,Sessions:un,Transactions:Tn}),mc=R("forwarding",{Requests:rn}),fc=R("identity",{VerificationReports:An,VerificationSessions:Cn}),gc=R("issuing",{Authorizations:Qo,Cardholders:ts,Cards:rs,Disputes:fs,PersonalizationDesigns:Ns,PhysicalBundles:Ls,Tokens:gn,Transactions:_n}),vc=R("radar",{EarlyFraudWarnings:vs,ValueListItems:bn,ValueLists:On}),yc=R("reporting",{ReportRuns:Zs,ReportTypes:tn}),Pc=R("sigma",{ScheduledQueryRuns:sn}),Tc=R("tax",{Calculations:es,Registrations:Qs,Settings:hn,Transactions:Sn}),_c=R("terminal",{Configurations:ns,ConnectionTokens:as,Locations:xs,Readers:$s}),Sc=R("testHelpers",{ConfirmationTokens:is,Customers:ps,Refunds:Xs,TestClocks:fn,Issuing:R("issuing",{Authorizations:Zo,Cards:os,PersonalizationDesigns:qs,Transactions:En}),Terminal:R("terminal",{Readers:Vs}),Treasury:R("treasury",{InboundTransfers:Ss,OutboundPayments:Ms,OutboundTransfers:js,ReceivedCredits:Ks,ReceivedDebits:Ws})}),Ec=R("treasury",{CreditReversals:hs,DebitReversals:ms,FinancialAccounts:_s,InboundTransfers:Es,OutboundPayments:Ds,OutboundTransfers:Gs,ReceivedCredits:zs,ReceivedDebits:Ys,TransactionEntries:yn,Transactions:wn}),xc=R("v2",{Billing:R("billing",{MeterEventAdjustments:bs,MeterEventSession:Os,MeterEventStream:Rs,MeterEvents:Cs}),Core:R("core",{EventDestinations:ys,Events:Ps})});var Hi="api.stripe.com",Li="443",Ui="/v1/",Fi=Gr,$i=8e4,Vi=5,Ki=.5,wc=["name","version","url","partner_id"],Bi=["authenticator","apiVersion","typescript","maxNetworkRetries","httpAgent","httpClient","timeout","host","port","protocol","telemetry","appInfo","stripeAccount","stripeContext"],bc=t=>new kt(t,n.MAX_BUFFERED_REQUEST_METRICS);function zi(t,e=bc){r.PACKAGE_VERSION="18.5.0",r.API_VERSION=Gr,r.USER_AGENT=Object.assign({bindings_version:r.PACKAGE_VERSION,lang:"node",publisher:"stripe",uname:null,typescript:!1},qo()),r.StripeResource=n,r.resources=we,r.HttpClient=N,r.HttpClientResponse=W,r.CryptoProvider=z,r.webhooks=zo(t);function r(o,s={}){if(!(this instanceof r))return new r(o,s);let i=this._getPropsFromConfig(s);this._platformFunctions=t,Object.defineProperty(this,"_emitter",{value:this._platformFunctions.createEmitter(),enumerable:!1,configurable:!1,writable:!1}),this.VERSION=r.PACKAGE_VERSION,this.on=this._emitter.on.bind(this._emitter),this.once=this._emitter.once.bind(this._emitter),this.off=this._emitter.removeListener.bind(this._emitter);let a=i.httpAgent||null;this._api={host:i.host||Hi,port:i.port||Li,protocol:i.protocol||"https",basePath:Ui,version:i.apiVersion||Fi,timeout:Tt("timeout",i.timeout,$i),maxNetworkRetries:Tt("maxNetworkRetries",i.maxNetworkRetries,2),agent:a,httpClient:i.httpClient||(a?this._platformFunctions.createNodeHttpClient(a):this._platformFunctions.createDefaultHttpClient()),dev:!1,stripeAccount:i.stripeAccount||null,stripeContext:i.stripeContext||null};let l=i.typescript||!1;l!==r.USER_AGENT.typescript&&(r.USER_AGENT.typescript=l),i.appInfo&&this._setAppInfo(i.appInfo),this._prepResources(),this._setAuthenticator(o,i.authenticator),this.errors=Ct,this.webhooks=r.webhooks,this._prevRequestMetrics=[],this._enableTelemetry=i.telemetry!==!1,this._requestSender=e(this),this.StripeResource=r.StripeResource}return r.errors=Ct,r.createNodeHttpClient=t.createNodeHttpClient,r.createFetchHttpClient=t.createFetchHttpClient,r.createNodeCryptoProvider=t.createNodeCryptoProvider,r.createSubtleCryptoProvider=t.createSubtleCryptoProvider,r.prototype={_appInfo:void 0,on:null,off:null,once:null,VERSION:null,StripeResource:null,webhooks:null,errors:null,_api:null,_prevRequestMetrics:null,_emitter:null,_enableTelemetry:null,_requestSender:null,_platformFunctions:null,rawRequest(o,s,i,a){return this._requestSender._rawRequest(o,s,i,a)},_setAuthenticator(o,s){if(o&&s)throw new Error("Can't specify both apiKey and authenticator");if(!o&&!s)throw new Error("Neither apiKey nor config.authenticator provided");this._authenticator=o?gt(o):s},_setAppInfo(o){if(o&&typeof o!="object")throw new Error("AppInfo must be an object.");if(o&&!o.name)throw new Error("AppInfo.name is required");o=o||{},this._appInfo=wc.reduce((s,i)=>(typeof o[i]=="string"&&(s=s||{},s[i]=o[i]),s),{})},_setApiField(o,s){this._api[o]=s},getApiField(o){return this._api[o]},setClientId(o){this._clientId=o},getClientId(){return this._clientId},getConstant:o=>{switch(o){case"DEFAULT_HOST":return Hi;case"DEFAULT_PORT":return Li;case"DEFAULT_BASE_PATH":return Ui;case"DEFAULT_API_VERSION":return Fi;case"DEFAULT_TIMEOUT":return $i;case"MAX_NETWORK_RETRY_DELAY_SEC":return Vi;case"INITIAL_NETWORK_RETRY_DELAY_SEC":return Ki}return r[o]},getMaxNetworkRetries(){return this.getApiField("maxNetworkRetries")},_setApiNumberField(o,s,i){let a=Tt(o,s,i);this._setApiField(o,a)},getMaxNetworkRetryDelay(){return Vi},getInitialNetworkRetryDelay(){return Ki},getClientUserAgent(o){return this.getClientUserAgentSeeded(r.USER_AGENT,o)},getClientUserAgentSeeded(o,s){this._platformFunctions.getUname().then(i=>{var a;let l={};for(let d in o)Object.prototype.hasOwnProperty.call(o,d)&&(l[d]=encodeURIComponent((a=o[d])!==null&&a!==void 0?a:"null"));l.uname=encodeURIComponent(i||"UNKNOWN");let c=this.getApiField("httpClient");c&&(l.httplib=encodeURIComponent(c.getClientName())),this._appInfo&&(l.application=this._appInfo),s(JSON.stringify(l))})},getAppInfoAsString(){if(!this._appInfo)return"";let o=this._appInfo.name;return this._appInfo.version&&(o+=`/${this._appInfo.version}`),this._appInfo.url&&(o+=` (${this._appInfo.url})`),o},getTelemetryEnabled(){return this._enableTelemetry},_prepResources(){for(let o in we)Object.prototype.hasOwnProperty.call(we,o)&&(this[Go(o)]=new we[o](this))},_getPropsFromConfig(o){if(!o)return{};let s=typeof o=="string";if(!(o===Object(o)&&!Array.isArray(o))&&!s)throw new Error("Config must either be an object or a string");if(s)return{apiVersion:o};if(Object.keys(o).filter(l=>!Bi.includes(l)).length>0)throw new Error(`Config object may only contain the following: ${Bi.join(", ")}`);return o},parseThinEvent(o,s,i,a,l,c){return this.webhooks.constructEvent(o,s,i,a,l,c)}},r}var Oc=zi(new It),B=Oc;function x(t){console.log("Available env bindings:",Object.keys(t));let e=["OPENSHOP-TEST3_KV","OPENSHOP_TEST3_KV","OPENSHOP_KV"];for(let s of e)if(s in t&&t[s]){console.log(`Found KV namespace via direct access: ${s}`);let i=t[s];return console.log("KV namespace object:",!!i,typeof i),console.log("KV namespace has get method:",typeof i?.get),i}let r=Object.keys(t).find(s=>s.endsWith("_KV")||s.endsWith("-KV")||s.includes("KV"));if(console.log("Found KV binding name via search:",r),r){let s=t[r];if(console.log("KV namespace object via search:",!!s,typeof s),s)return s}let o=Object.values(t).find(s=>s&&typeof s.get=="function"&&typeof s.put=="function");return console.log("Fallback KV namespace found:",!!o),o||(console.error("No KV namespace found! Available bindings:",Object.keys(t)),console.error("Environment values:",Object.values(t).map(s=>typeof s))),o}var _=new fr,Rc=["primary","secondary","accent","text","background","card"],Ac=new Set(Tr.map(t=>t.id));function Wi(){let t=typeof globalThis<"u"?globalThis.crypto:null;if(!t)throw new Error("Web Crypto API is not available in this environment");return t}function Ji(t=16){let e=Wi();if(typeof e.getRandomValues!="function")throw new Error("crypto.getRandomValues is not available");let r=new Uint8Array(t);return e.getRandomValues(r),Array.from(r,o=>o.toString(16).padStart(2,"0")).join("")}function Yi(){let t=Wi();return typeof t.randomUUID=="function"?t.randomUUID().replace(/-/g,""):Ji(32)}function Cc(t){if(!t||typeof t!="object")return{valid:!1,message:"Invalid theme payload"};let e=t.colors;if(!e||typeof e!="object")return{valid:!1,message:"Missing colors object"};for(let o of Rc){let s=typeof e[o]=="string"?e[o].trim():"";if(!Pr.test(s))return{valid:!1,message:`Invalid ${o} color`}}let r=t.typography?.fontId??t.typography?.font??t.fontId??t.font;if(r&&!Ac.has(r))return{valid:!1,message:"Invalid font selection"};if(t.corners){if(t.corners.radiusMultiplier!==void 0){let o=Number(t.corners.radiusMultiplier);if(!Number.isFinite(o)||o<0||o>4)return{valid:!1,message:"Radius multiplier must be between 0 and 4"}}if(t.corners.enabled!==void 0&&typeof t.corners.enabled!="boolean")return{valid:!1,message:"Corners enabled must be a boolean"}}return{valid:!0}}_.use("*",_o({origin:["*"],allowMethods:["GET","POST","PUT","DELETE","OPTIONS"],allowHeaders:["Content-Type","X-Admin-Token"]}));_.get("/api/health",t=>t.json({status:"healthy",timestamp:new Date().toISOString()}));_.get("/api/image-proxy",async t=>{try{let e=t.req.query("src");if(!e)return t.json({error:"Missing src"},400);let r;try{let a=new URL(e);if(!["drive.google.com","drive.usercontent.google.com","lh3.googleusercontent.com"].some(d=>a.hostname===d||a.hostname.endsWith("."+d)))return t.json({error:"Host not allowed"},400);if(a.hostname.endsWith("drive.google.com")){let d=a.pathname.match(/\/file\/d\/([a-zA-Z0-9_-]+)/),u=a.searchParams.get("id"),h=d&&d[1]||u;if(!h)return t.json({error:"Missing Google Drive file id"},400);r=`https://drive.usercontent.google.com/download?id=${h}&export=view`}else if(a.hostname.endsWith("drive.usercontent.google.com")){let d=a.searchParams.get("id");if(!d)return t.json({error:"Missing Google Drive file id"},400);let u=new URL("https://drive.usercontent.google.com/download");u.searchParams.set("id",d),u.searchParams.set("export","view"),r=u.toString()}else r=a.toString()}catch{return t.json({error:"Invalid src url"},400)}let o=await fetch(r,{redirect:"follow",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123 Safari/537.36",Accept:"image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9",Referer:"https://drive.google.com/"},cf:{cacheEverything:!0}});if(!o.ok)return t.json({error:"Upstream error",status:o.status},o.status);let s=new Headers,i=o.headers.get("content-type")||"image/jpeg";return s.set("Content-Type",i),s.set("Cache-Control","public, max-age=86400"),s.set("Access-Control-Allow-Origin","*"),s.set("Cross-Origin-Resource-Policy","cross-origin"),new Response(o.body,{headers:s})}catch(e){return console.error("Image proxy error",e),t.json({error:"Proxy failed"},500)}});_.get("/api/products",async t=>{try{let o=(await new C(x(t.env)).getAllProducts()).filter(s=>!s.archived);return t.json(o)}catch(e){return console.error("Error fetching products:",e),t.json({error:"Failed to fetch products"},500)}});_.get("/api/products/:id",async t=>{try{let r=await new C(x(t.env)).getProduct(t.req.param("id"));return r?t.json(r):t.json({error:"Product not found"},404)}catch(e){return console.error("Error fetching product:",e),t.json({error:"Failed to fetch product"},500)}});_.get("/api/collections",async t=>{try{let o=(await new C(x(t.env)).getAllCollections()).filter(s=>!s.archived);return t.json(o)}catch(e){return console.error("Error fetching collections:",e),t.json({error:"Failed to fetch collections"},500)}});_.get("/api/collections/:id",async t=>{try{let r=await new C(x(t.env)).getCollection(t.req.param("id"));return r?t.json(r):t.json({error:"Collection not found"},404)}catch(e){return console.error("Error fetching collection:",e),t.json({error:"Failed to fetch collection"},500)}});_.get("/api/collections/:id/products",async t=>{try{let e=new C(x(t.env)),r=await e.getProductsByCollection(t.req.param("id")),o=await e.getCollection(t.req.param("id")),s=o&&o.archived?[]:r.filter(i=>!i.archived);return t.json(s)}catch(e){return console.error("Error fetching collection products:",e),t.json({error:"Failed to fetch collection products"},500)}});_.get("/api/storefront/theme",async t=>{try{let e=x(t.env),r=e?await e.get(Ce):null,o=null;if(r)try{o=JSON.parse(r)}catch(i){console.error("Invalid theme JSON in KV, falling back to defaults:",i)}let s=le(o||M);return t.json(s)}catch(e){return console.error("Error fetching storefront theme:",e),t.json(le(M),200)}});_.get("/api/store-settings",async t=>{try{let r=await new C(x(t.env)).namespace.get("store:settings"),o={logoType:"text",logoText:"OpenShop",logoImageUrl:"",storeName:"OpenShop",storeDescription:"Your amazing online store",heroImageUrl:"",heroTitle:"Welcome to OpenShop",heroSubtitle:"Discover amazing products at unbeatable prices. Built on Cloudflare for lightning-fast performance.",contactEmail:"contact@example.com",businessName:"",businessAddressLine1:"",businessAddressLine2:"",businessCity:"",businessState:"",businessPostalCode:"",businessCountry:""};return r?t.json(JSON.parse(r)):t.json(o)}catch(e){return console.error("Error fetching store settings:",e),t.json({error:"Failed to fetch store settings"},500)}});_.get("/api/contact-email",async t=>{try{let r=await new C(x(t.env)).namespace.get("store:settings");if(r){let o=JSON.parse(r);return t.json({email:o.contactEmail||"contact@example.com"})}else return t.json({email:"contact@example.com"})}catch(e){return console.error("Error fetching contact email:",e),t.json({email:"contact@example.com"})}});_.post("/api/create-checkout-session",async t=>{try{let{priceId:e}=await t.req.json();if(!e)return t.json({error:"Price ID is required"},400);let o=await new B(t.env.STRIPE_SECRET_KEY).checkout.sessions.create({payment_method_types:["card"],line_items:[{price:e,quantity:1}],mode:"payment",shipping_address_collection:{allowed_countries:["US","CA","GB","AU","DE","FR","IT","ES","NL","BE","AT","CH","SE","NO","DK","FI","IE","PT","PL","CZ","HU","GR","RO","BG","HR","SI","SK","EE","LV","LT","LU","MT","CY"]},billing_address_collection:"required",success_url:`${t.env.SITE_URL}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${t.env.SITE_URL}/`});return t.json({sessionId:o.id})}catch(e){return console.error("Error creating checkout session:",e),t.json({error:"Failed to create checkout session"},500)}});_.post("/api/create-cart-checkout-session",async t=>{try{let{items:e}=await t.req.json();if(!e||!Array.isArray(e)||e.length===0)return t.json({error:"Cart items are required"},400);let r=new B(t.env.STRIPE_SECRET_KEY),o=e.map(a=>{let l={price:a.stripePriceId,quantity:a.quantity},c=[];return a.name&&c.push(a.name),a.selectedVariant?.name&&c.push(a.selectedVariant.name),a.selectedVariant2?.name&&c.push(a.selectedVariant2.name),c.length>0&&(l.description=c.join(" - ")),l}),s={order_type:"cart_checkout",item_count:e.length.toString(),total_quantity:e.reduce((a,l)=>a+l.quantity,0).toString()};e.forEach((a,l)=>{let c=a.name||`Item ${l+1}`;s[`item_${l}_name`]=c,a.selectedVariant?.name&&(s[`item_${l}_variant1`]=a.selectedVariant.name),a.selectedVariant2?.name&&(s[`item_${l}_variant2`]=a.selectedVariant2.name)});let i=await r.checkout.sessions.create({payment_method_types:["card"],line_items:o,mode:"payment",shipping_address_collection:{allowed_countries:["US","CA","GB","AU","DE","FR","IT","ES","NL","BE","AT","CH","SE","NO","DK","FI","IE","PT","PL","CZ","HU","GR","RO","BG","HR","SI","SK","EE","LV","LT","LU","MT","CY"]},billing_address_collection:"required",success_url:`${t.env.SITE_URL}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${t.env.SITE_URL}/`,metadata:s});return t.json({sessionId:i.id})}catch(e){return console.error("Error creating cart checkout session:",e),t.json({error:"Failed to create checkout session"},500)}});_.get("/api/checkout-session/:sessionId",async t=>{try{let e=t.req.param("sessionId"),o=await new B(t.env.STRIPE_SECRET_KEY).checkout.sessions.retrieve(e);return t.json({id:o.id,amount_total:o.amount_total,currency:o.currency,customer_email:o.customer_details?.email,payment_status:o.payment_status,created:o.created})}catch(e){return console.error("Error fetching checkout session:",e),t.json({error:"Failed to fetch checkout session"},500)}});_.use("/api/admin/*",async(t,e)=>{if(new Set(["/api/admin/login","/api/admin/drive/oauth/start","/api/admin/drive/oauth/callback"]).has(t.req.path))return e();try{let o=await So(t.req,t.env);return o.isValid?e():(console.error("Auth failed:",o.error),t.json({error:o.error},o.status))}catch(o){return console.error("Auth middleware error:",o),t.json({error:"Authentication middleware failed"},500)}});_.post("/api/admin/ai/generate-image",async t=>{try{let{prompt:e,inputs:r}=await t.req.json();if(!e||typeof e!="string")return t.json({error:"Missing prompt"},400);let o=[];if(o.push({text:e}),Array.isArray(r))for(let h of r.slice(0,4))h&&h.dataBase64&&h.mimeType&&o.push({inline_data:{mime_type:h.mimeType,data:h.dataBase64}});let s=t.env.GEMINI_API_KEY;if(!s)return t.json({error:"GEMINI_API_KEY not configured"},500);let a=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent",{method:"POST",headers:{"x-goog-api-key":s,"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:o}]})});if(!a.ok){let h=await a.text();return console.error("Gemini API error",a.status,h),t.json({error:"Gemini API failed",details:h},a.status)}let c=(await a.json())?.candidates||[],d=null,u="image/png";for(let h of c){let f=h?.content?.parts||[];for(let g of f){let p=g?.inlineData||g?.inline_data;if(p&&p.data){d=p.data,u=p.mimeType||p.mime_type||u;break}}if(d)break}return d?t.json({mimeType:u,dataBase64:d}):t.json({error:"No image returned from Gemini"},502)}catch(e){return console.error("AI generation error",e),t.json({error:"Generation failed"},500)}});var be="drive:oauth:tokens",Xi="drive:folder";_.get("/api/admin/drive/status",async t=>{try{let r=await x(t.env).get(be);if(!r)return t.json({connected:!1});let o=JSON.parse(r);return t.json({connected:!!o?.access_token})}catch{return t.json({connected:!1})}});_.post("/api/admin/drive/disconnect",async t=>{try{let e=x(t.env);if(!e)return t.json({error:"KV namespace not available"},500);await e.delete(be);let r=await e.list({prefix:Xi});for(let o of r.keys)await e.delete(o.name);return t.json({success:!0})}catch(e){return console.error("Error disconnecting Google Drive:",e),t.json({error:"Failed to disconnect Google Drive"},500)}});_.get("/api/admin/drive/oauth/start",async t=>{try{let e=t.env.GOOGLE_CLIENT_ID,o=`${new URL(t.req.url).origin}/api/admin/drive/oauth/callback`;if(!e||!o)return t.json({error:"Drive OAuth not configured"},500);let s=new URLSearchParams;s.set("response_type","code"),s.set("client_id",e),s.set("redirect_uri",o),s.set("scope","https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.file"),s.set("access_type","offline"),s.set("prompt","consent"),s.set("include_granted_scopes","true");let i=`https://accounts.google.com/o/oauth2/v2/auth?${s.toString()}`;return t.redirect(i,302)}catch(e){return console.error("Drive oauth start error",e),t.json({error:"OAuth start failed"},500)}});_.get("/api/admin/drive/oauth/callback",async t=>{try{let e=t.req.query("code");if(!e)return t.text("Missing code",400);let r=t.env.GOOGLE_CLIENT_ID,o=t.env.GOOGLE_CLIENT_SECRET,i=`${new URL(t.req.url).origin}/api/admin/drive/oauth/callback`;if(!r||!o)return t.text("OAuth not configured",500);let a=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:e,client_id:r,client_secret:o,redirect_uri:i,grant_type:"authorization_code"})});if(!a.ok){let u=await a.text();return console.error("Token exchange failed",u),t.text("Token exchange failed",500)}let l=await a.json(),c=Math.floor(Date.now()/1e3),d={access_token:l.access_token,refresh_token:l.refresh_token||null,scope:l.scope,token_type:l.token_type,expiry:c+(l.expires_in||3600)-30};return await x(t.env).put(be,JSON.stringify(d)),t.html("<!doctype html><html><body><p>Google Drive connected. You can close this window.</p><script>setTimeout(()=>window.close(),500)</script></body></html>")}catch(e){return console.error("Drive oauth callback error",e),t.text("OAuth callback failed",500)}});async function Zr(t){let e=x(t),r=await e.get(be);if(!r)throw new Error("Drive not connected");let o=JSON.parse(r),s=Math.floor(Date.now()/1e3);if(o.expiry&&o.expiry>s+60||!o.refresh_token)return o;let i=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:t.GOOGLE_CLIENT_ID,client_secret:t.GOOGLE_CLIENT_SECRET,refresh_token:o.refresh_token,grant_type:"refresh_token"})});if(!i.ok){let l="";try{l=await i.text()}catch{}if(console.error("Drive token refresh failed",i.status,l),l&&/invalid_grant/i.test(l))try{let c={...o,access_token:"",refresh_token:null,expiry:0};await e.put(be,JSON.stringify(c))}catch{}throw new Error("Failed to refresh token")}let a=await i.json();return o.access_token=a.access_token,o.expiry=Math.floor(Date.now()/1e3)+(a.expires_in||3600)-30,await e.put(be,JSON.stringify(o)),o}async function Qi(t,e){let r=x(t),o=t.DRIVE_ROOT_FOLDER&&String(t.DRIVE_ROOT_FOLDER).trim()||Ic(t),s=`${Xi}:${o}:id`,i=await r.get(s);if(i)return{id:i,name:o};let a=`mimeType='application/vnd.google-apps.folder' and name='${o.replace(/'/g,"\\'")}' and 'root' in parents and trashed=false`,l=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(a)}&fields=files(id,name)`,c=await fetch(l,{headers:{Authorization:`Bearer ${e.access_token}`}});if(c.ok){let f=await c.json();if(Array.isArray(f.files)&&f.files.length>0){let g=f.files[0].id;return await r.put(s,g),{id:g,name:o}}}let d=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({name:o,mimeType:"application/vnd.google-apps.folder"})});if(!d.ok){let f=await d.text();throw console.error("Failed to create Drive folder",f),new Error("Failed to create Drive folder")}let h=(await d.json()).id;return await r.put(s,h),{id:h,name:o}}function Ic(t){try{if(t.SITE_URL)return(new URL(t.SITE_URL).hostname.split(".")[0]||"openshop").replace(/[-_]+/g," ").trim()}catch{}return"OpenShop"}_.post("/api/admin/drive/upload",async t=>{try{let{mimeType:e,dataBase64:r,filename:o}=await t.req.json();if(!e||!r)return t.json({error:"Missing mimeType or dataBase64"},400);let s;try{s=await Zr(t.env)}catch(g){let p=String(g&&g.message?g.message:g);return/Drive not connected/i.test(p)?t.json({error:"Drive not connected. Please connect Google Drive in Admin."},502):/Failed to refresh token/i.test(p)?t.json({error:"Drive session expired. Please reconnect Google Drive."},502):(console.error("Drive token ensure error",g),t.json({error:"Drive authentication failed"},502))}let i=await Qi(t.env,s),a=`openshop-${Yi()}`,l={name:o||"openshop-image",parents:[i.id]},c=`--${a}\r
Content-Type: application/json; charset=UTF-8\r
\r
${JSON.stringify(l)}\r
--${a}\r
Content-Type: ${e}\r
Content-Transfer-Encoding: base64\r
\r
${r}\r
--${a}--`,d=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":`multipart/related; boundary=${a}`},body:c});if(!d.ok){let g=await d.text();return console.error("Drive upload failed",g),t.json({error:"Drive upload failed",details:g},502)}let u=await d.json(),h=u.id;await fetch(`https://www.googleapis.com/drive/v3/files/${h}/permissions`,{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})}).catch(()=>{});let f=`https://drive.usercontent.google.com/download?id=${h}&export=view`;return t.json({id:h,viewUrl:f,webViewLink:u.webViewLink,downloadUrl:f,folder:{id:i.id,name:i.name}})}catch(e){return console.error("Drive upload error",e),t.json({error:"Upload failed"},500)}});_.get("/api/admin/drive/picker-config",async t=>{try{let e=t.env.GOOGLE_API_KEY,r=t.env.GOOGLE_CLIENT_ID;if(!e||!r)return t.json({error:"Picker not configured"},500);let o=await Zr(t.env),s=Math.floor(Date.now()/1e3),i=Math.max(0,(o.expiry||s)-s);return t.json({apiKey:e,clientId:r,accessToken:o.access_token,expiresIn:i})}catch(e){let r=String(e&&e.message?e.message:e);return/Drive not connected/i.test(r)||/Failed to refresh token/i.test(r)?t.json({error:"Drive not connected"},502):(console.error("Picker config error",e),t.json({error:"Failed to load picker config"},500))}});_.post("/api/admin/drive/copy",async t=>{try{let e=await t.req.json().catch(()=>({})),r=Array.isArray(e.fileIds)&&e.fileIds.length>0?e.fileIds:e.fileId?[e.fileId]:[],o=e&&e.resourceKeys&&typeof e.resourceKeys=="object"?e.resourceKeys:{},s=e&&typeof e.resourceKey=="string"?e.resourceKey:"";if(r.length===0)return t.json({error:"Missing fileId(s)"},400);let i;try{i=await Zr(t.env)}catch(c){let d=String(c&&c.message?c.message:c);return/Drive not connected/i.test(d)?t.json({error:"Drive not connected. Please connect Google Drive in Admin."},502):/Failed to refresh token/i.test(d)?t.json({error:"Drive session expired. Please reconnect Google Drive."},502):(console.error("Drive token ensure error (copy)",c),t.json({error:"Drive authentication failed"},502))}let a=await Qi(t.env,i),l=[];for(let c of r){let d=o[c]||s||"",u=`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(c)}?fields=id,mimeType,shortcutDetails,targetId,resourceKey,webViewLink,driveId&supportsAllDrives=true${d?`&resourceKey=${encodeURIComponent(d)}`:""}`,h=await fetch(u,{headers:{Authorization:`Bearer ${i.access_token}`}});if(!h.ok){let S=await h.text().catch(()=>"");return console.error("Drive get file failed",c,S),t.json({error:"Drive file lookup failed",details:S},502)}let f=await h.json(),g=f&&f.mimeType==="application/vnd.google-apps.shortcut"&&f.shortcutDetails&&f.shortcutDetails.targetId?f.shortcutDetails.targetId:f&&f.id?f.id:c,p=f&&f.resourceKey?f.resourceKey:d,m=`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(g)}/copy?supportsAllDrives=true${p?`&resourceKey=${encodeURIComponent(p)}`:""}`,v=await fetch(m,{method:"POST",headers:{Authorization:`Bearer ${i.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({parents:[a.id]})});if(!v.ok){let S=await v.text().catch(()=>"");return console.error("Drive copy failed",g,S),t.json({error:"Drive copy failed",details:S},502)}let y=await v.json(),T=y.id;await fetch(`https://www.googleapis.com/drive/v3/files/${T}/permissions?supportsAllDrives=true`,{method:"POST",headers:{Authorization:`Bearer ${i.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})}).catch(()=>{});let P=`https://drive.usercontent.google.com/download?id=${T}&export=view`;l.push({id:T,viewUrl:P,webViewLink:y.webViewLink,downloadUrl:P,folder:{id:a.id,name:a.name}})}return Array.isArray(e.fileIds)?t.json({items:l}):t.json(l[0])}catch(e){return console.error("Drive copy error",e),t.json({error:"Copy failed"},500)}});_.post("/api/admin/login",async t=>{try{let{password:e}=await t.req.json(),r=t.env.ADMIN_PASSWORD||"admin123";if(e!==r)return t.json({error:"Invalid password"},401);let o=Yi(),s=await gr(o);return await x(t.env).put(`admin_token:${s}`,Date.now().toString(),{expirationTtl:86400}),t.json({token:o})}catch(e){return console.error("Admin login error:",e),t.json({error:"Login failed"},500)}});_.post("/api/admin/products",async t=>{try{let e=await t.req.json(),r=new C(x(t.env)),o=new B(t.env.STRIPE_SECRET_KEY),s=Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:[],i={name:e.name,images:s.slice(0,8),type:"good",tax_code:"txcd_99999999"};e.description&&String(e.description).trim()!==""&&(i.description=String(e.description));let a=await o.products.create(i),l=Array.isArray(e.variants)?e.variants:[],c=Array.isArray(e.variants2)?e.variants2:[],d=null,u={};if(l.length===0&&c.length===0)d=await o.prices.create({unit_amount:Math.round(e.price*100),currency:e.currency,product:a.id,nickname:`${e.name} - Base`,metadata:{price_type:"base",product_name:e.name}});else{let g=[];if(l.length>0&&c.length>0)for(let p of l)for(let m of c){let v=`${e.name} - ${p.name} - ${m.name}`,y=p.hasCustomPrice&&p.price?p.price:m.hasCustomPrice&&m.price?m.price:e.price;g.push({name:v,price:y,variant1:p,variant2:m,description:v,variantCombo:`${p.id||p.name}-${m.id||m.name}`})}else if(l.length>0)for(let p of l){let m=`${e.name} - ${p.name}`,v=p.hasCustomPrice&&p.price?p.price:e.price;g.push({name:m,price:v,variant1:p,description:m,variantCombo:`${p.id||p.name}`})}else if(c.length>0)for(let p of c){let m=`${e.name} - ${p.name}`,v=p.hasCustomPrice&&p.price?p.price:e.price;g.push({name:m,price:v,variant2:p,description:m,variantCombo:`${p.id||p.name}`})}for(let p of g){let m=await o.prices.create({unit_amount:Math.round(p.price*100),currency:e.currency,product:a.id,nickname:p.name,metadata:{price_type:"variant_combo",product_name:e.name,variant1_name:p.variant1?.name||"",variant2_name:p.variant2?.name||"",variant1_id:p.variant1?.id||"",variant2_id:p.variant2?.id||"",variant1_style:e.variantStyle||"Variant",variant2_style:e.variantStyle2||"Variant",variant_combo:p.variantCombo}});p.variant1&&p.variant2?u[`${p.variant1.id}-${p.variant2.id}`]=m.id:p.variant1?u[p.variant1.id]=m.id:p.variant2&&(u[p.variant2.id]=m.id)}d=await o.prices.create({unit_amount:Math.round(e.price*100),currency:e.currency,product:a.id,nickname:`${e.name} - Base`,metadata:{price_type:"base",product_name:e.name}})}let h={...e,stripePriceId:d?.id||Object.values(u)[0]||"",stripeProductId:a.id,variantPrices:u,variants:l,variants2:c},f=await r.createProduct(h);return t.json(f,201)}catch(e){return console.error("Error creating product:",e),t.json({error:"Failed to create product"},500)}});_.post("/api/admin/collections",async t=>{try{console.log("Creating collection - starting");let e=await t.req.json();console.log("Collection data received:",e);let r=x(t.env);if(!r)return console.error("KV namespace not found in environment"),t.json({error:"KV namespace not configured"},500);console.log("KV namespace found");let o=new C(r);console.log("KVManager created");let s=await o.createCollection(e);return console.log("Collection saved:",s),t.json(s,201)}catch(e){return console.error("Error creating collection:",e),console.error("Error stack:",e.stack),t.json({error:"Failed to create collection",details:e.message,stack:e.stack},500)}});_.put("/api/admin/collections/:id",async t=>{try{let e=await t.req.json(),o=await new C(x(t.env)).updateCollection(t.req.param("id"),e);return t.json(o)}catch(e){return console.error("Error updating collection:",e),t.json({error:"Failed to update collection"},500)}});_.get("/api/admin/collections",async t=>{try{let r=await new C(x(t.env)).getAllCollections();return t.json(r)}catch(e){return console.error("Error listing admin collections:",e),t.json({error:"Failed to list collections"},500)}});_.delete("/api/admin/collections/:id",async t=>{try{let e=new C(x(t.env));return await e.getCollection(t.req.param("id"))?(await e.deleteCollection(t.req.param("id")),t.json({success:!0})):t.json({error:"Collection not found"},404)}catch(e){return console.error("Error deleting collection:",e),t.json({error:"Failed to delete collection"},500)}});_.put("/api/admin/products/:id",async t=>{try{let e=await t.req.json(),r=new C(x(t.env)),o=new B(t.env.STRIPE_SECRET_KEY),s=await r.getProduct(t.req.param("id"));if(!s)return t.json({error:"Product not found"},404);if(e.name||e.description!==void 0||e.images||e.imageUrl){let a=Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:Array.isArray(s.images)?s.images:s.imageUrl?[s.imageUrl]:[],l={name:e.name||s.name,images:a.slice(0,8)};if(typeof e.description=="string"){let c=e.description.trim();c&&(l.description=c)}await o.products.update(s.stripeProductId,l)}if(typeof e.price<"u"&&e.price!==s.price){let a=typeof e.price=="number"?e.price:parseFloat(String(e.price)),l=await o.prices.create({unit_amount:Math.round(a*100),currency:e.currency||s.currency,product:s.stripeProductId});s.stripePriceId&&await o.prices.update(s.stripePriceId,{active:!1}),e.stripePriceId=l.id,e.price=a}if(Array.isArray(e.variants)){let a=e.variants,l=Array.isArray(s.variants)?s.variants:[],c=e.stripePriceId||s.stripePriceId,d=[];for(let u of a){let h=u.id?l.find(g=>g.id===u.id):void 0;if(!!u.hasCustomPrice&&typeof u.price=="number"&&u.price>0){let g=Math.round(u.price*100),p=h?.stripePriceId,m=!!h?.hasCustomPrice&&typeof h?.price=="number",v=m?Math.round(h.price*100):null;if(!p||!m||v!==g){let y=await o.prices.create({unit_amount:g,currency:e.currency||s.currency,product:s.stripeProductId});if(h?.stripePriceId&&m)try{await o.prices.update(h.stripePriceId,{active:!1})}catch{}p=y.id}d.push({...u,stripePriceId:p,hasCustomPrice:!0})}else{if(h?.stripePriceId&&h?.hasCustomPrice)try{await o.prices.update(h.stripePriceId,{active:!1})}catch{}d.push({...u,stripePriceId:c,hasCustomPrice:!1,price:void 0})}}e.variants=d}if(Array.isArray(e.variants2)){let a=e.variants2,l=Array.isArray(s.variants2)?s.variants2:[],c=e.stripePriceId||s.stripePriceId,d=[];for(let u of a){let h=u.id?l.find(g=>g.id===u.id):void 0;if(!!u.hasCustomPrice&&typeof u.price=="number"&&u.price>0){let g=Math.round(u.price*100),p=h?.stripePriceId,m=!!h?.hasCustomPrice&&typeof h?.price=="number",v=m?Math.round(h.price*100):null;if(!p||!m||v!==g){let y=await o.prices.create({unit_amount:g,currency:e.currency||s.currency,product:s.stripeProductId,nickname:`${e.name||s.name}${e.variantStyle2||s.variantStyle2?` - ${e.variantStyle2||s.variantStyle2}: ${u.name}`:` - ${u.name}`}`,metadata:{price_type:"variant_secondary",variant_id:u.id||"",variant_name:u.name||"",variant2_name:u.name||""}});if(h?.stripePriceId&&m)try{await o.prices.update(h.stripePriceId,{active:!1})}catch{}p=y.id}d.push({...u,stripePriceId:p,hasCustomPrice:!0})}else{if(h?.stripePriceId&&h?.hasCustomPrice)try{await o.prices.update(h.stripePriceId,{active:!1})}catch{}d.push({...u,stripePriceId:c,hasCustomPrice:!1,price:void 0})}}e.variants2=d}let i=await r.updateProduct(t.req.param("id"),e);return t.json(i)}catch(e){return console.error("Error updating product:",e),t.json({error:"Failed to update product"},500)}});_.get("/api/admin/products",async t=>{try{let r=await new C(x(t.env)).getAllProducts();return t.json(r)}catch(e){return console.error("Error listing admin products:",e),t.json({error:"Failed to list products"},500)}});_.delete("/api/admin/products/:id",async t=>{try{let e=new C(x(t.env)),r=new B(t.env.STRIPE_SECRET_KEY),o=await e.getProduct(t.req.param("id"));return o?(o.stripePriceId&&await r.prices.update(o.stripePriceId,{active:!1}),o.stripeProductId&&await r.products.update(o.stripeProductId,{active:!1}),await e.deleteProduct(t.req.param("id")),t.json({success:!0})):t.json({error:"Product not found"},404)}catch(e){return console.error("Error deleting product:",e),t.json({error:"Failed to delete product"},500)}});_.get("/api/admin/storefront/theme",async t=>{try{let e=x(t.env);if(!e)return t.json({error:"KV namespace unavailable"},500);let r=await e.get(Ce),o=null;if(r)try{o=JSON.parse(r)}catch(s){console.error("Invalid storefront theme JSON in KV:",s),o=null}return t.json(le(o||M))}catch(e){return console.error("Error fetching admin storefront theme:",e),t.json({error:"Failed to load storefront theme"},500)}});_.put("/api/admin/storefront/theme",async t=>{try{let e=await t.req.json(),r=Cc(e);if(!r.valid)return t.json({error:r.message},400);let o=x(t.env);if(!o)return t.json({error:"KV namespace unavailable"},500);let i={theme:mt(e),updatedAt:Date.now()};return await o.put(Ce,JSON.stringify(i)),t.json(le(i))}catch(e){return console.error("Error updating storefront theme:",e),t.json({error:"Failed to update storefront theme"},500)}});_.delete("/api/admin/storefront/theme",async t=>{try{let e=x(t.env);return e?(await e.delete(Ce),t.json(le(M))):t.json({error:"KV namespace unavailable"},500)}catch(e){return console.error("Error resetting storefront theme:",e),t.json({error:"Failed to reset storefront theme"},500)}});_.put("/api/admin/store-settings",async t=>{try{let e=await t.req.json(),r=new C(x(t.env));if(!e.logoType||!["text","image"].includes(e.logoType))return t.json({error:'Invalid logoType. Must be "text" or "image"'},400);let s={...{logoType:"text",logoText:"OpenShop",logoImageUrl:"",storeName:"OpenShop",storeDescription:"Your amazing online store",heroImageUrl:"",heroTitle:"Welcome to OpenShop",heroSubtitle:"Discover amazing products at unbeatable prices. Built on Cloudflare for lightning-fast performance.",contactEmail:"contact@example.com",businessName:"",businessAddressLine1:"",businessAddressLine2:"",businessCity:"",businessState:"",businessPostalCode:"",businessCountry:""},...e};return await r.namespace.put("store:settings",JSON.stringify(s)),t.json(s)}catch(e){return console.error("Error updating store settings:",e),t.json({error:"Failed to update store settings"},500)}});_.get("/api/admin/analytics",async t=>{try{let e=t.req.query("period")||"30d",r=new B(t.env.STRIPE_SECRET_KEY),o=new Date,i={"1d":1,"7d":7,"30d":30,"90d":90,"1y":365}[e]||30,a=new Date(o.getTime()-i*24*60*60*1e3),c=(await r.paymentIntents.list({created:{gte:Math.floor(a.getTime()/1e3)},limit:100})).data.filter(g=>g.status==="succeeded"),d=c.reduce((g,p)=>g+p.amount,0)/100,u=c.length,h=u>0?d/u:0,f=[];if(e==="1d"){let g={},p={};c.forEach(T=>{let P=new Date(T.created*1e3),S=new Date(P);S.setMinutes(0,0,0);let E=S.toISOString();g[E]=(g[E]||0)+1,p[E]=(p[E]||0)+T.amount/100});let m=new Date(o);m.setMinutes(0,0,0);let v=new Date(m.getTime()-23*60*60*1e3),y=new Date(v);for(;y<=m;){let T=new Date(y).toISOString();f.push({date:T,orders:g[T]||0,revenue:Math.round(((p[T]||0)+Number.EPSILON)*100)/100,formattedDate:new Date(y).toLocaleTimeString("en-US",{hour:"numeric"})}),y.setHours(y.getHours()+1)}}else{let g={},p={};c.forEach(v=>{let y=new Date(v.created*1e3).toISOString().split("T")[0];g[y]=(g[y]||0)+1,p[y]=(p[y]||0)+v.amount/100});let m=new Date(a);for(;m<=o;){let v=m.toISOString().split("T")[0];f.push({date:v,orders:g[v]||0,revenue:p[v]||0,formattedDate:m.toLocaleDateString("en-US",{month:"short",day:"numeric"})}),m.setDate(m.getDate()+1)}}return t.json({period:e,totalRevenue:Math.round(d*100)/100,totalOrders:u,averageOrderValue:Math.round(h*100)/100,chartData:f,recentOrders:[],dateRange:{start:a.toISOString(),end:o.toISOString()}})}catch(e){return console.error("Error fetching analytics:",e),t.json({error:"Failed to fetch analytics"},500)}});_.post("/api/admin/orders/:orderId/fulfill",async t=>{try{let e=t.req.param("orderId");if(!e)return t.json({error:"Order ID is required"},400);let r=x(t.env);if(!r)return t.json({error:"KV namespace not available"},500);let o=`order_fulfillment:${e}`,s={fulfilled:!0,fulfilledAt:new Date().toISOString(),fulfilledBy:"admin"};return await r.put(o,JSON.stringify(s)),t.json({success:!0,fulfillment:s})}catch(e){return console.error("Error marking order as fulfilled:",e),t.json({error:"Failed to mark order as fulfilled"},500)}});_.get("/api/admin/orders",async t=>{try{let e=new B(t.env.STRIPE_SECRET_KEY),r=Math.min(parseInt(t.req.query("limit")||"25",10),50),o=t.req.query("direction")||"next",s=t.req.query("cursor")||void 0,i=t.req.query("showFulfilled"),a=i==="true";console.log("Show fulfilled orders:",a,"Raw param:",i);let l={limit:r};s&&(o==="prev"?l.ending_before=s:l.starting_after=s);let c=await e.checkout.sessions.list({...l}),d=x(t.env),u=[];for(let m of c.data)if(m.payment_status==="paid"||m.status==="complete"||m.status==="completed"){let v=!0;if(d){let y=`order_fulfillment:${m.id}`,T=await d.get(y),P=T?JSON.parse(T):{fulfilled:!1};a?P.fulfilled||(v=!1):P.fulfilled&&(v=!1)}v&&u.push(m)}let h=u.reverse(),f=[];for(let m of h)try{let v=await e.checkout.sessions.listLineItems(m.id,{limit:100,expand:["data.price"]}),y=null;if(m.shipping_details)y=m.shipping_details;else if(m.payment_intent)try{let E=await e.paymentIntents.retrieve(m.payment_intent,{expand:["shipping"]});E.shipping&&(y={address:E.shipping.address,name:E.shipping.name})}catch(E){console.log("Error fetching payment intent shipping:",E.message)}let T=`order_fulfillment:${m.id}`,P=await d.get(T),S=P?JSON.parse(P):{fulfilled:!1,fulfilledAt:null,fulfilledBy:null};f.push({id:m.id,created:m.created,amount_total:m.amount_total,currency:m.currency,customer_email:m.customer_details?.email||m.customer_email||null,customer_name:m.customer_details?.name||null,shipping:y,payment_intent:m.payment_intent||null,billing:{name:m.customer_details?.name||null,email:m.customer_details?.email||null,address:m.customer_details?.address||null},fulfillment:S,items:v.data.map(E=>{let O=E.price?.nickname||"",b="Unknown Product",q="",D="";if(O.includes(" - ")){let j=O.split(" - ");b=j[0],j.length>=2&&(q=j[1]),j.length>=3&&(D=j[2])}else b=O;return{id:E.id,description:b,quantity:E.quantity,amount_total:E.amount_total,currency:E.currency,price_nickname:O,variant1_name:q||E.price?.metadata?.variant1_name||null,variant1_style:E.price?.metadata?.variant1_style||"Variant",variant2_name:D||E.price?.metadata?.variant2_name||null,variant2_style:E.price?.metadata?.variant2_style||"Variant"}})})}catch(v){console.error("Error fetching line items for session",m.id,v);let y={fulfilled:!1,fulfilledAt:null,fulfilledBy:null};if(d){let P=`order_fulfillment:${m.id}`,S=await d.get(P);y=S?JSON.parse(S):{fulfilled:!1,fulfilledAt:null,fulfilledBy:null}}let T=null;if(m.metadata){let P=[],S=[],E=[];Object.keys(m.metadata).forEach(O=>{O.startsWith("item_")&&O.endsWith("_name")&&P.push(m.metadata[O]),O.startsWith("item_")&&O.endsWith("_variant1")&&S.push(m.metadata[O]),O.startsWith("item_")&&O.endsWith("_variant2")&&E.push(m.metadata[O])}),P.length>0&&(T=P.map((O,b)=>({description:O,variant1_name:S[b]||null,variant1_style:"Variant",variant2_name:E[b]||null,variant2_style:"Variant"})))}f.push({id:m.id,created:m.created,amount_total:m.amount_total,currency:m.currency,customer_email:m.customer_details?.email||m.customer_email||null,customer_name:m.customer_details?.name||null,shipping:m.shipping_details||null,billing:{name:m.customer_details?.name||null,email:m.customer_details?.email||null,address:m.customer_details?.address||null},fulfillment:y,items:T||[]})}let g=h.length>0?h[0].id:null,p=h.length>0?h[h.length-1].id:null;return t.json({limit:r,orders:f,cursors:{next:g,prev:p},has_more:c.has_more})}catch(e){return console.error("Error fetching orders:",e),t.json({error:"Failed to fetch orders"},500)}});function kc(){let t=Ji(4);return`${Date.now().toString(36)}-${t}`}_.get("/api/admin/media",async t=>{try{let o=[...await new C(x(t.env)).getAllMediaItems()].sort((s,i)=>(i.createdAt||0)-(s.createdAt||0));return t.json(o)}catch(e){return console.error("Error listing media:",e),t.json({error:"Failed to list media"},500)}});_.post("/api/admin/media",async t=>{try{let e=await t.req.json(),r=e?.url;if(!r||typeof r!="string"||r.trim()==="")return t.json({error:"url is required"},400);let o=new C(x(t.env)),s={id:e.id||kc(),url:String(r),source:e.source||"link",filename:e.filename||"",mimeType:e.mimeType||"",driveFileId:e.driveFileId||"",createdAt:typeof e.createdAt=="number"?e.createdAt:Date.now()},i=await o.createMediaItem(s);return t.json(i,201)}catch(e){return console.error("Error creating media:",e),t.json({error:"Failed to create media"},500)}});_.delete("/api/admin/media/:id",async t=>{try{let e=t.req.param("id");return e?(await new C(x(t.env)).deleteMediaItem(e),t.json({success:!0})):t.json({error:"Missing id"},400)}catch(e){return console.error("Error deleting media:",e),t.json({error:"Failed to delete media"},500)}});_.get("*",async t=>{let r=new URL(t.req.url).pathname;if(r.startsWith("/api/"))return t.notFound();try{if(r!=="/"&&!r.startsWith("/admin")&&!r.startsWith("/collections")&&!r.startsWith("/products")&&!r.startsWith("/success")){let i=await t.env.ASSETS.fetch(t.req);if(i.ok)return i}let o=new Request(t.req.url.replace(r,"/index.html"),t.req),s=await t.env.ASSETS.fetch(o);if(s.ok)return s;throw new Error("index.html not found")}catch(o){return console.error("Error serving static asset:",o,"for path:",r),t.html(`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>OpenShop - Loading Error</title>
          <style>
            body { 
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              text-align: center; 
              padding: 50px 20px; 
              background: linear-gradient(135deg, #9333ea 0%, #2563eb 100%);
              color: white;
              margin: 0;
              min-height: 100vh;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
            }
            .container { max-width: 500px; }
            h1 { font-size: 3rem; margin-bottom: 1rem; }
            .error { font-size: 1.2rem; margin: 20px 0; opacity: 0.9; }
            .help { font-size: 1rem; margin-top: 30px; opacity: 0.8; }
            a { color: white; text-decoration: underline; }
          </style>
        </head>
        <body>
          <div class="container">
            <h1>OpenShop</h1>
            <div class="error">Application loading error</div>
            <p>The application assets could not be loaded.</p>
            <div class="help">
              <p>Try:</p>
              <ul style="text-align: left; display: inline-block;">
                <li>Refreshing the page</li>
                <li>Checking your internet connection</li>
                <li>Contacting support if the issue persists</li>
              </ul>
            </div>
          </div>
        </body>
      </html>
    `,500)}});var ay=_;export{ay as default};
