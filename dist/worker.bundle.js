// Worker Bundle - Built 2026-02-04T23:03:04.992Z
// Version: 0.0.0
var uc=Object.defineProperty;var Pt=(t,e)=>{for(var r in e)uc(t,r,{get:e[r],enumerable:!0})};var Mr=(t,e,r)=>(o,s)=>{let i=-1;return a(0);async function a(l){if(l<=i)throw new Error("next() called multiple times");i=l;let c,u=!1,d;if(t[l]?(d=t[l][0][0],o.req.routeIndex=l):d=l===t.length&&s||void 0,d)try{c=await d(o,()=>a(l+1))}catch(m){if(m instanceof Error&&e)o.error=m,c=await e(m,o),u=!0;else throw m}else o.finalized===!1&&r&&(c=await r(o));return c&&(o.finalized===!1||u)&&(o.res=c),o}};var jo=Symbol();var Uo=async(t,e=Object.create(null))=>{let{all:r=!1,dot:o=!1}=e,i=(t instanceof Tt?t.raw.headers:t.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?dc(t,{all:r,dot:o}):{}};async function dc(t,e){let r=await t.formData();return r?mc(r,e):{}}function mc(t,e){let r=Object.create(null);return t.forEach((o,s)=>{e.all||s.endsWith("[]")?hc(r,s,o):r[s]=o}),e.dot&&Object.entries(r).forEach(([o,s])=>{o.includes(".")&&(pc(r,o,s),delete r[o])}),r}var hc=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:e.endsWith("[]")?t[e]=[r]:t[e]=r},pc=(t,e,r)=>{let o=t,s=e.split(".");s.forEach((i,a)=>{a===s.length-1?o[i]=r:((!o[i]||typeof o[i]!="object"||Array.isArray(o[i])||o[i]instanceof File)&&(o[i]=Object.create(null)),o=o[i])})};var Nr=t=>{let e=t.split("/");return e[0]===""&&e.shift(),e},Fo=t=>{let{groups:e,path:r}=fc(t),o=Nr(r);return vc(o,e)},fc=t=>{let e=[];return t=t.replace(/\{[^}]+\}/g,(r,o)=>{let s=`@${o}`;return e.push([s,r]),s}),{groups:e,path:t}},vc=(t,e)=>{for(let r=e.length-1;r>=0;r--){let[o]=e[r];for(let s=t.length-1;s>=0;s--)if(t[s].includes(o)){t[s]=t[s].replace(o,e[r][1]);break}}return t},_t={},$o=(t,e)=>{if(t==="*")return"*";let r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let o=`${t}#${e}`;return _t[o]||(r[2]?_t[o]=e&&e[0]!==":"&&e[0]!=="*"?[o,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:_t[o]=[t,r[1],!0]),_t[o]}return null},St=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},gc=t=>St(t,decodeURI),Dr=t=>{let e=t.url,r=e.indexOf("/",e.indexOf(":")+4),o=r;for(;o<e.length;o++){let s=e.charCodeAt(o);if(s===37){let i=e.indexOf("?",o),a=e.slice(r,i===-1?void 0:i);return gc(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(s===63)break}return e.slice(r,o)};var Vo=t=>{let e=Dr(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},le=(t,e,...r)=>(r.length&&(e=le(e,...r)),`${t?.[0]==="/"?"":"/"}${t}${e==="/"?"":`${t?.at(-1)==="/"?"":"/"}${e?.[0]==="/"?e.slice(1):e}`}`),Et=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;let e=t.split("/"),r=[],o="";return e.forEach(s=>{if(s!==""&&!/\:/.test(s))o+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&o===""?r.push("/"):r.push(o);let i=s.replace("?","");o+="/"+i,r.push(o)}else o+="/"+s}),r.filter((s,i,a)=>a.indexOf(s)===i)},kr=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?St(t,Gr):t):t,Ko=(t,e,r)=>{let o;if(!r&&e&&!/[%+]/.test(e)){let a=t.indexOf(`?${e}`,8);for(a===-1&&(a=t.indexOf(`&${e}`,8));a!==-1;){let l=t.charCodeAt(a+e.length+1);if(l===61){let c=a+e.length+2,u=t.indexOf("&",c);return kr(t.slice(c,u===-1?void 0:u))}else if(l==38||isNaN(l))return"";a=t.indexOf(`&${e}`,a+1)}if(o=/[%+]/.test(t),!o)return}let s={};o??=/[%+]/.test(t);let i=t.indexOf("?",8);for(;i!==-1;){let a=t.indexOf("&",i+1),l=t.indexOf("=",i);l>a&&a!==-1&&(l=-1);let c=t.slice(i+1,l===-1?a===-1?void 0:a:l);if(o&&(c=kr(c)),i=a,c==="")continue;let u;l===-1?u="":(u=t.slice(l+1,a===-1?void 0:a),o&&(u=kr(u))),r?(s[c]&&Array.isArray(s[c])||(s[c]=[]),s[c].push(u)):s[c]??=u}return e?s[e]:s},Bo=Ko,zo=(t,e)=>Ko(t,e,!0),Gr=decodeURIComponent;var Wo=t=>St(t,Gr),Tt=class{raw;#t;#e;routeIndex=0;path;bodyCache={};constructor(t,e="/",r=[[]]){this.raw=t,this.path=e,this.#e=r,this.#t={}}param(t){return t?this.#r(t):this.#n()}#r(t){let e=this.#e[0][this.routeIndex][1][t],r=this.#s(e);return r?/\%/.test(r)?Wo(r):r:void 0}#n(){let t={},e=Object.keys(this.#e[0][this.routeIndex][1]);for(let r of e){let o=this.#s(this.#e[0][this.routeIndex][1][r]);o&&typeof o=="string"&&(t[r]=/\%/.test(o)?Wo(o):o)}return t}#s(t){return this.#e[1]?this.#e[1][t]:t}query(t){return Bo(this.url,t)}queries(t){return zo(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;let e={};return this.raw.headers.forEach((r,o)=>{e[o]=r}),e}async parseBody(t){return this.bodyCache.parsedBody??=await Uo(this,t)}#o=t=>{let{bodyCache:e,raw:r}=this,o=e[t];if(o)return o;let s=Object.keys(e)[0];return s?e[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[t]())):e[t]=r[t]()};json(){return this.#o("text").then(t=>JSON.parse(t))}text(){return this.#o("text")}arrayBuffer(){return this.#o("arrayBuffer")}blob(){return this.#o("blob")}formData(){return this.#o("formData")}addValidatedData(t,e){this.#t[t]=e}valid(t){return this.#t[t]}get url(){return this.raw.url}get method(){return this.raw.method}get[jo](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,t]])=>t)}get routePath(){return this.#e[0].map(([[,t]])=>t)[this.routeIndex].path}};var Jo={Stringify:1,BeforeStream:2,Stream:3},yc=(t,e)=>{let r=new String(t);return r.isEscaped=!0,r.callbacks=e,r};var Hr=async(t,e,r,o,s)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));let i=t.callbacks;if(!i?.length)return Promise.resolve(t);s?s[0]+=t:s=[t];let a=Promise.all(i.map(l=>l({phase:e,buffer:s,context:o}))).then(l=>Promise.all(l.filter(Boolean).map(c=>Hr(c,e,!1,o,s))).then(()=>s[0]));return r?yc(await a,i):a};var Pc="text/plain; charset=UTF-8",Lr=(t,e)=>({"Content-Type":t,...e}),Yo=class{#t;#e;env={};#r;finalized=!1;error;#n;#s;#o;#u;#c;#l;#a;#d;#m;constructor(t,e){this.#t=t,e&&(this.#s=e.executionCtx,this.env=e.env,this.#l=e.notFoundHandler,this.#m=e.path,this.#d=e.matchResult)}get req(){return this.#e??=new Tt(this.#t,this.#m,this.#d),this.#e}get event(){if(this.#s&&"respondWith"in this.#s)return this.#s;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#s)return this.#s;throw Error("This context has no ExecutionContext")}get res(){return this.#o||=new Response(null,{headers:this.#a??=new Headers})}set res(t){if(this.#o&&t){t=new Response(t.body,t);for(let[e,r]of this.#o.headers.entries())if(e!=="content-type")if(e==="set-cookie"){let o=this.#o.headers.getSetCookie();t.headers.delete("set-cookie");for(let s of o)t.headers.append("set-cookie",s)}else t.headers.set(e,r)}this.#o=t,this.finalized=!0}render=(...t)=>(this.#c??=e=>this.html(e),this.#c(...t));setLayout=t=>this.#u=t;getLayout=()=>this.#u;setRenderer=t=>{this.#c=t};header=(t,e,r)=>{this.finalized&&(this.#o=new Response(this.#o.body,this.#o));let o=this.#o?this.#o.headers:this.#a??=new Headers;e===void 0?o.delete(t):r?.append?o.append(t,e):o.set(t,e)};status=t=>{this.#n=t};set=(t,e)=>{this.#r??=new Map,this.#r.set(t,e)};get=t=>this.#r?this.#r.get(t):void 0;get var(){return this.#r?Object.fromEntries(this.#r):{}}#i(t,e,r){let o=this.#o?new Headers(this.#o.headers):this.#a??new Headers;if(typeof e=="object"&&"headers"in e){let i=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(let[a,l]of i)a.toLowerCase()==="set-cookie"?o.append(a,l):o.set(a,l)}if(r)for(let[i,a]of Object.entries(r))if(typeof a=="string")o.set(i,a);else{o.delete(i);for(let l of a)o.append(i,l)}let s=typeof e=="number"?e:e?.status??this.#n;return new Response(t,{status:s,headers:o})}newResponse=(...t)=>this.#i(...t);body=(t,e,r)=>this.#i(t,e,r);text=(t,e,r)=>!this.#a&&!this.#n&&!e&&!r&&!this.finalized?new Response(t):this.#i(t,e,Lr(Pc,r));json=(t,e,r)=>this.#i(JSON.stringify(t),e,Lr("application/json",r));html=(t,e,r)=>{let o=s=>this.#i(s,e,Lr("text/html; charset=UTF-8",r));return typeof t=="object"?Hr(t,Jo.Stringify,!1,{}).then(o):o(t)};redirect=(t,e)=>{let r=String(t);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,e??302)};notFound=()=>(this.#l??=()=>new Response,this.#l(this))};var A="ALL",Xo="all",Qo=["get","post","put","delete","options","patch"],xt="Can not add a route since the matcher is already built.",wt=class extends Error{};var Zo="__COMPOSED_HANDLER";var Tc=t=>t.text("404 Not Found",404),es=(t,e)=>{if("getResponse"in t){let r=t.getResponse();return e.newResponse(r.body,r)}return console.error(t),e.text("Internal Server Error",500)},qr=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(t={}){[...Qo,Xo].forEach(s=>{this[s]=(i,...a)=>(typeof i=="string"?this.#t=i:this.#n(s,this.#t,i),a.forEach(l=>{this.#n(s,this.#t,l)}),this)}),this.on=(s,i,...a)=>{for(let l of[i].flat()){this.#t=l;for(let c of[s].flat())a.map(u=>{this.#n(c.toUpperCase(),this.#t,u)})}return this},this.use=(s,...i)=>(typeof s=="string"?this.#t=s:(this.#t="*",i.unshift(s)),i.forEach(a=>{this.#n(A,this.#t,a)}),this);let{strict:r,...o}=t;Object.assign(this,o),this.getPath=r??!0?t.getPath??Dr:Vo}#e(){let t=new qr({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,t.#r=this.#r,t.routes=this.routes,t}#r=Tc;errorHandler=es;route(t,e){let r=this.basePath(t);return e.routes.map(o=>{let s;e.errorHandler===es?s=o.handler:(s=async(i,a)=>(await Mr([],e.errorHandler)(i,()=>o.handler(i,a))).res,s[Zo]=o.handler),r.#n(o.method,o.path,s)}),this}basePath(t){let e=this.#e();return e._basePath=le(this._basePath,t),e}onError=t=>(this.errorHandler=t,this);notFound=t=>(this.#r=t,this);mount(t,e,r){let o,s;r&&(typeof r=="function"?s=r:(s=r.optionHandler,r.replaceRequest===!1?o=l=>l:o=r.replaceRequest));let i=s?l=>{let c=s(l);return Array.isArray(c)?c:[c]}:l=>{let c;try{c=l.executionCtx}catch{}return[l.env,c]};o||=(()=>{let l=le(this._basePath,t),c=l==="/"?0:l.length;return u=>{let d=new URL(u.url);return d.pathname=d.pathname.slice(c)||"/",new Request(d,u)}})();let a=async(l,c)=>{let u=await e(o(l.req.raw),...i(l));if(u)return u;await c()};return this.#n(A,le(t,"*"),a),this}#n(t,e,r){t=t.toUpperCase(),e=le(this._basePath,e);let o={basePath:this._basePath,path:e,method:t,handler:r};this.router.add(t,e,[r,o]),this.routes.push(o)}#s(t,e){if(t instanceof Error)return this.errorHandler(t,e);throw t}#o(t,e,r,o){if(o==="HEAD")return(async()=>new Response(null,await this.#o(t,e,r,"GET")))();let s=this.getPath(t,{env:r}),i=this.router.match(o,s),a=new Yo(t,{path:s,matchResult:i,env:r,executionCtx:e,notFoundHandler:this.#r});if(i[0].length===1){let c;try{c=i[0][0][0][0](a,async()=>{a.res=await this.#r(a)})}catch(u){return this.#s(u,a)}return c instanceof Promise?c.then(u=>u||(a.finalized?a.res:this.#r(a))).catch(u=>this.#s(u,a)):c??this.#r(a)}let l=Mr(i[0],this.errorHandler,this.#r);return(async()=>{try{let c=await l(a);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return this.#s(c,a)}})()}fetch=(t,...e)=>this.#o(t,e[1],e[0],t.method);request=(t,e,r,o)=>t instanceof Request?this.fetch(e?new Request(t,e):t,r,o):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${le("/",t)}`,e),r,o));fire=()=>{addEventListener("fetch",t=>{t.respondWith(this.#o(t.request,t,void 0,t.request.method))})}};var Ot="[^/]+",je=".*",Ue="(?:|/.*)",ue=Symbol(),_c=new Set(".\\+*[^]$()");function Sc(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===je||t===Ue?1:e===je||e===Ue?-1:t===Ot?1:e===Ot?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var bt=class{#t;#e;#r=Object.create(null);insert(t,e,r,o,s){if(t.length===0){if(this.#t!==void 0)throw ue;if(s)return;this.#t=e;return}let[i,...a]=t,l=i==="*"?a.length===0?["","",je]:["","",Ot]:i==="/*"?["","",Ue]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(l){let u=l[1],d=l[2]||Ot;if(u&&l[2]&&(d===".*"||(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d))))throw ue;if(c=this.#r[d],!c){if(Object.keys(this.#r).some(m=>m!==je&&m!==Ue))throw ue;if(s)return;c=this.#r[d]=new bt,u!==""&&(c.#e=o.varIndex++)}!s&&u!==""&&r.push([u,c.#e])}else if(c=this.#r[i],!c){if(Object.keys(this.#r).some(u=>u.length>1&&u!==je&&u!==Ue))throw ue;if(s)return;c=this.#r[i]=new bt}c.insert(a,e,r,o,s)}buildRegExpStr(){let e=Object.keys(this.#r).sort(Sc).map(r=>{let o=this.#r[r];return(typeof o.#e=="number"?`(${r})@${o.#e}`:_c.has(r)?`\\${r}`:r)+o.buildRegExpStr()});return typeof this.#t=="number"&&e.unshift(`#${this.#t}`),e.length===0?"":e.length===1?e[0]:"(?:"+e.join("|")+")"}};var ts=class{#t={varIndex:0};#e=new bt;insert(t,e,r){let o=[],s=[];for(let a=0;;){let l=!1;if(t=t.replace(/\{[^}]+\}/g,c=>{let u=`@\\${a}`;return s[a]=[u,c],a++,l=!0,u}),!l)break}let i=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=s.length-1;a>=0;a--){let[l]=s[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(l)!==-1){i[c]=i[c].replace(l,s[a][1]);break}}return this.#e.insert(i,e,o,this.#t,r),o}buildRegExp(){let t=this.#e.buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0,r=[],o=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,a)=>i!==void 0?(r[++e]=Number(i),"$()"):(a!==void 0&&(o[Number(a)]=++e),"")),[new RegExp(`^${t}`),r,o]}};var rs=[],Ec=[/^$/,[],Object.create(null)],os=Object.create(null);function ss(t){return os[t]??=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`)}function xc(){os=Object.create(null)}function wc(t){let e=new ts,r=[];if(t.length===0)return Ec;let o=t.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,d],[m,h])=>u?1:m?-1:d.length-h.length),s=Object.create(null);for(let u=0,d=-1,m=o.length;u<m;u++){let[h,p,f]=o[u];h?s[p]=[f.map(([g])=>[g,Object.create(null)]),rs]:d++;let v;try{v=e.insert(p,d,h)}catch(g){throw g===ue?new wt(p):g}h||(r[d]=f.map(([g,y])=>{let O=Object.create(null);for(y-=1;y>=0;y--){let[P,S]=v[y];O[P]=S}return[g,O]}))}let[i,a,l]=e.buildRegExp();for(let u=0,d=r.length;u<d;u++)for(let m=0,h=r[u].length;m<h;m++){let p=r[u][m]?.[1];if(!p)continue;let f=Object.keys(p);for(let v=0,g=f.length;v<g;v++)p[f[v]]=l[p[f[v]]]}let c=[];for(let u in a)c[u]=r[a[u]];return[i,c,s]}function ve(t,e){if(t){for(let r of Object.keys(t).sort((o,s)=>s.length-o.length))if(ss(r).test(e))return[...t[r]]}}var jr=class{name="RegExpRouter";#t;#e;constructor(){this.#t={[A]:Object.create(null)},this.#e={[A]:Object.create(null)}}add(t,e,r){let o=this.#t,s=this.#e;if(!o||!s)throw new Error(xt);o[t]||[o,s].forEach(l=>{l[t]=Object.create(null),Object.keys(l[A]).forEach(c=>{l[t][c]=[...l[A][c]]})}),e==="/*"&&(e="*");let i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){let l=ss(e);t===A?Object.keys(o).forEach(c=>{o[c][e]||=ve(o[c],e)||ve(o[A],e)||[]}):o[t][e]||=ve(o[t],e)||ve(o[A],e)||[],Object.keys(o).forEach(c=>{(t===A||t===c)&&Object.keys(o[c]).forEach(u=>{l.test(u)&&o[c][u].push([r,i])})}),Object.keys(s).forEach(c=>{(t===A||t===c)&&Object.keys(s[c]).forEach(u=>l.test(u)&&s[c][u].push([r,i]))});return}let a=Et(e)||[e];for(let l=0,c=a.length;l<c;l++){let u=a[l];Object.keys(s).forEach(d=>{(t===A||t===d)&&(s[d][u]||=[...ve(o[d],u)||ve(o[A],u)||[]],s[d][u].push([r,i-c+l+1]))})}}match(t,e){xc();let r=this.#r();return this.match=(o,s)=>{let i=r[o]||r[A],a=i[2][s];if(a)return a;let l=s.match(i[0]);if(!l)return[[],rs];let c=l.indexOf("",1);return[i[1][c],l]},this.match(t,e)}#r(){let t=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#t)).forEach(e=>{t[e]||=this.#n(e)}),this.#t=this.#e=void 0,t}#n(t){let e=[],r=t===A;return[this.#t,this.#e].forEach(o=>{let s=o[t]?Object.keys(o[t]).map(i=>[i,o[t][i]]):[];s.length!==0?(r||=!0,e.push(...s)):t!==A&&e.push(...Object.keys(o[A]).map(i=>[i,o[A][i]]))}),r?wc(e):null}};var Ur=class{name="SmartRouter";#t=[];#e=[];constructor(t){this.#t=t.routers}add(t,e,r){if(!this.#e)throw new Error(xt);this.#e.push([t,e,r])}match(t,e){if(!this.#e)throw new Error("Fatal error");let r=this.#t,o=this.#e,s=r.length,i=0,a;for(;i<s;i++){let l=r[i];try{for(let c=0,u=o.length;c<u;c++)l.add(...o[c]);a=l.match(t,e)}catch(c){if(c instanceof wt)continue;throw c}this.match=l.match.bind(l),this.#t=[l],this.#e=void 0;break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.#e||this.#t.length!==1)throw new Error("No active router has been determined yet.");return this.#t[0]}};var Fe=Object.create(null),Fr=class{#t;#e;#r;#n=0;#s=Fe;constructor(t,e,r){if(this.#e=r||Object.create(null),this.#t=[],t&&e){let o=Object.create(null);o[t]={handler:e,possibleKeys:[],score:0},this.#t=[o]}this.#r=[]}insert(t,e,r){this.#n=++this.#n;let o=this,s=Fo(e),i=[];for(let a=0,l=s.length;a<l;a++){let c=s[a],u=s[a+1],d=$o(c,u),m=Array.isArray(d)?d[0]:c;if(m in o.#e){o=o.#e[m],d&&i.push(d[1]);continue}o.#e[m]=new Fr,d&&(o.#r.push(d),i.push(d[1])),o=o.#e[m]}return o.#t.push({[t]:{handler:r,possibleKeys:i.filter((a,l,c)=>c.indexOf(a)===l),score:this.#n}}),o}#o(t,e,r,o){let s=[];for(let i=0,a=t.#t.length;i<a;i++){let l=t.#t[i],c=l[e]||l[A],u={};if(c!==void 0&&(c.params=Object.create(null),s.push(c),r!==Fe||o&&o!==Fe))for(let d=0,m=c.possibleKeys.length;d<m;d++){let h=c.possibleKeys[d],p=u[c.score];c.params[h]=o?.[h]&&!p?o[h]:r[h]??o?.[h],u[c.score]=!0}}return s}search(t,e){let r=[];this.#s=Fe;let s=[this],i=Nr(e),a=[];for(let l=0,c=i.length;l<c;l++){let u=i[l],d=l===c-1,m=[];for(let h=0,p=s.length;h<p;h++){let f=s[h],v=f.#e[u];v&&(v.#s=f.#s,d?(v.#e["*"]&&r.push(...this.#o(v.#e["*"],t,f.#s)),r.push(...this.#o(v,t,f.#s))):m.push(v));for(let g=0,y=f.#r.length;g<y;g++){let O=f.#r[g],P=f.#s===Fe?{}:{...f.#s};if(O==="*"){let H=f.#e["*"];H&&(r.push(...this.#o(H,t,f.#s)),H.#s=P,m.push(H));continue}let[S,N,$]=O;if(!u&&!($ instanceof RegExp))continue;let R=f.#e[S],G=i.slice(l).join("/");if($ instanceof RegExp){let H=$.exec(G);if(H){if(P[N]=H[0],r.push(...this.#o(R,t,f.#s,P)),Object.keys(R.#e).length){R.#s=P;let U=H[0].match(/\//)?.length??0;(a[U]||=[]).push(R)}continue}}($===!0||$.test(u))&&(P[N]=u,d?(r.push(...this.#o(R,t,P,f.#s)),R.#e["*"]&&r.push(...this.#o(R.#e["*"],t,P,f.#s))):(R.#s=P,m.push(R)))}}s=m.concat(a.shift()??[])}return r.length>1&&r.sort((l,c)=>l.score-c.score),[r.map(({handler:l,params:c})=>[l,c])]}};var $r=class{name="TrieRouter";#t;constructor(){this.#t=new Fr}add(t,e,r){let o=Et(e);if(o){for(let s=0,i=o.length;s<i;s++)this.#t.insert(t,o[s],r);return}this.#t.insert(t,e,r)}match(t,e){return this.#t.search(t,e)}};var E=class extends qr{constructor(t={}){super(t),this.router=t.router??new Ur({routers:[new jr,new $r]})}};var ns=t=>{let r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...t},o=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,l){function c(d,m){a.res.headers.set(d,m)}let u=await o(a.req.header("origin")||"",a);if(u&&c("Access-Control-Allow-Origin",u),r.origin!=="*"){let d=a.req.header("Vary");d?c("Vary",d):c("Vary","Origin")}if(r.credentials&&c("Access-Control-Allow-Credentials","true"),r.exposeHeaders?.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());let d=await s(a.req.header("origin")||"",a);d.length&&c("Access-Control-Allow-Methods",d.join(","));let m=r.allowHeaders;if(!m?.length){let h=a.req.header("Access-Control-Request-Headers");h&&(m=h.split(/\s*,\s*/))}return m?.length&&(c("Access-Control-Allow-Headers",m.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await l()}};function Vr(t){return t.CORS_ORIGINS?t.CORS_ORIGINS.split(",").map(e=>e.trim()):t.SITE_URL?[t.SITE_URL]:["*"]}var Kr=["GET","POST","PUT","DELETE","OPTIONS"],Br=["Content-Type","X-Admin-Token"],Rt=["US","CA","GB","AU","DE","FR","IT","ES","NL","BE","AT","CH","SE","NO","DK","FI","IE","PT","PL","CZ","HU","GR","RO","BG","HR","SI","SK","EE","LV","LT","LU","MT","CY"],zr=["drive.google.com","drive.usercontent.google.com","lh3.googleusercontent.com"],Wr=86400,Jr=864e5,Q={PRODUCTS_LIST:"products:all",COLLECTIONS_LIST:"collections:all",MEDIA_LIST:"media:all",STORE_SETTINGS:"store:settings",DRIVE_TOKEN:"drive:oauth:tokens",DRIVE_FOLDER_PREFIX:"drive:folder",ADMIN_TOKEN_PREFIX:"admin_token:"},Yr=["primary","secondary","accent","text","background","card"],At=0,Ct=4;function is(t={}){let e=Vr(t),r=e.length===1&&e[0]==="*"?"*":o=>{let s=o;return e.includes("*")||e.includes(s)?s:e[0]};return ns({origin:r,allowMethods:Kr,allowHeaders:Br,credentials:!0})}var ee=class extends Error{constructor(e,r=500,o=null){super(e),this.name="APIError",this.statusCode=r,this.details=o}toJSON(){return{error:this.message,status:this.statusCode,...this.details&&{details:this.details}}}},x=class extends ee{constructor(e,r=null){super(e,400,r),this.name="ValidationError"}},It=class extends ee{constructor(e="Authentication required"){super(e,401),this.name="AuthenticationError"}},Mt=class extends ee{constructor(e="Too many requests"){super(e,429),this.name="RateLimitError"}};var V=class extends ee{constructor(e="Resource not found"){super(e,404),this.name="NotFoundError"}};function Xr(t,e){return console.error("Error in request handler:",t),t instanceof ee?e.json(t.toJSON(),t.statusCode):t.name==="ValidationError"||t.status===400?e.json({error:t.message||"Validation error",status:400},400):t.name==="AuthenticationError"||t.status===401?e.json({error:t.message||"Authentication required",status:401},401):t.name==="NotFoundError"||t.status===404?e.json({error:t.message||"Resource not found",status:404},404):e.json({error:t.message||"Internal server error",status:500},500)}function T(t){return async(e,r)=>{try{return await t(e,r)}catch(o){return Xr(o,e)}}}function _(t){if(!t||typeof t!="object")return console.error("getKVNamespace: Invalid environment object"),null;let e=["OPENSHOP-TEST3_KV","OPENSHOP_TEST3_KV","OPENSHOP_KV"];for(let s of e)if(s in t&&t[s]){let i=t[s];if(Qr(i))return console.log(`Found KV namespace via direct access: ${s}`),i}let r=Object.keys(t).find(s=>(s.endsWith("_KV")||s.endsWith("-KV")||s.includes("KV"))&&Qr(t[s]));if(r)return console.log(`Found KV namespace via search: ${r}`),t[r];let o=Object.values(t).find(s=>Qr(s));return o?(console.log("Found KV namespace via fallback"),o):(console.error("No KV namespace found! Available bindings:",Object.keys(t)),console.error("Environment value types:",Object.values(t).map(s=>typeof s)),null)}function Qr(t){return t&&typeof t.get=="function"&&typeof t.put=="function"&&typeof t.delete=="function"&&typeof t.list=="function"}function kt(){let t=typeof globalThis<"u"?globalThis.crypto:null;if(!t)throw new Error("Web Crypto API is not available in this environment");return t}function Nt(t=16){let e=kt();if(typeof e.getRandomValues!="function")throw new Error("crypto.getRandomValues is not available");let r=new Uint8Array(t);return e.getRandomValues(r),Array.from(r,o=>o.toString(16).padStart(2,"0")).join("")}function Dt(){let t=kt();return typeof t.randomUUID=="function"?t.randomUUID().replace(/-/g,""):Nt(32)}async function Gt(t){if(typeof t!="string"||t.length===0)throw new Error("Token must be a non-empty string for hashing");let e=kt();if(!e.subtle||typeof e.subtle.digest!="function")throw new Error("Web Crypto API is not available for hashing tokens");let o=new TextEncoder().encode(t),s=await e.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(s)).map(a=>a.toString(16).padStart(2,"0")).join("")}async function as(t,e,r=1e5){let o=kt();if(!o.subtle)throw new Error("Web Crypto API is not available for password hashing");let i=new TextEncoder().encode(t),a=new Uint8Array(e.match(/.{1,2}/g).map(u=>parseInt(u,16))),l=await o.subtle.importKey("raw",i,{name:"PBKDF2"},!1,["deriveBits"]),c=await o.subtle.deriveBits({name:"PBKDF2",salt:a,iterations:r,hash:"SHA-256"},l,256);return Array.from(new Uint8Array(c)).map(u=>u.toString(16).padStart(2,"0")).join("")}async function cs(t,e){try{let[r,o,s]=e.split(":"),i=parseInt(r,10);return!i||!o||!s?!1:await as(t,o,i)===s}catch{return!1}}function Oc(t=16){return Nt(t)}async function ls(t,e=1e5){let r=Oc(16),o=await as(t,r,e);return`${e}:${r}:${o}`}async function us(t,e){let r;try{t&&typeof t.header=="function"?r=t.header("X-Admin-Token")||t.header("x-admin-token"):t&&t.headers&&typeof t.headers.get=="function"?r=t.headers.get("X-Admin-Token")||t.headers.get("x-admin-token"):t&&t.raw&&t.raw.headers&&typeof t.raw.headers.get=="function"&&(r=t.raw.headers.get("X-Admin-Token")||t.raw.headers.get("x-admin-token"))}catch(o){console.error("Auth middleware - error reading admin token header:",o)}if(!r)return{isValid:!1,error:"Admin authentication required",status:401};try{let o=_(e);if(!o)return console.error("Auth middleware - KV namespace is undefined"),{isValid:!1,error:"KV namespace not available",status:500};let s=await Gt(r),i=`${Q.ADMIN_TOKEN_PREFIX}${s}`,a=await o.get(i);if(!a)return{isValid:!1,error:"Invalid or expired admin token",status:401};let l=parseInt(a);return Date.now()-l>Jr?(await o.delete(i),{isValid:!1,error:"Admin session expired",status:401}):{isValid:!0}}catch(o){return console.error("Admin auth verification error:",o),{isValid:!1,error:"Authentication verification failed",status:500}}}var z=class{constructor(e){this.namespace=e}async createProduct(e){let r=`product:${e.id}`,o={...e,images:Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:[]};await this.namespace.put(r,JSON.stringify(o));let s=await this.namespace.get("products:all"),i=s?JSON.parse(s):[];return i.push(e.id),await this.namespace.put("products:all",JSON.stringify(i)),o}async getProduct(e){let r=`product:${e}`,o=await this.namespace.get(r);return o?JSON.parse(o):null}async updateProduct(e,r){let o=await this.getProduct(e);if(!o)throw new Error("Product not found");let s={...o,...r,images:Array.isArray(r.images)?r.images:r.imageUrl?[r.imageUrl]:o.images||[]},i=`product:${e}`;return await this.namespace.put(i,JSON.stringify(s)),s}async deleteProduct(e){let r=`product:${e}`;await this.namespace.delete(r);let o=await this.namespace.get("products:all");if(o){let i=JSON.parse(o).filter(a=>a!==e);await this.namespace.put("products:all",JSON.stringify(i))}}async getAllProducts(){let e=await this.namespace.get("products:all");if(!e)return[];let r=JSON.parse(e);return(await Promise.all(r.map(s=>this.getProduct(s)))).filter(Boolean)}async createCollection(e){let r=`collection:${e.id}`;await this.namespace.put(r,JSON.stringify(e));let o=await this.namespace.get("collections:all"),s=o?JSON.parse(o):[];return s.push(e.id),await this.namespace.put("collections:all",JSON.stringify(s)),e}async getCollection(e){let r=`collection:${e}`,o=await this.namespace.get(r);return o?JSON.parse(o):null}async updateCollection(e,r){let o=await this.getCollection(e);if(!o)throw new Error("Collection not found");let s={...o,...r},i=`collection:${e}`;return await this.namespace.put(i,JSON.stringify(s)),s}async deleteCollection(e){let r=`collection:${e}`;await this.namespace.delete(r);let o=await this.namespace.get("collections:all");if(o){let i=JSON.parse(o).filter(a=>a!==e);await this.namespace.put("collections:all",JSON.stringify(i))}}async getAllCollections(){let e=await this.namespace.get("collections:all");if(!e)return[];let r=JSON.parse(e);return(await Promise.all(r.map(s=>this.getCollection(s)))).filter(Boolean)}async getProductsByCollection(e){return(await this.getAllProducts()).filter(o=>o.collectionId===e)}async createMediaItem(e){let r=e.id;if(!r)throw new Error("Media item missing id");let o=`media:${r}`,s={id:r,url:String(e.url||""),source:e.source||"unknown",filename:e.filename||"",mimeType:e.mimeType||"",driveFileId:e.driveFileId||"",createdAt:typeof e.createdAt=="number"?e.createdAt:Date.now(),updatedAt:Date.now()};await this.namespace.put(o,JSON.stringify(s));let i="media:all",a=await this.namespace.get(i),l=a?JSON.parse(a):[];return l.includes(r)||l.push(r),await this.namespace.put(i,JSON.stringify(l)),s}async getMediaItem(e){let r=`media:${e}`,o=await this.namespace.get(r);return o?JSON.parse(o):null}async deleteMediaItem(e){let r=`media:${e}`;await this.namespace.delete(r);let o="media:all",s=await this.namespace.get(o);if(s){let a=JSON.parse(s).filter(l=>l!==e);await this.namespace.put(o,JSON.stringify(a))}}async getAllMediaItems(){let r=await this.namespace.get("media:all");if(!r)return[];let o=JSON.parse(r);return(await Promise.all(o.map(i=>this.getMediaItem(i)))).filter(Boolean)}};var Zr={logoType:"text",logoText:"OpenShop",logoImageUrl:"",storeName:"OpenShop",storeDescription:"Your amazing online store",heroImageUrl:"",heroTitle:"Welcome to OpenShop",heroSubtitle:"Discover amazing products at unbeatable prices. Built on Cloudflare for lightning-fast performance.",contactEmail:"contact@example.com",businessName:"",businessAddressLine1:"",businessAddressLine2:"",businessCity:"",businessState:"",businessPostalCode:"",businessCountry:"",productLimit:null},W=class{constructor(e){this.kv=new z(e)}async getSettings(){let e=await this.kv.namespace.get(Q.STORE_SETTINGS);if(e){let r=JSON.parse(e);return{...Zr,...r}}return Zr}async updateSettings(e){if(!e.logoType||!["text","image"].includes(e.logoType))throw new Error('Invalid logoType. Must be "text" or "image"');let r={...Zr,...e};return await this.kv.namespace.put(Q.STORE_SETTINGS,JSON.stringify(r)),r}async getContactEmail(){return{email:(await this.getSettings()).contactEmail||"contact@example.com"}}};var L=class{constructor(e){this.kv=new z(e)}async getAllProducts(){return(await this.kv.getAllProducts()).filter(r=>!r.archived)}async getAllProductsAdmin(){return await this.kv.getAllProducts()}async getProduct(e){let r=await this.kv.getProduct(e);if(!r)throw new V("Product not found");return r}async createProduct(e){return await this.kv.createProduct(e)}async updateProduct(e,r){if(!await this.kv.getProduct(e))throw new V("Product not found");return await this.kv.updateProduct(e,r)}async deleteProduct(e){if(!await this.kv.getProduct(e))throw new V("Product not found");await this.kv.deleteProduct(e)}async getProductsByCollection(e){return(await this.kv.getProductsByCollection(e)).filter(o=>!o.archived)}};async function ds(t,e){if(t.req.method!=="POST"||t.req.path!=="/api/admin/products")return e();try{let r=_(t.env);if(!r)return console.error("Product limit middleware - KV namespace not available"),e();let i=(await new W(r).getSettings()).productLimit;if((i==null||i==="")&&t.env.PRODUCT_LIMIT&&(i=t.env.PRODUCT_LIMIT),i==null||i==="")return e();let a=parseInt(i,10);if(isNaN(a)||a<=0)return e();let u=(await new L(r).getAllProducts()).length;return u>=a?t.json({error:"Product limit reached",message:`You have reached your product limit of ${a}. Please delete products or upgrade your plan to add more.`,limit:a,current:u},403):e()}catch(r){return console.error("Product limit middleware error:",r),e()}}var eo=new E;eo.get("/",T(async t=>{let e=_(t.env),o=await new L(e).getAllProducts();return t.json(o)}));eo.get("/:id",T(async t=>{let e=_(t.env),o=await new L(e).getProduct(t.req.param("id"));return t.json(o)}));var ms=eo;var F=class{constructor(e){this.kv=new z(e)}async getAllCollections(){return(await this.kv.getAllCollections()).filter(r=>!r.archived)}async getAllCollectionsAdmin(){return await this.kv.getAllCollections()}async getCollection(e){let r=await this.kv.getCollection(e);if(!r)throw new V("Collection not found");return r}async createCollection(e){return await this.kv.createCollection(e)}async updateCollection(e,r){if(!await this.kv.getCollection(e))throw new V("Collection not found");return await this.kv.updateCollection(e,r)}async deleteCollection(e){if(!await this.kv.getCollection(e))throw new V("Collection not found");await this.kv.deleteCollection(e)}async getProductsInCollection(e){let r=await this.kv.getCollection(e);if(!r)throw new V("Collection not found");let o=await this.kv.getProductsByCollection(e);return r.archived?[]:o.filter(s=>!s.archived)}};var Ht=new E;Ht.get("/",T(async t=>{let e=_(t.env),o=await new F(e).getAllCollections();return t.json(o)}));Ht.get("/:id",T(async t=>{let e=_(t.env),o=await new F(e).getCollection(t.req.param("id"));return t.json(o)}));Ht.get("/:id/products",T(async t=>{let e=_(t.env),o=await new F(e).getProductsInCollection(t.req.param("id"));return t.json(o)}));var hs=Ht;var qt="storefront:theme",bc=/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/,oo=[{id:"inter",label:"Inter",stack:"'Inter', 'system-ui', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},{id:"roboto",label:"Roboto",stack:"'Roboto', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"},{id:"montserrat",label:"Montserrat",stack:"'Montserrat', 'Segoe UI', sans-serif"},{id:"poppins",label:"Poppins",stack:"'Poppins', 'Segoe UI', sans-serif"},{id:"lora",label:"Lora",stack:"'Lora', 'Georgia', serif"}],ro=oo.reduce((t,e)=>(t[e.id]=e,t),{}),M={colors:{primary:"#1e293b",secondary:"#475569",accent:"#3b82f6",text:"#0f172a",background:"#f8fafc",card:"#ffffff"},typography:{fontId:"inter"},corners:{enabled:!0,radiusMultiplier:1}};function Lt(t,e,r){return Math.min(Math.max(t,e),r)}function so(t){if(!t)return null;let r=(t.length===4?`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`:t).replace("#",""),o=parseInt(r,16);return Number.isNaN(o)?null:{r:o>>16&255,g:o>>8&255,b:o&255}}function gs({r:t,g:e,b:r}){let o=s=>s.toString(16).padStart(2,"0");return`#${o(Lt(Math.round(to(t)),0,255))}${o(Lt(Math.round(to(e)),0,255))}${o(Lt(Math.round(to(r)),0,255))}`}function to(t){return Number.isFinite(t)?t:0}function ye(t,e,r){return t+(e-t)*r}function ps(t,e=.1){let r=so(t);return r?gs({r:ye(r.r,255,e),g:ye(r.g,255,e),b:ye(r.b,255,e)}):t}function fs(t,e=.1){let r=so(t);return r?gs({r:ye(r.r,0,e),g:ye(r.g,0,e),b:ye(r.b,0,e)}):t}function vs(t){let e=so(t);return e&&(.299*e.r+.587*e.g+.114*e.b)/255>.6?"#0f172a":"#ffffff"}function ge(t,e){return typeof t!="string"?e:bc.test(t.trim())?t.trim():e}function Rc(t){return ro[t]?t:M.typography.fontId}function Ac(t){if(typeof t=="string"&&t.trim()!==""){let e=Number(t);Number.isNaN(e)||(t=e)}return(typeof t!="number"||Number.isNaN(t))&&(t=M.corners.radiusMultiplier),Lt(Math.abs(t),0,4)}function jt(t={}){let e=t.colors||{},r=t.typography||t.font,o=t.corners||t.radius,s={primary:ge(e.primary,M.colors.primary),secondary:ge(e.secondary,M.colors.secondary),accent:ge(e.accent,M.colors.accent),text:ge(e.text,M.colors.text),background:ge(e.background,M.colors.background),card:ge(e.card,M.colors.card)},i={fontId:Rc(r?.fontId??r?.font??r?.id)},a={enabled:o?.enabled!==void 0?!!o.enabled:M.corners.enabled,radiusMultiplier:Ac(o?.radiusMultiplier??o?.multiplier??o?.value)};return{colors:s,typography:i,corners:a}}function ys(t){let{colors:e,typography:r,corners:o}=t,{fontId:s}=r,i=ro[s]||ro[M.typography.fontId],a=o.enabled?o.radiusMultiplier*12:0;return{colors:{onPrimary:vs(e.primary),onSecondary:vs(e.secondary),primaryHover:fs(e.primary,.12),secondaryHover:fs(e.secondary,.12),accentSoft:ps(e.accent,.4),background:e.background,surface:"#ffffff",mutedText:ps(e.text,.35)},typography:{fontFamily:i.stack,fontLabel:i.label},corners:{radiusPx:a,radiusSm:o.enabled?Math.max(a*.5,2):0,radiusLg:o.enabled?a*1.5:0}}}function Cc(t){let e=jt(t),r=ys(e);return{"--storefront-color-primary":e.colors.primary,"--storefront-color-primary-hover":r.colors.primaryHover,"--storefront-color-primary-contrast":r.colors.onPrimary,"--storefront-color-secondary":e.colors.secondary,"--storefront-color-secondary-hover":r.colors.secondaryHover,"--storefront-color-secondary-contrast":r.colors.onSecondary,"--storefront-color-accent":e.colors.accent,"--storefront-color-accent-soft":r.colors.accentSoft,"--storefront-color-text":e.colors.text,"--storefront-color-text-muted":r.colors.mutedText,"--storefront-color-background":r.colors.background,"--storefront-color-surface":r.colors.surface,"--storefront-color-card":e.colors.card,"--storefront-font-family":r.typography.fontFamily,"--storefront-radius-base":`${r.corners.radiusPx}px`,"--storefront-radius-sm":`${r.corners.radiusSm}px`,"--storefront-radius-lg":`${r.corners.radiusLg}px`}}function $e(t={}){let e=jt(t.theme??t),r={...M,...e,colors:{...M.colors,...e.colors},typography:{...M.typography,...e.typography},corners:{...M.corners,...e.corners}},{typography:o,corners:s}=ys(r);return{...r,typography:{...r.typography,fontFamily:o.fontFamily,fontLabel:o.fontLabel},corners:{...r.corners,radiusPx:s.radiusPx,radiusSm:s.radiusSm,radiusLg:s.radiusLg},meta:{updatedAt:t.updatedAt??null},cssVariables:Cc(r)}}var te=class{constructor(e){this.env=e,this.kv=_(e)}async getTheme(){try{let e=this.kv?await this.kv.get(qt):null,r=null;if(e)try{r=JSON.parse(e)}catch(o){console.error("Invalid theme JSON in KV, falling back to defaults:",o)}return $e(r||M)}catch(e){return console.error("Error fetching storefront theme:",e),$e(M)}}async updateTheme(e){if(!this.kv)throw new Error("KV namespace unavailable");let o={theme:jt(e),updatedAt:Date.now()};return await this.kv.put(qt,JSON.stringify(o)),$e(o)}async resetTheme(){if(!this.kv)throw new Error("KV namespace unavailable");return await this.kv.delete(qt),$e(M)}};var Ps=new E;Ps.get("/theme",T(async t=>{let r=await new te(t.env).getTheme();return t.json(r)}));var Ts=Ps;var em=globalThis.crypto||{};var _s=t=>({update:()=>{},digest:e=>""});var Ve=class{constructor(){}on(){return this}emit(){return!1}once(){return this}removeListener(){return this}};var re=class{computeHMACSignature(e,r){throw new Error("computeHMACSignature not implemented.")}computeHMACSignatureAsync(e,r){throw new Error("computeHMACSignatureAsync not implemented.")}computeSHA256Async(e){throw new Error("computeSHA256 not implemented.")}},Pe=class extends Error{};var Ut=class extends re{computeHMACSignature(e,r){return(void 0)("sha256",r).update(e,"utf8").digest("hex")}async computeHMACSignatureAsync(e,r){return await this.computeHMACSignature(e,r)}async computeSHA256Async(e){return new Uint8Array(await _s("sha256").update(e).digest())}};var io={};Pt(io,{default:()=>no,get:()=>Mc,request:()=>Ic});var no={},Ic=()=>{},Mc=()=>{};var co={};Pt(co,{default:()=>ao,get:()=>Nc,request:()=>kc});var ao={},kc=()=>{},Nc=()=>{};var D=class t{getClientName(){throw new Error("getClientName not implemented.")}makeRequest(e,r,o,s,i,a,l,c){throw new Error("makeRequest not implemented.")}static makeTimeoutError(){let e=new TypeError(t.TIMEOUT_ERROR_CODE);return e.code=t.TIMEOUT_ERROR_CODE,e}};D.CONNECTION_CLOSED_ERROR_CODES=["ECONNRESET","EPIPE"];D.TIMEOUT_ERROR_CODE="ETIMEDOUT";var oe=class{constructor(e,r){this._statusCode=e,this._headers=r}getStatusCode(){return this._statusCode}getHeaders(){return this._headers}getRawResponse(){throw new Error("getRawResponse not implemented.")}toStream(e){throw new Error("toStream not implemented.")}toJSON(){throw new Error("toJSON not implemented.")}};var Ss=no||io,Es=ao||co,Dc=new Ss.Agent({keepAlive:!0}),Gc=new Es.Agent({keepAlive:!0}),Ke=class extends D{constructor(e){super(),this._agent=e}getClientName(){return"node"}makeRequest(e,r,o,s,i,a,l,c){let u=l==="http",d=this._agent;return d||(d=u?Dc:Gc),new Promise((h,p)=>{let f=(u?Ss:Es).request({host:e,port:r,path:o,method:s,agent:d,headers:i,ciphers:"DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2:!MD5"});f.setTimeout(c,()=>{f.destroy(D.makeTimeoutError())}),f.on("response",v=>{h(new lo(v))}),f.on("error",v=>{p(v)}),f.once("socket",v=>{v.connecting?v.once(u?"connect":"secureConnect",()=>{f.write(a),f.end()}):(f.write(a),f.end())})})}},lo=class extends oe{constructor(e){super(e.statusCode,e.headers||{}),this._res=e}getRawResponse(){return this._res}toStream(e){return this._res.once("end",()=>e()),this._res}toJSON(){return new Promise((e,r)=>{let o="";this._res.setEncoding("utf8"),this._res.on("data",s=>{o+=s}),this._res.once("end",()=>{try{e(JSON.parse(o))}catch(s){r(s)}})})}};var xs=t=>new URLSearchParams(t).toString();var uo=["apiKey","idempotencyKey","stripeAccount","apiVersion","maxNetworkRetries","timeout","host","authenticator","stripeContext","additionalHeaders","streaming"];function ws(t){return t&&typeof t=="object"&&uo.some(e=>Object.prototype.hasOwnProperty.call(t,e))}function se(t,e){return xs(t,{serializeDate:r=>Math.floor(r.getTime()/1e3).toString(),arrayFormat:e=="v2"?"repeat":"indices"}).replace(/%5B/g,"[").replace(/%5D/g,"]")}var $t=(()=>{let t={"\n":"\\n",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"};return e=>{let r=e.replace(/["\n\r\u2028\u2029]/g,o=>t[o]);return o=>r.replace(/\{([\s\S]+?)\}/g,(s,i)=>{let a=o[i];return Lc(a)?encodeURIComponent(a):""})}})();function Lc(t){return["number","string","boolean"].includes(typeof t)}function Os(t){let e=t.match(/\{\w+\}/g);return e?e.map(r=>r.replace(/[{}]/g,"")):[]}function Te(t){if(!Array.isArray(t)||!t[0]||typeof t[0]!="object")return{};if(!ws(t[0]))return t.shift();let e=Object.keys(t[0]),r=e.filter(o=>uo.includes(o));return r.length>0&&r.length!==e.length&&ze(`Options found in arguments (${r.join(", ")}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options.`),{}}function Vt(t){let e={host:null,headers:{},settings:{},streaming:!1};if(t.length>0){let r=t[t.length-1];if(typeof r=="string")e.authenticator=Ft(t.pop());else if(ws(r)){let o=Object.assign({},t.pop()),s=Object.keys(o).filter(i=>!uo.includes(i));if(s.length&&ze(`Invalid options found (${s.join(", ")}); ignoring.`),o.apiKey&&(e.authenticator=Ft(o.apiKey)),o.idempotencyKey&&(e.headers["Idempotency-Key"]=o.idempotencyKey),o.stripeAccount&&(e.headers["Stripe-Account"]=o.stripeAccount),o.stripeContext){if(e.headers["Stripe-Account"])throw new Error("Can't specify both stripeAccount and stripeContext.");e.headers["Stripe-Context"]=o.stripeContext}if(o.apiVersion&&(e.headers["Stripe-Version"]=o.apiVersion),Number.isInteger(o.maxNetworkRetries)&&(e.settings.maxNetworkRetries=o.maxNetworkRetries),Number.isInteger(o.timeout)&&(e.settings.timeout=o.timeout),o.host&&(e.host=o.host),o.authenticator){if(o.apiKey)throw new Error("Can't specify both apiKey and authenticator.");if(typeof o.authenticator!="function")throw new Error("The authenticator must be a function receiving a request as the first parameter.");e.authenticator=o.authenticator}o.additionalHeaders&&(e.headers=o.additionalHeaders),o.streaming&&(e.streaming=!0)}}return e}function bs(t){let e=this,r=Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(...o){e.apply(this,o)};return Object.assign(r,e),r.prototype=Object.create(e.prototype),Object.assign(r.prototype,t),r}function Kt(t){if(typeof t!="object")throw new Error("Argument must be an object");return Object.keys(t).reduce((e,r)=>(t[r]!=null&&(e[r]=t[r]),e),{})}function Rs(t){return t&&typeof t=="object"?Object.keys(t).reduce((e,r)=>(e[qc(r)]=t[r],e),{}):t}function qc(t){return t.split("-").map(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()).join("-")}function Be(t,e){return e?t.then(r=>{setTimeout(()=>{e(null,r)},0)},r=>{setTimeout(()=>{e(r,null)},0)}):t}function As(t){return t==="OAuth"?"oauth":t[0].toLowerCase()+t.substring(1)}function ze(t){return typeof process.emitWarning!="function"?console.warn(`Stripe: ${t}`):process.emitWarning(t,"Stripe")}function jc(t){let e=typeof t;return(e==="function"||e==="object")&&!!t}function Cs(t){let e={},r=(o,s)=>{Object.entries(o).forEach(([i,a])=>{let l=s?`${s}[${i}]`:i;if(jc(a)){if(!(a instanceof Uint8Array)&&!Object.prototype.hasOwnProperty.call(a,"data"))return r(a,l);e[l]=a}else e[l]=String(a)})};return r(t,null),e}function Bt(t,e,r){if(!Number.isInteger(e)){if(r!==void 0)return r;throw new Error(`${t} must be an integer`)}return e}function Is(){return typeof process>"u"?{}:{lang_version:process.version,platform:process.platform}}function Ft(t){let e=r=>(r.headers.Authorization="Bearer "+t,Promise.resolve());return e._apiKey=t,e}function Ms(t){let e=t.reduce((s,i)=>s+i.length,0),r=new Uint8Array(e),o=0;return t.forEach(s=>{r.set(s,o),o+=s.length}),r}function Uc(t,e){return this[t]instanceof Date?Math.floor(this[t].getTime()/1e3).toString():e}function ks(t){return JSON.stringify(t,Uc)}function _e(t){return t&&t.startsWith("/v2")?"v2":"v1"}function zt(t){return Array.isArray(t)?t.join(", "):String(t)}function Ns(t){let e=Array.isArray(t)?t[0]:t;return Number(e)}function Ds(t){return Object.entries(t).map(([e,r])=>[e,zt(r)])}var Wt=class t extends D{constructor(e){if(super(),!e){if(!globalThis.fetch)throw new Error("fetch() function not provided and is not defined in the global scope. You must provide a fetch implementation.");e=globalThis.fetch}globalThis.AbortController?this._fetchFn=t.makeFetchWithAbortTimeout(e):this._fetchFn=t.makeFetchWithRaceTimeout(e)}static makeFetchWithRaceTimeout(e){return(r,o,s)=>{let i,a=new Promise((c,u)=>{i=setTimeout(()=>{i=null,u(D.makeTimeoutError())},s)}),l=e(r,o);return Promise.race([l,a]).finally(()=>{i&&clearTimeout(i)})}}static makeFetchWithAbortTimeout(e){return async(r,o,s)=>{let i=new AbortController,a=setTimeout(()=>{a=null,i.abort(D.makeTimeoutError())},s);try{return await e(r,Object.assign(Object.assign({},o),{signal:i.signal}))}catch(l){throw l.name==="AbortError"?D.makeTimeoutError():l}finally{a&&clearTimeout(a)}}}getClientName(){return"fetch"}async makeRequest(e,r,o,s,i,a,l,c){let u=l==="http",d=new URL(o,`${u?"http":"https"}://${e}`);d.port=r;let m=s=="POST"||s=="PUT"||s=="PATCH",h=a||(m?"":void 0),p=await this._fetchFn(d.toString(),{method:s,headers:Ds(i),body:typeof h=="object"?JSON.stringify(h):h},c);return new mo(p)}},mo=class t extends oe{constructor(e){super(e.status,t._transformHeadersToObject(e.headers)),this._res=e}getRawResponse(){return this._res}toStream(e){return e(),this._res.body}toJSON(){return this._res.json()}static _transformHeadersToObject(e){let r={};for(let o of e){if(!Array.isArray(o)||o.length!=2)throw new Error("Response objects produced by the fetch function given to FetchHttpClient do not have an iterable headers map. Response#headers should be an iterable object.");r[o[0]]=o[1]}return r}};var Jt=class extends re{constructor(e){super(),this.subtleCrypto=e||crypto.subtle}computeHMACSignature(e,r){throw new Pe("SubtleCryptoProvider cannot be used in a synchronous context.")}async computeHMACSignatureAsync(e,r){let o=new TextEncoder,s=await this.subtleCrypto.importKey("raw",o.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),i=await this.subtleCrypto.sign("hmac",s,o.encode(e)),a=new Uint8Array(i),l=new Array(a.length);for(let c=0;c<a.length;c++)l[c]=ho[a[c]];return l.join("")}async computeSHA256Async(e){return new Uint8Array(await this.subtleCrypto.digest("SHA-256",e))}},ho=new Array(256);for(let t=0;t<ho.length;t++)ho[t]=t.toString(16).padStart(2,"0");var Yt=class{constructor(){this._fetchFn=null,this._agent=null}getUname(){throw new Error("getUname not implemented.")}uuid4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)})}secureCompare(e,r){if(e.length!==r.length)return!1;let o=e.length,s=0;for(let i=0;i<o;++i)s|=e.charCodeAt(i)^r.charCodeAt(i);return s===0}createEmitter(){throw new Error("createEmitter not implemented.")}tryBufferData(e){throw new Error("tryBufferData not implemented.")}createNodeHttpClient(e){throw new Error("createNodeHttpClient not implemented.")}createFetchHttpClient(e){return new Wt(e)}createDefaultHttpClient(){throw new Error("createDefaultHttpClient not implemented.")}createNodeCryptoProvider(){throw new Error("createNodeCryptoProvider not implemented.")}createSubtleCryptoProvider(e){return new Jt(e)}createDefaultCryptoProvider(){throw new Error("createDefaultCryptoProvider not implemented.")}};var rr={};Pt(rr,{StripeAPIError:()=>Se,StripeAuthenticationError:()=>Ee,StripeCardError:()=>Xt,StripeConnectionError:()=>Ye,StripeError:()=>C,StripeIdempotencyError:()=>Qt,StripeInvalidGrantError:()=>Zt,StripeInvalidRequestError:()=>We,StripePermissionError:()=>Je,StripeRateLimitError:()=>xe,StripeSignatureVerificationError:()=>K,StripeUnknownError:()=>er,TemporarySessionExpiredError:()=>tr,generateV1Error:()=>Xe,generateV2Error:()=>po});var Xe=t=>{switch(t.type){case"card_error":return new Xt(t);case"invalid_request_error":return new We(t);case"api_error":return new Se(t);case"authentication_error":return new Ee(t);case"rate_limit_error":return new xe(t);case"idempotency_error":return new Qt(t);case"invalid_grant":return new Zt(t);default:return new er(t)}},po=t=>{switch(t.type){case"temporary_session_expired":return new tr(t)}switch(t.code){case"invalid_fields":return new We(t)}return Xe(t)},C=class extends Error{constructor(e={},r=null){var o;super(e.message),this.type=r||this.constructor.name,this.raw=e,this.rawType=e.type,this.code=e.code,this.doc_url=e.doc_url,this.param=e.param,this.detail=e.detail,this.headers=e.headers,this.requestId=e.requestId,this.statusCode=e.statusCode,this.message=(o=e.message)!==null&&o!==void 0?o:"",this.userMessage=e.user_message,this.charge=e.charge,this.decline_code=e.decline_code,this.payment_intent=e.payment_intent,this.payment_method=e.payment_method,this.payment_method_type=e.payment_method_type,this.setup_intent=e.setup_intent,this.source=e.source}};C.generate=Xe;var Xt=class extends C{constructor(e={}){super(e,"StripeCardError")}},We=class extends C{constructor(e={}){super(e,"StripeInvalidRequestError")}},Se=class extends C{constructor(e={}){super(e,"StripeAPIError")}},Ee=class extends C{constructor(e={}){super(e,"StripeAuthenticationError")}},Je=class extends C{constructor(e={}){super(e,"StripePermissionError")}},xe=class extends C{constructor(e={}){super(e,"StripeRateLimitError")}},Ye=class extends C{constructor(e={}){super(e,"StripeConnectionError")}},K=class extends C{constructor(e,r,o={}){super(o,"StripeSignatureVerificationError"),this.header=e,this.payload=r}},Qt=class extends C{constructor(e={}){super(e,"StripeIdempotencyError")}},Zt=class extends C{constructor(e={}){super(e,"StripeInvalidGrantError")}},er=class extends C{constructor(e={}){super(e,"StripeUnknownError")}},tr=class extends C{constructor(e={}){super(e,"TemporarySessionExpiredError")}};var Gs=()=>Promise.resolve({stdout:"",stderr:""});var fo=class extends C{},or=class extends Yt{constructor(){super(),this._exec=Gs,this._UNAME_CACHE=null}uuid4(){return void 0?(void 0)():super.uuid4()}getUname(){return this._UNAME_CACHE||(this._UNAME_CACHE=new Promise((e,r)=>{try{this._exec("uname -a",(o,s)=>{if(o)return e(null);e(s)})}catch{e(null)}})),this._UNAME_CACHE}secureCompare(e,r){if(!e||!r)throw new Error("secureCompare must receive two arguments");if(e.length!==r.length)return!1;if(void 0){let o=new TextEncoder,s=o.encode(e),i=o.encode(r);return(void 0)(s,i)}return super.secureCompare(e,r)}createEmitter(){return new Ve}tryBufferData(e){if(!(e.file.data instanceof Ve))return Promise.resolve(e);let r=[];return new Promise((o,s)=>{e.file.data.on("data",i=>{r.push(i)}).once("end",()=>{let i=Object.assign({},e);i.file.data=Ms(r),o(i)}).on("error",i=>{s(new fo({message:"An error occurred while attempting to process the file for upload.",detail:i}))})})}createNodeHttpClient(e){return new Ke(e)}createDefaultHttpClient(){return new Ke}createNodeCryptoProvider(){return new Ut}createDefaultCryptoProvider(){return this.createNodeCryptoProvider()}};var Fc=60,sr=class t{constructor(e,r){this._stripe=e,this._maxBufferedRequestMetric=r}_addHeadersDirectlyToObject(e,r){e.requestId=r["request-id"],e.stripeAccount=e.stripeAccount||r["stripe-account"],e.apiVersion=e.apiVersion||r["stripe-version"],e.idempotencyKey=e.idempotencyKey||r["idempotency-key"]}_makeResponseEvent(e,r,o){let s=Date.now(),i=s-e.request_start_time;return Kt({api_version:o["stripe-version"],account:o["stripe-account"],idempotency_key:o["idempotency-key"],method:e.method,path:e.path,status:r,request_id:this._getRequestId(o),elapsed:i,request_start_time:e.request_start_time,request_end_time:s})}_getRequestId(e){return e["request-id"]}_streamingResponseHandler(e,r,o){return s=>{let i=s.getHeaders(),a=()=>{let c=this._makeResponseEvent(e,s.getStatusCode(),i);this._stripe._emitter.emit("response",c),this._recordRequestMetrics(this._getRequestId(i),c.elapsed,r)},l=s.toStream(a);return this._addHeadersDirectlyToObject(l,i),o(null,l)}}_jsonResponseHandler(e,r,o,s){return i=>{let a=i.getHeaders(),l=this._getRequestId(a),c=i.getStatusCode(),u=this._makeResponseEvent(e,c,a);this._stripe._emitter.emit("response",u),i.toJSON().then(d=>{if(d.error){let m;throw typeof d.error=="string"&&(d.error={type:d.error,message:d.error_description}),d.error.headers=a,d.error.statusCode=c,d.error.requestId=l,c===401?m=new Ee(d.error):c===403?m=new Je(d.error):c===429?m=new xe(d.error):r==="v2"?m=po(d.error):m=Xe(d.error),m}return d},d=>{throw new Se({message:"Invalid JSON received from the Stripe API",exception:d,requestId:a["request-id"]})}).then(d=>{this._recordRequestMetrics(l,u.elapsed,o);let m=i.getRawResponse();this._addHeadersDirectlyToObject(m,a),Object.defineProperty(d,"lastResponse",{enumerable:!1,writable:!1,value:m}),s(null,d)},d=>s(d,null))}}static _generateConnectionErrorMessage(e){return`An error occurred with our connection to Stripe.${e>0?` Request was retried ${e} times.`:""}`}static _shouldRetry(e,r,o,s){return s&&r===0&&D.CONNECTION_CLOSED_ERROR_CODES.includes(s.code)?!0:r>=o?!1:e?e.getHeaders()["stripe-should-retry"]==="false"?!1:e.getHeaders()["stripe-should-retry"]==="true"||e.getStatusCode()===409||e.getStatusCode()>=500:!0}_getSleepTimeInMS(e,r=null){let o=this._stripe.getInitialNetworkRetryDelay(),s=this._stripe.getMaxNetworkRetryDelay(),i=Math.min(o*Math.pow(2,e-1),s);return i*=.5*(1+Math.random()),i=Math.max(o,i),Number.isInteger(r)&&r<=Fc&&(i=Math.max(i,r)),i*1e3}_getMaxNetworkRetries(e={}){return e.maxNetworkRetries!==void 0&&Number.isInteger(e.maxNetworkRetries)?e.maxNetworkRetries:this._stripe.getMaxNetworkRetries()}_defaultIdempotencyKey(e,r,o){let s=this._getMaxNetworkRetries(r),i=()=>`stripe-node-retry-${this._stripe._platformFunctions.uuid4()}`;if(o==="v2"){if(e==="POST"||e==="DELETE")return i()}else if(o==="v1"&&e==="POST"&&s>0)return i();return null}_makeHeaders({contentType:e,contentLength:r,apiVersion:o,clientUserAgent:s,method:i,userSuppliedHeaders:a,userSuppliedSettings:l,stripeAccount:c,stripeContext:u,apiMode:d}){let m={Accept:"application/json","Content-Type":e,"User-Agent":this._getUserAgentString(d),"X-Stripe-Client-User-Agent":s,"X-Stripe-Client-Telemetry":this._getTelemetryHeader(),"Stripe-Version":o,"Stripe-Account":c,"Stripe-Context":u,"Idempotency-Key":this._defaultIdempotencyKey(i,l,d)},h=i=="POST"||i=="PUT"||i=="PATCH";return(h||r)&&(h||ze(`${i} method had non-zero contentLength but no payload is expected for this verb`),m["Content-Length"]=r),Object.assign(Kt(m),Rs(a))}_getUserAgentString(e){let r=this._stripe.getConstant("PACKAGE_VERSION"),o=this._stripe._appInfo?this._stripe.getAppInfoAsString():"";return`Stripe/${e} NodeBindings/${r} ${o}`.trim()}_getTelemetryHeader(){if(this._stripe.getTelemetryEnabled()&&this._stripe._prevRequestMetrics.length>0){let e=this._stripe._prevRequestMetrics.shift();return JSON.stringify({last_request_metrics:e})}}_recordRequestMetrics(e,r,o){if(this._stripe.getTelemetryEnabled()&&e)if(this._stripe._prevRequestMetrics.length>this._maxBufferedRequestMetric)ze("Request metrics buffer is full, dropping telemetry message.");else{let s={request_id:e,request_duration_ms:r};o&&o.length>0&&(s.usage=o),this._stripe._prevRequestMetrics.push(s)}}_rawRequest(e,r,o,s){return new Promise((a,l)=>{let c;try{let p=e.toUpperCase();if(p!=="POST"&&o&&Object.keys(o).length!==0)throw new Error("rawRequest only supports params on POST requests. Please pass null and add your parameters to path.");let f=[].slice.call([o,s]),v=Te(f),g=p==="POST"?Object.assign({},v):null,y=Vt(f),O=y.headers,P=y.authenticator;c={requestMethod:p,requestPath:r,bodyData:g,queryData:{},authenticator:P,headers:O,host:y.host,streaming:!!y.streaming,settings:{},usage:["raw_request"]}}catch(p){l(p);return}function u(p,f){p?l(p):a(f)}let{headers:d,settings:m}=c,h=c.authenticator;this._request(c.requestMethod,c.host,r,c.bodyData,h,{headers:d,settings:m,streaming:c.streaming},c.usage,u)})}_request(e,r,o,s,i,a,l=[],c,u=null){var d;let m;i=(d=i??this._stripe._authenticator)!==null&&d!==void 0?d:null;let h=_e(o),p=(g,y,O,P,S)=>setTimeout(g,this._getSleepTimeInMS(P,S),y,O,P+1),f=(g,y,O)=>{let P=a.settings&&a.settings.timeout&&Number.isInteger(a.settings.timeout)&&a.settings.timeout>=0?a.settings.timeout:this._stripe.getApiField("timeout"),S={host:r||this._stripe.getApiField("host"),port:this._stripe.getApiField("port"),path:o,method:e,headers:Object.assign({},y),body:m,protocol:this._stripe.getApiField("protocol")};i(S).then(()=>{let N=this._stripe.getApiField("httpClient").makeRequest(S.host,S.port,S.path,S.method,S.headers,S.body,S.protocol,P),$=Date.now(),R=Kt({api_version:g,account:zt(y["Stripe-Account"]),idempotency_key:zt(y["Idempotency-Key"]),method:e,path:o,request_start_time:$}),G=O||0,H=this._getMaxNetworkRetries(a.settings||{});this._stripe._emitter.emit("request",R),N.then(U=>t._shouldRetry(U,G,H)?p(f,g,y,G,Ns(U.getHeaders()["retry-after"])):a.streaming&&U.getStatusCode()<400?this._streamingResponseHandler(R,l,c)(U):this._jsonResponseHandler(R,h,l,c)(U)).catch(U=>{if(t._shouldRetry(null,G,H,U))return p(f,g,y,G,null);{let qo=U.code&&U.code===D.TIMEOUT_ERROR_CODE;return c(new Ye({message:qo?`Request aborted due to timeout being reached (${P}ms)`:t._generateConnectionErrorMessage(G),detail:U}))}})}).catch(N=>{throw new C({message:"Unable to authenticate the request",exception:N})})},v=(g,y)=>{if(g)return c(g);m=y,this._stripe.getClientUserAgent(O=>{let P=this._stripe.getApiField("version"),S=this._makeHeaders({contentType:h=="v2"?"application/json":"application/x-www-form-urlencoded",contentLength:m.length,apiVersion:P,clientUserAgent:O,method:e,userSuppliedHeaders:a.headers,userSuppliedSettings:a.settings,stripeAccount:h=="v2"?null:this._stripe.getApiField("stripeAccount"),stripeContext:h=="v2"?this._stripe.getApiField("stripeContext"):null,apiMode:h});f(P,S,0)})};if(u)u(e,s,a.headers,v);else{let g;h=="v2"?g=s?ks(s):"":g=se(s||{},h),v(null,g)}}};var nr=class{constructor(e,r,o,s){this.index=0,this.pagePromise=e,this.promiseCache={currentPromise:null},this.requestArgs=r,this.spec=o,this.stripeResource=s}async iterate(e){if(!(e&&e.data&&typeof e.data.length=="number"))throw Error("Unexpected: Stripe API response does not have a well-formed `data` array.");let r=Ls(this.requestArgs);if(this.index<e.data.length){let o=r?e.data.length-1-this.index:this.index,s=e.data[o];return this.index+=1,{value:s,done:!1}}else if(e.has_more){this.index=0,this.pagePromise=this.getNextPage(e);let o=await this.pagePromise;return this.iterate(o)}return{done:!0,value:void 0}}getNextPage(e){throw new Error("Unimplemented")}async _next(){return this.iterate(await this.pagePromise)}next(){if(this.promiseCache.currentPromise)return this.promiseCache.currentPromise;let e=(async()=>{let r=await this._next();return this.promiseCache.currentPromise=null,r})();return this.promiseCache.currentPromise=e,e}},go=class extends nr{getNextPage(e){let r=Ls(this.requestArgs),o=Bc(e,r);return this.stripeResource._makeRequest(this.requestArgs,this.spec,{[r?"ending_before":"starting_after"]:o})}},yo=class extends nr{getNextPage(e){if(!e.next_page)throw Error("Unexpected: Stripe API response does not have a well-formed `next_page` field, but `has_more` was true.");return this.stripeResource._makeRequest(this.requestArgs,this.spec,{page:e.next_page})}},Po=class{constructor(e,r,o,s){this.currentPageIterator=(async()=>(await e).data[Symbol.iterator]())(),this.nextPageUrl=(async()=>(await e).next_page_url||null)(),this.requestArgs=r,this.spec=o,this.stripeResource=s}async turnPage(){let e=await this.nextPageUrl;if(!e)return null;this.spec.fullPath=e;let r=await this.stripeResource._makeRequest([],this.spec,{});return this.nextPageUrl=Promise.resolve(r.next_page_url),this.currentPageIterator=Promise.resolve(r.data[Symbol.iterator]()),this.currentPageIterator}async next(){{let o=(await this.currentPageIterator).next();if(!o.done)return{done:!1,value:o.value}}let e=await this.turnPage();if(!e)return{done:!0,value:void 0};let r=e.next();return r.done?{done:!0,value:void 0}:{done:!1,value:r.value}}},Hs=(t,e,r,o)=>{let s=_e(r.fullPath||r.path);return s!=="v2"&&r.methodType==="search"?vo(new yo(o,e,r,t)):s!=="v2"&&r.methodType==="list"?vo(new go(o,e,r,t)):s==="v2"&&r.methodType==="list"?vo(new Po(o,e,r,t)):null},vo=t=>{let e=zc((...s)=>t.next(...s)),r=Wc(e),o={autoPagingEach:e,autoPagingToArray:r,next:()=>t.next(),return:()=>({}),[$c()]:()=>o};return o};function $c(){return typeof Symbol<"u"&&Symbol.asyncIterator?Symbol.asyncIterator:"@@asyncIterator"}function Vc(t){if(t.length<2)return null;let e=t[1];if(typeof e!="function")throw Error(`The second argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);return e}function Kc(t){if(t.length===0)return;let e=t[0];if(typeof e!="function")throw Error(`The first argument to autoPagingEach, if present, must be a callback function; received ${typeof e}`);if(e.length===2)return e;if(e.length>2)throw Error(`The \`onItem\` callback function passed to autoPagingEach must accept at most two arguments; got ${e}`);return function(o,s){let i=e(o);s(i)}}function Bc(t,e){let r=e?0:t.data.length-1,o=t.data[r],s=o&&o.id;if(!s)throw Error("Unexpected: No `id` found on the last item while auto-paging a list.");return s}function zc(t){return function(){let r=[].slice.call(arguments),o=Kc(r),s=Vc(r);if(r.length>2)throw Error(`autoPagingEach takes up to two arguments; received ${r}`);let i=Jc(t,o);return Be(i,s)}}function Wc(t){return function(r,o){let s=r&&r.limit;if(!s)throw Error("You must pass a `limit` option to autoPagingToArray, e.g., `autoPagingToArray({limit: 1000});`.");if(s>1e4)throw Error("You cannot specify a limit of more than 10,000 items to fetch in `autoPagingToArray`; use `autoPagingEach` to iterate through longer lists.");let i=new Promise((a,l)=>{let c=[];t(u=>{if(c.push(u),c.length>=s)return!1}).then(()=>{a(c)}).catch(l)});return Be(i,o)}}function Jc(t,e){return new Promise((r,o)=>{function s(i){if(i.done){r();return}let a=i.value;return new Promise(l=>{e(a,l)}).then(l=>l===!1?s({done:!0,value:void 0}):t().then(s))}t().then(s).catch(o)})}function Ls(t){let e=[].slice.call(t);return!!Te(e).ending_before}function qs(t){if(t.path!==void 0&&t.fullPath!==void 0)throw new Error(`Method spec specified both a 'path' (${t.path}) and a 'fullPath' (${t.fullPath}).`);return function(...e){let r=typeof e[e.length-1]=="function"&&e.pop();t.urlParams=Os(t.fullPath||this.createResourcePathWithSymbols(t.path||""));let o=Be(this._makeRequest(e,t,{}),r);return Object.assign(o,Hs(this,e,t,o)),o}}n.extend=bs;n.method=qs;n.MAX_BUFFERED_REQUEST_METRICS=100;function n(t,e){if(this._stripe=t,e)throw new Error("Support for curried url params was dropped in stripe-node v7.0.0. Instead, pass two ids.");this.basePath=$t(this.basePath||t.getApiField("basePath")),this.resourcePath=this.path,this.path=$t(this.path),this.initialize(...arguments)}n.prototype={_stripe:null,path:"",resourcePath:"",basePath:null,initialize(){},requestDataProcessor:null,validateRequest:null,createFullPath(t,e){let r=[this.basePath(e),this.path(e)];if(typeof t=="function"){let o=t(e);o&&r.push(o)}else r.push(t);return this._joinUrlParts(r)},createResourcePathWithSymbols(t){return t?`/${this._joinUrlParts([this.resourcePath,t])}`:`/${this.resourcePath}`},_joinUrlParts(t){return t.join("/").replace(/\/{2,}/g,"/")},_getRequestOpts(t,e,r){var o;let s=(e.method||"GET").toUpperCase(),i=e.usage||[],a=e.urlParams||[],l=e.encode||(R=>R),c=!!e.fullPath,u=$t(c?e.fullPath:e.path||""),d=c?e.fullPath:this.createResourcePathWithSymbols(e.path),m=[].slice.call(t),h=a.reduce((R,G)=>{let H=m.shift();if(typeof H!="string")throw new Error(`Stripe: Argument "${G}" must be a string, but got: ${H} (on API request to \`${s} ${d}\`)`);return R[G]=H,R},{}),p=Te(m),f=l(Object.assign({},p,r)),v=Vt(m),g=v.host||e.host,y=!!e.streaming||!!v.streaming;if(m.filter(R=>R!=null).length)throw new Error(`Stripe: Unknown arguments (${m}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options. (on API request to ${s} \`${d}\`)`);let O=c?u(h):this.createFullPath(u,h),P=Object.assign(v.headers,e.headers);e.validator&&e.validator(f,{headers:P});let S=e.method==="GET"||e.method==="DELETE";return{requestMethod:s,requestPath:O,bodyData:S?null:f,queryData:S?f:{},authenticator:(o=v.authenticator)!==null&&o!==void 0?o:null,headers:P,host:g??null,streaming:y,settings:v.settings,usage:i}},_makeRequest(t,e,r){return new Promise((o,s)=>{var i;let a;try{a=this._getRequestOpts(t,e,r)}catch(h){s(h);return}function l(h,p){h?s(h):o(e.transformResponseData?e.transformResponseData(p):p)}let c=Object.keys(a.queryData).length===0,u=[a.requestPath,c?"":"?",se(a.queryData,_e(a.requestPath))].join(""),{headers:d,settings:m}=a;this._stripe._requestSender._request(a.requestMethod,a.host,u,a.bodyData,a.authenticator,{headers:d,settings:m,streaming:a.streaming},a.usage,l,(i=this.requestDataProcessor)===null||i===void 0?void 0:i.bind(this))})}};function js(t){let e={DEFAULT_TOLERANCE:300,signature:null,constructEvent(d,m,h,p,f,v){try{if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");this.signature.verifyHeader(d,m,h,p||e.DEFAULT_TOLERANCE,f,v)}catch(y){throw y instanceof Pe&&(y.message+="\nUse `await constructEventAsync(...)` instead of `constructEvent(...)`"),y}return d instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(d)):JSON.parse(d)},async constructEventAsync(d,m,h,p,f,v){if(!this.signature)throw new Error("ERR: missing signature helper, unable to verify");return await this.signature.verifyHeaderAsync(d,m,h,p||e.DEFAULT_TOLERANCE,f,v),d instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(d)):JSON.parse(d)},generateTestHeaderString:function(d){let m=u(d),h=m.signature||m.cryptoProvider.computeHMACSignature(m.payloadString,m.secret);return m.generateHeaderString(h)},generateTestHeaderStringAsync:async function(d){let m=u(d),h=m.signature||await m.cryptoProvider.computeHMACSignatureAsync(m.payloadString,m.secret);return m.generateHeaderString(h)}},r={EXPECTED_SCHEME:"v1",verifyHeader(d,m,h,p,f,v){let{decodedHeader:g,decodedPayload:y,details:O,suspectPayloadType:P}=s(d,m,this.EXPECTED_SCHEME),S=/\s/.test(h);f=f||c();let N=f.computeHMACSignature(o(y,O),h);return i(y,g,O,N,p,P,S,v),!0},async verifyHeaderAsync(d,m,h,p,f,v){let{decodedHeader:g,decodedPayload:y,details:O,suspectPayloadType:P}=s(d,m,this.EXPECTED_SCHEME),S=/\s/.test(h);f=f||c();let N=await f.computeHMACSignatureAsync(o(y,O),h);return i(y,g,O,N,p,P,S,v)}};function o(d,m){return`${m.timestamp}.${d}`}function s(d,m,h){if(!d)throw new K(m,d,{message:"No webhook payload was provided."});let p=typeof d!="string"&&!(d instanceof Uint8Array),f=new TextDecoder("utf8"),v=d instanceof Uint8Array?f.decode(d):d;if(Array.isArray(m))throw new Error("Unexpected: An array was passed as a header, which should not be possible for the stripe-signature header.");if(m==null||m=="")throw new K(m,d,{message:"No stripe-signature header value was provided."});let g=m instanceof Uint8Array?f.decode(m):m,y=a(g,h);if(!y||y.timestamp===-1)throw new K(g,v,{message:"Unable to extract timestamp and signatures from header"});if(!y.signatures.length)throw new K(g,v,{message:"No signatures found with expected scheme"});return{decodedPayload:v,decodedHeader:g,details:y,suspectPayloadType:p}}function i(d,m,h,p,f,v,g,y){let O=!!h.signatures.filter(t.secureCompare.bind(t,p)).length,P=`
Learn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature`,S=g?`

Note: The provided signing secret contains whitespace. This often indicates an extra newline or space is in the value`:"";if(!O)throw v?new K(m,d,{message:`Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead.
Signature verification is impossible without access to the original signed material.
`+P+`
`+S}):new K(m,d,{message:`No signatures found matching the expected signature for payload. Are you passing the raw request body you received from Stripe?
 If a webhook request is being forwarded by a third-party tool, ensure that the exact request body, including JSON formatting and new line style, is preserved.
`+P+`
`+S});let N=Math.floor((typeof y=="number"?y:Date.now())/1e3)-h.timestamp;if(f>0&&N>f)throw new K(m,d,{message:"Timestamp outside the tolerance zone"});return!0}function a(d,m){return typeof d!="string"?null:d.split(",").reduce((h,p)=>{let f=p.split("=");return f[0]==="t"&&(h.timestamp=parseInt(f[1],10)),f[0]===m&&h.signatures.push(f[1]),h},{timestamp:-1,signatures:[]})}let l=null;function c(){return l||(l=t.createDefaultCryptoProvider()),l}function u(d){if(!d)throw new C({message:"Options are required"});let m=Math.floor(d.timestamp)||Math.floor(Date.now()/1e3),h=d.scheme||r.EXPECTED_SCHEME,p=d.cryptoProvider||c(),f=`${m}.${d.payload}`,v=g=>`t=${m},${h}=${g}`;return Object.assign(Object.assign({},d),{timestamp:m,scheme:h,cryptoProvider:p,payloadString:f,generateHeaderString:v})}return e.signature=r,e}var To="2025-08-27.basil";var Ne={};Pt(Ne,{Account:()=>ko,AccountLinks:()=>xi,AccountSessions:()=>wi,Accounts:()=>ko,ApplePayDomains:()=>Oi,ApplicationFees:()=>bi,Apps:()=>Pl,Balance:()=>Ri,BalanceTransactions:()=>Ci,Billing:()=>Tl,BillingPortal:()=>_l,Charges:()=>Ii,Checkout:()=>Sl,Climate:()=>El,ConfirmationTokens:()=>Mi,CountrySpecs:()=>Ni,Coupons:()=>Di,CreditNotes:()=>Gi,CustomerSessions:()=>Hi,Customers:()=>Li,Disputes:()=>qi,Entitlements:()=>xl,EphemeralKeys:()=>Ui,Events:()=>$i,ExchangeRates:()=>Ki,FileLinks:()=>Bi,Files:()=>Wi,FinancialConnections:()=>wl,Forwarding:()=>Ol,Identity:()=>bl,InvoiceItems:()=>Ji,InvoicePayments:()=>Xi,InvoiceRenderingTemplates:()=>Qi,Invoices:()=>Zi,Issuing:()=>Rl,Mandates:()=>ea,OAuth:()=>ra,PaymentIntents:()=>oa,PaymentLinks:()=>sa,PaymentMethodConfigurations:()=>na,PaymentMethodDomains:()=>ia,PaymentMethods:()=>aa,Payouts:()=>ca,Plans:()=>la,Prices:()=>ua,Products:()=>da,PromotionCodes:()=>ma,Quotes:()=>ha,Radar:()=>Al,Refunds:()=>pa,Reporting:()=>Cl,Reviews:()=>fa,SetupAttempts:()=>va,SetupIntents:()=>ga,ShippingRates:()=>ya,Sigma:()=>Il,Sources:()=>Pa,SubscriptionItems:()=>Ta,SubscriptionSchedules:()=>_a,Subscriptions:()=>Sa,Tax:()=>Ml,TaxCodes:()=>xa,TaxIds:()=>wa,TaxRates:()=>Oa,Terminal:()=>kl,TestHelpers:()=>Nl,Tokens:()=>Ra,Topups:()=>Aa,Transfers:()=>Ca,Treasury:()=>Dl,V2:()=>Gl,WebhookEndpoints:()=>Ia});function Yc(t,e){for(let r in e){if(!Object.prototype.hasOwnProperty.call(e,r))continue;let o=r[0].toLowerCase()+r.substring(1),s=new e[r](t);this[o]=s}}function b(t,e){return function(r){return new Yc(r,e)}}var de=n.method,Us=n.extend({retrieve:de({method:"GET",fullPath:"/v1/financial_connections/accounts/{account}"}),list:de({method:"GET",fullPath:"/v1/financial_connections/accounts",methodType:"list"}),disconnect:de({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/disconnect"}),listOwners:de({method:"GET",fullPath:"/v1/financial_connections/accounts/{account}/owners",methodType:"list"}),refresh:de({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/refresh"}),subscribe:de({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/subscribe"}),unsubscribe:de({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/unsubscribe"})});var Fs=n.method,$s=n.extend({retrieve:Fs({method:"GET",fullPath:"/v1/entitlements/active_entitlements/{id}"}),list:Fs({method:"GET",fullPath:"/v1/entitlements/active_entitlements",methodType:"list"})});var we=n.method,Vs=n.extend({create:we({method:"POST",fullPath:"/v1/billing/alerts"}),retrieve:we({method:"GET",fullPath:"/v1/billing/alerts/{id}"}),list:we({method:"GET",fullPath:"/v1/billing/alerts",methodType:"list"}),activate:we({method:"POST",fullPath:"/v1/billing/alerts/{id}/activate"}),archive:we({method:"POST",fullPath:"/v1/billing/alerts/{id}/archive"}),deactivate:we({method:"POST",fullPath:"/v1/billing/alerts/{id}/deactivate"})});var Qe=n.method,Ks=n.extend({retrieve:Qe({method:"GET",fullPath:"/v1/issuing/authorizations/{authorization}"}),update:Qe({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}"}),list:Qe({method:"GET",fullPath:"/v1/issuing/authorizations",methodType:"list"}),approve:Qe({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}/approve"}),decline:Qe({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}/decline"})});var me=n.method,Bs=n.extend({create:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations"}),capture:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/capture"}),expire:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/expire"}),finalizeAmount:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/finalize_amount"}),increment:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/increment"}),respond:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/fraud_challenges/respond"}),reverse:me({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/reverse"})});var _o=n.method,zs=n.extend({create:_o({method:"POST",fullPath:"/v1/tax/calculations"}),retrieve:_o({method:"GET",fullPath:"/v1/tax/calculations/{calculation}"}),listLineItems:_o({method:"GET",fullPath:"/v1/tax/calculations/{calculation}/line_items",methodType:"list"})});var ir=n.method,Ws=n.extend({create:ir({method:"POST",fullPath:"/v1/issuing/cardholders"}),retrieve:ir({method:"GET",fullPath:"/v1/issuing/cardholders/{cardholder}"}),update:ir({method:"POST",fullPath:"/v1/issuing/cardholders/{cardholder}"}),list:ir({method:"GET",fullPath:"/v1/issuing/cardholders",methodType:"list"})});var ar=n.method,Js=n.extend({create:ar({method:"POST",fullPath:"/v1/issuing/cards"}),retrieve:ar({method:"GET",fullPath:"/v1/issuing/cards/{card}"}),update:ar({method:"POST",fullPath:"/v1/issuing/cards/{card}"}),list:ar({method:"GET",fullPath:"/v1/issuing/cards",methodType:"list"})});var Ze=n.method,Ys=n.extend({deliverCard:Ze({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/deliver"}),failCard:Ze({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/fail"}),returnCard:Ze({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/return"}),shipCard:Ze({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/ship"}),submitCard:Ze({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/submit"})});var cr=n.method,Xs=n.extend({create:cr({method:"POST",fullPath:"/v1/billing_portal/configurations"}),retrieve:cr({method:"GET",fullPath:"/v1/billing_portal/configurations/{configuration}"}),update:cr({method:"POST",fullPath:"/v1/billing_portal/configurations/{configuration}"}),list:cr({method:"GET",fullPath:"/v1/billing_portal/configurations",methodType:"list"})});var et=n.method,Qs=n.extend({create:et({method:"POST",fullPath:"/v1/terminal/configurations"}),retrieve:et({method:"GET",fullPath:"/v1/terminal/configurations/{configuration}"}),update:et({method:"POST",fullPath:"/v1/terminal/configurations/{configuration}"}),list:et({method:"GET",fullPath:"/v1/terminal/configurations",methodType:"list"}),del:et({method:"DELETE",fullPath:"/v1/terminal/configurations/{configuration}"})});var Xc=n.method,Zs=n.extend({create:Xc({method:"POST",fullPath:"/v1/test_helpers/confirmation_tokens"})});var Qc=n.method,en=n.extend({create:Qc({method:"POST",fullPath:"/v1/terminal/connection_tokens"})});var Zc=n.method,tn=n.extend({retrieve:Zc({method:"GET",fullPath:"/v1/billing/credit_balance_summary"})});var rn=n.method,on=n.extend({retrieve:rn({method:"GET",fullPath:"/v1/billing/credit_balance_transactions/{id}"}),list:rn({method:"GET",fullPath:"/v1/billing/credit_balance_transactions",methodType:"list"})});var Oe=n.method,sn=n.extend({create:Oe({method:"POST",fullPath:"/v1/billing/credit_grants"}),retrieve:Oe({method:"GET",fullPath:"/v1/billing/credit_grants/{id}"}),update:Oe({method:"POST",fullPath:"/v1/billing/credit_grants/{id}"}),list:Oe({method:"GET",fullPath:"/v1/billing/credit_grants",methodType:"list"}),expire:Oe({method:"POST",fullPath:"/v1/billing/credit_grants/{id}/expire"}),voidGrant:Oe({method:"POST",fullPath:"/v1/billing/credit_grants/{id}/void"})});var So=n.method,nn=n.extend({create:So({method:"POST",fullPath:"/v1/treasury/credit_reversals"}),retrieve:So({method:"GET",fullPath:"/v1/treasury/credit_reversals/{credit_reversal}"}),list:So({method:"GET",fullPath:"/v1/treasury/credit_reversals",methodType:"list"})});var el=n.method,an=n.extend({fundCashBalance:el({method:"POST",fullPath:"/v1/test_helpers/customers/{customer}/fund_cash_balance"})});var Eo=n.method,cn=n.extend({create:Eo({method:"POST",fullPath:"/v1/treasury/debit_reversals"}),retrieve:Eo({method:"GET",fullPath:"/v1/treasury/debit_reversals/{debit_reversal}"}),list:Eo({method:"GET",fullPath:"/v1/treasury/debit_reversals",methodType:"list"})});var tt=n.method,ln=n.extend({create:tt({method:"POST",fullPath:"/v1/issuing/disputes"}),retrieve:tt({method:"GET",fullPath:"/v1/issuing/disputes/{dispute}"}),update:tt({method:"POST",fullPath:"/v1/issuing/disputes/{dispute}"}),list:tt({method:"GET",fullPath:"/v1/issuing/disputes",methodType:"list"}),submit:tt({method:"POST",fullPath:"/v1/issuing/disputes/{dispute}/submit"})});var un=n.method,dn=n.extend({retrieve:un({method:"GET",fullPath:"/v1/radar/early_fraud_warnings/{early_fraud_warning}"}),list:un({method:"GET",fullPath:"/v1/radar/early_fraud_warnings",methodType:"list"})});var ne=n.method,mn=n.extend({create:ne({method:"POST",fullPath:"/v2/core/event_destinations"}),retrieve:ne({method:"GET",fullPath:"/v2/core/event_destinations/{id}"}),update:ne({method:"POST",fullPath:"/v2/core/event_destinations/{id}"}),list:ne({method:"GET",fullPath:"/v2/core/event_destinations",methodType:"list"}),del:ne({method:"DELETE",fullPath:"/v2/core/event_destinations/{id}"}),disable:ne({method:"POST",fullPath:"/v2/core/event_destinations/{id}/disable"}),enable:ne({method:"POST",fullPath:"/v2/core/event_destinations/{id}/enable"}),ping:ne({method:"POST",fullPath:"/v2/core/event_destinations/{id}/ping"})});var xo=n.method,hn=n.extend({retrieve(...t){return xo({method:"GET",fullPath:"/v2/core/events/{id}",transformResponseData:r=>this.addFetchRelatedObjectIfNeeded(r)}).apply(this,t)},list(...t){return xo({method:"GET",fullPath:"/v2/core/events",methodType:"list",transformResponseData:r=>Object.assign(Object.assign({},r),{data:r.data.map(this.addFetchRelatedObjectIfNeeded.bind(this))})}).apply(this,t)},addFetchRelatedObjectIfNeeded(t){return!t.related_object||!t.related_object.url?t:Object.assign(Object.assign({},t),{fetchRelatedObject:()=>xo({method:"GET",fullPath:t.related_object.url}).apply(this,[{stripeAccount:t.context}])})}});var lr=n.method,pn=n.extend({create:lr({method:"POST",fullPath:"/v1/entitlements/features"}),retrieve:lr({method:"GET",fullPath:"/v1/entitlements/features/{id}"}),update:lr({method:"POST",fullPath:"/v1/entitlements/features/{id}"}),list:lr({method:"GET",fullPath:"/v1/entitlements/features",methodType:"list"})});var he=n.method,fn=n.extend({create:he({method:"POST",fullPath:"/v1/treasury/financial_accounts"}),retrieve:he({method:"GET",fullPath:"/v1/treasury/financial_accounts/{financial_account}"}),update:he({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}"}),list:he({method:"GET",fullPath:"/v1/treasury/financial_accounts",methodType:"list"}),close:he({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}/close"}),retrieveFeatures:he({method:"GET",fullPath:"/v1/treasury/financial_accounts/{financial_account}/features"}),updateFeatures:he({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}/features"})});var wo=n.method,vn=n.extend({fail:wo({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/fail"}),returnInboundTransfer:wo({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/return"}),succeed:wo({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/succeed"})});var ur=n.method,gn=n.extend({create:ur({method:"POST",fullPath:"/v1/treasury/inbound_transfers"}),retrieve:ur({method:"GET",fullPath:"/v1/treasury/inbound_transfers/{id}"}),list:ur({method:"GET",fullPath:"/v1/treasury/inbound_transfers",methodType:"list"}),cancel:ur({method:"POST",fullPath:"/v1/treasury/inbound_transfers/{inbound_transfer}/cancel"})});var rt=n.method,yn=n.extend({create:rt({method:"POST",fullPath:"/v1/terminal/locations"}),retrieve:rt({method:"GET",fullPath:"/v1/terminal/locations/{location}"}),update:rt({method:"POST",fullPath:"/v1/terminal/locations/{location}"}),list:rt({method:"GET",fullPath:"/v1/terminal/locations",methodType:"list"}),del:rt({method:"DELETE",fullPath:"/v1/terminal/locations/{location}"})});var tl=n.method,Pn=n.extend({create:tl({method:"POST",fullPath:"/v1/billing/meter_event_adjustments"})});var rl=n.method,Tn=n.extend({create:rl({method:"POST",fullPath:"/v2/billing/meter_event_adjustments"})});var ol=n.method,_n=n.extend({create:ol({method:"POST",fullPath:"/v2/billing/meter_event_session"})});var sl=n.method,Sn=n.extend({create:sl({method:"POST",fullPath:"/v2/billing/meter_event_stream",host:"meter-events.stripe.com"})});var nl=n.method,En=n.extend({create:nl({method:"POST",fullPath:"/v1/billing/meter_events"})});var il=n.method,xn=n.extend({create:il({method:"POST",fullPath:"/v2/billing/meter_events"})});var pe=n.method,wn=n.extend({create:pe({method:"POST",fullPath:"/v1/billing/meters"}),retrieve:pe({method:"GET",fullPath:"/v1/billing/meters/{id}"}),update:pe({method:"POST",fullPath:"/v1/billing/meters/{id}"}),list:pe({method:"GET",fullPath:"/v1/billing/meters",methodType:"list"}),deactivate:pe({method:"POST",fullPath:"/v1/billing/meters/{id}/deactivate"}),listEventSummaries:pe({method:"GET",fullPath:"/v1/billing/meters/{id}/event_summaries",methodType:"list"}),reactivate:pe({method:"POST",fullPath:"/v1/billing/meters/{id}/reactivate"})});var ot=n.method,On=n.extend({create:ot({method:"POST",fullPath:"/v1/climate/orders"}),retrieve:ot({method:"GET",fullPath:"/v1/climate/orders/{order}"}),update:ot({method:"POST",fullPath:"/v1/climate/orders/{order}"}),list:ot({method:"GET",fullPath:"/v1/climate/orders",methodType:"list"}),cancel:ot({method:"POST",fullPath:"/v1/climate/orders/{order}/cancel"})});var dr=n.method,bn=n.extend({update:dr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}"}),fail:dr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/fail"}),post:dr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/post"}),returnOutboundPayment:dr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/return"})});var mr=n.method,Rn=n.extend({create:mr({method:"POST",fullPath:"/v1/treasury/outbound_payments"}),retrieve:mr({method:"GET",fullPath:"/v1/treasury/outbound_payments/{id}"}),list:mr({method:"GET",fullPath:"/v1/treasury/outbound_payments",methodType:"list"}),cancel:mr({method:"POST",fullPath:"/v1/treasury/outbound_payments/{id}/cancel"})});var hr=n.method,An=n.extend({update:hr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}"}),fail:hr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/fail"}),post:hr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/post"}),returnOutboundTransfer:hr({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/return"})});var pr=n.method,Cn=n.extend({create:pr({method:"POST",fullPath:"/v1/treasury/outbound_transfers"}),retrieve:pr({method:"GET",fullPath:"/v1/treasury/outbound_transfers/{outbound_transfer}"}),list:pr({method:"GET",fullPath:"/v1/treasury/outbound_transfers",methodType:"list"}),cancel:pr({method:"POST",fullPath:"/v1/treasury/outbound_transfers/{outbound_transfer}/cancel"})});var fr=n.method,In=n.extend({create:fr({method:"POST",fullPath:"/v1/issuing/personalization_designs"}),retrieve:fr({method:"GET",fullPath:"/v1/issuing/personalization_designs/{personalization_design}"}),update:fr({method:"POST",fullPath:"/v1/issuing/personalization_designs/{personalization_design}"}),list:fr({method:"GET",fullPath:"/v1/issuing/personalization_designs",methodType:"list"})});var Oo=n.method,Mn=n.extend({activate:Oo({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/activate"}),deactivate:Oo({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/deactivate"}),reject:Oo({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/reject"})});var kn=n.method,Nn=n.extend({retrieve:kn({method:"GET",fullPath:"/v1/issuing/physical_bundles/{physical_bundle}"}),list:kn({method:"GET",fullPath:"/v1/issuing/physical_bundles",methodType:"list"})});var Dn=n.method,Gn=n.extend({retrieve:Dn({method:"GET",fullPath:"/v1/climate/products/{product}"}),list:Dn({method:"GET",fullPath:"/v1/climate/products",methodType:"list"})});var q=n.method,Hn=n.extend({create:q({method:"POST",fullPath:"/v1/terminal/readers"}),retrieve:q({method:"GET",fullPath:"/v1/terminal/readers/{reader}"}),update:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}"}),list:q({method:"GET",fullPath:"/v1/terminal/readers",methodType:"list"}),del:q({method:"DELETE",fullPath:"/v1/terminal/readers/{reader}"}),cancelAction:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/cancel_action"}),collectInputs:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/collect_inputs"}),collectPaymentMethod:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/collect_payment_method"}),confirmPaymentIntent:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/confirm_payment_intent"}),processPaymentIntent:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/process_payment_intent"}),processSetupIntent:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/process_setup_intent"}),refundPayment:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/refund_payment"}),setReaderDisplay:q({method:"POST",fullPath:"/v1/terminal/readers/{reader}/set_reader_display"})});var bo=n.method,Ln=n.extend({presentPaymentMethod:bo({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/present_payment_method"}),succeedInputCollection:bo({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/succeed_input_collection"}),timeoutInputCollection:bo({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/timeout_input_collection"})});var al=n.method,qn=n.extend({create:al({method:"POST",fullPath:"/v1/test_helpers/treasury/received_credits"})});var jn=n.method,Un=n.extend({retrieve:jn({method:"GET",fullPath:"/v1/treasury/received_credits/{id}"}),list:jn({method:"GET",fullPath:"/v1/treasury/received_credits",methodType:"list"})});var cl=n.method,Fn=n.extend({create:cl({method:"POST",fullPath:"/v1/test_helpers/treasury/received_debits"})});var $n=n.method,Vn=n.extend({retrieve:$n({method:"GET",fullPath:"/v1/treasury/received_debits/{id}"}),list:$n({method:"GET",fullPath:"/v1/treasury/received_debits",methodType:"list"})});var ll=n.method,Kn=n.extend({expire:ll({method:"POST",fullPath:"/v1/test_helpers/refunds/{refund}/expire"})});var vr=n.method,Bn=n.extend({create:vr({method:"POST",fullPath:"/v1/tax/registrations"}),retrieve:vr({method:"GET",fullPath:"/v1/tax/registrations/{id}"}),update:vr({method:"POST",fullPath:"/v1/tax/registrations/{id}"}),list:vr({method:"GET",fullPath:"/v1/tax/registrations",methodType:"list"})});var Ro=n.method,zn=n.extend({create:Ro({method:"POST",fullPath:"/v1/reporting/report_runs"}),retrieve:Ro({method:"GET",fullPath:"/v1/reporting/report_runs/{report_run}"}),list:Ro({method:"GET",fullPath:"/v1/reporting/report_runs",methodType:"list"})});var Wn=n.method,Jn=n.extend({retrieve:Wn({method:"GET",fullPath:"/v1/reporting/report_types/{report_type}"}),list:Wn({method:"GET",fullPath:"/v1/reporting/report_types",methodType:"list"})});var Ao=n.method,Yn=n.extend({create:Ao({method:"POST",fullPath:"/v1/forwarding/requests"}),retrieve:Ao({method:"GET",fullPath:"/v1/forwarding/requests/{id}"}),list:Ao({method:"GET",fullPath:"/v1/forwarding/requests",methodType:"list"})});var Xn=n.method,Qn=n.extend({retrieve:Xn({method:"GET",fullPath:"/v1/sigma/scheduled_query_runs/{scheduled_query_run}"}),list:Xn({method:"GET",fullPath:"/v1/sigma/scheduled_query_runs",methodType:"list"})});var gr=n.method,Zn=n.extend({create:gr({method:"POST",fullPath:"/v1/apps/secrets"}),list:gr({method:"GET",fullPath:"/v1/apps/secrets",methodType:"list"}),deleteWhere:gr({method:"POST",fullPath:"/v1/apps/secrets/delete"}),find:gr({method:"GET",fullPath:"/v1/apps/secrets/find"})});var ul=n.method,ei=n.extend({create:ul({method:"POST",fullPath:"/v1/billing_portal/sessions"})});var be=n.method,ti=n.extend({create:be({method:"POST",fullPath:"/v1/checkout/sessions"}),retrieve:be({method:"GET",fullPath:"/v1/checkout/sessions/{session}"}),update:be({method:"POST",fullPath:"/v1/checkout/sessions/{session}"}),list:be({method:"GET",fullPath:"/v1/checkout/sessions",methodType:"list"}),expire:be({method:"POST",fullPath:"/v1/checkout/sessions/{session}/expire"}),listLineItems:be({method:"GET",fullPath:"/v1/checkout/sessions/{session}/line_items",methodType:"list"})});var ri=n.method,oi=n.extend({create:ri({method:"POST",fullPath:"/v1/financial_connections/sessions"}),retrieve:ri({method:"GET",fullPath:"/v1/financial_connections/sessions/{session}"})});var si=n.method,ni=n.extend({retrieve:si({method:"GET",fullPath:"/v1/tax/settings"}),update:si({method:"POST",fullPath:"/v1/tax/settings"})});var ii=n.method,ai=n.extend({retrieve:ii({method:"GET",fullPath:"/v1/climate/suppliers/{supplier}"}),list:ii({method:"GET",fullPath:"/v1/climate/suppliers",methodType:"list"})});var st=n.method,ci=n.extend({create:st({method:"POST",fullPath:"/v1/test_helpers/test_clocks"}),retrieve:st({method:"GET",fullPath:"/v1/test_helpers/test_clocks/{test_clock}"}),list:st({method:"GET",fullPath:"/v1/test_helpers/test_clocks",methodType:"list"}),del:st({method:"DELETE",fullPath:"/v1/test_helpers/test_clocks/{test_clock}"}),advance:st({method:"POST",fullPath:"/v1/test_helpers/test_clocks/{test_clock}/advance"})});var Co=n.method,li=n.extend({retrieve:Co({method:"GET",fullPath:"/v1/issuing/tokens/{token}"}),update:Co({method:"POST",fullPath:"/v1/issuing/tokens/{token}"}),list:Co({method:"GET",fullPath:"/v1/issuing/tokens",methodType:"list"})});var ui=n.method,di=n.extend({retrieve:ui({method:"GET",fullPath:"/v1/treasury/transaction_entries/{id}"}),list:ui({method:"GET",fullPath:"/v1/treasury/transaction_entries",methodType:"list"})});var mi=n.method,hi=n.extend({retrieve:mi({method:"GET",fullPath:"/v1/financial_connections/transactions/{transaction}"}),list:mi({method:"GET",fullPath:"/v1/financial_connections/transactions",methodType:"list"})});var Io=n.method,pi=n.extend({retrieve:Io({method:"GET",fullPath:"/v1/issuing/transactions/{transaction}"}),update:Io({method:"POST",fullPath:"/v1/issuing/transactions/{transaction}"}),list:Io({method:"GET",fullPath:"/v1/issuing/transactions",methodType:"list"})});var yr=n.method,fi=n.extend({retrieve:yr({method:"GET",fullPath:"/v1/tax/transactions/{transaction}"}),createFromCalculation:yr({method:"POST",fullPath:"/v1/tax/transactions/create_from_calculation"}),createReversal:yr({method:"POST",fullPath:"/v1/tax/transactions/create_reversal"}),listLineItems:yr({method:"GET",fullPath:"/v1/tax/transactions/{transaction}/line_items",methodType:"list"})});var Mo=n.method,vi=n.extend({createForceCapture:Mo({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/create_force_capture"}),createUnlinkedRefund:Mo({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/create_unlinked_refund"}),refund:Mo({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/{transaction}/refund"})});var gi=n.method,yi=n.extend({retrieve:gi({method:"GET",fullPath:"/v1/treasury/transactions/{id}"}),list:gi({method:"GET",fullPath:"/v1/treasury/transactions",methodType:"list"})});var Pr=n.method,Pi=n.extend({create:Pr({method:"POST",fullPath:"/v1/radar/value_list_items"}),retrieve:Pr({method:"GET",fullPath:"/v1/radar/value_list_items/{item}"}),list:Pr({method:"GET",fullPath:"/v1/radar/value_list_items",methodType:"list"}),del:Pr({method:"DELETE",fullPath:"/v1/radar/value_list_items/{item}"})});var nt=n.method,Ti=n.extend({create:nt({method:"POST",fullPath:"/v1/radar/value_lists"}),retrieve:nt({method:"GET",fullPath:"/v1/radar/value_lists/{value_list}"}),update:nt({method:"POST",fullPath:"/v1/radar/value_lists/{value_list}"}),list:nt({method:"GET",fullPath:"/v1/radar/value_lists",methodType:"list"}),del:nt({method:"DELETE",fullPath:"/v1/radar/value_lists/{value_list}"})});var _i=n.method,Si=n.extend({retrieve:_i({method:"GET",fullPath:"/v1/identity/verification_reports/{report}"}),list:_i({method:"GET",fullPath:"/v1/identity/verification_reports",methodType:"list"})});var Re=n.method,Ei=n.extend({create:Re({method:"POST",fullPath:"/v1/identity/verification_sessions"}),retrieve:Re({method:"GET",fullPath:"/v1/identity/verification_sessions/{session}"}),update:Re({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}"}),list:Re({method:"GET",fullPath:"/v1/identity/verification_sessions",methodType:"list"}),cancel:Re({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}/cancel"}),redact:Re({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}/redact"})});var I=n.method,ko=n.extend({create:I({method:"POST",fullPath:"/v1/accounts"}),retrieve(t,...e){return typeof t=="string"?I({method:"GET",fullPath:"/v1/accounts/{id}"}).apply(this,[t,...e]):(t==null&&[].shift.apply([t,...e]),I({method:"GET",fullPath:"/v1/account"}).apply(this,[t,...e]))},update:I({method:"POST",fullPath:"/v1/accounts/{account}"}),list:I({method:"GET",fullPath:"/v1/accounts",methodType:"list"}),del:I({method:"DELETE",fullPath:"/v1/accounts/{account}"}),createExternalAccount:I({method:"POST",fullPath:"/v1/accounts/{account}/external_accounts"}),createLoginLink:I({method:"POST",fullPath:"/v1/accounts/{account}/login_links"}),createPerson:I({method:"POST",fullPath:"/v1/accounts/{account}/persons"}),deleteExternalAccount:I({method:"DELETE",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),deletePerson:I({method:"DELETE",fullPath:"/v1/accounts/{account}/persons/{person}"}),listCapabilities:I({method:"GET",fullPath:"/v1/accounts/{account}/capabilities",methodType:"list"}),listExternalAccounts:I({method:"GET",fullPath:"/v1/accounts/{account}/external_accounts",methodType:"list"}),listPersons:I({method:"GET",fullPath:"/v1/accounts/{account}/persons",methodType:"list"}),reject:I({method:"POST",fullPath:"/v1/accounts/{account}/reject"}),retrieveCurrent:I({method:"GET",fullPath:"/v1/account"}),retrieveCapability:I({method:"GET",fullPath:"/v1/accounts/{account}/capabilities/{capability}"}),retrieveExternalAccount:I({method:"GET",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),retrievePerson:I({method:"GET",fullPath:"/v1/accounts/{account}/persons/{person}"}),updateCapability:I({method:"POST",fullPath:"/v1/accounts/{account}/capabilities/{capability}"}),updateExternalAccount:I({method:"POST",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),updatePerson:I({method:"POST",fullPath:"/v1/accounts/{account}/persons/{person}"})});var dl=n.method,xi=n.extend({create:dl({method:"POST",fullPath:"/v1/account_links"})});var ml=n.method,wi=n.extend({create:ml({method:"POST",fullPath:"/v1/account_sessions"})});var Tr=n.method,Oi=n.extend({create:Tr({method:"POST",fullPath:"/v1/apple_pay/domains"}),retrieve:Tr({method:"GET",fullPath:"/v1/apple_pay/domains/{domain}"}),list:Tr({method:"GET",fullPath:"/v1/apple_pay/domains",methodType:"list"}),del:Tr({method:"DELETE",fullPath:"/v1/apple_pay/domains/{domain}"})});var Ae=n.method,bi=n.extend({retrieve:Ae({method:"GET",fullPath:"/v1/application_fees/{id}"}),list:Ae({method:"GET",fullPath:"/v1/application_fees",methodType:"list"}),createRefund:Ae({method:"POST",fullPath:"/v1/application_fees/{id}/refunds"}),listRefunds:Ae({method:"GET",fullPath:"/v1/application_fees/{id}/refunds",methodType:"list"}),retrieveRefund:Ae({method:"GET",fullPath:"/v1/application_fees/{fee}/refunds/{id}"}),updateRefund:Ae({method:"POST",fullPath:"/v1/application_fees/{fee}/refunds/{id}"})});var hl=n.method,Ri=n.extend({retrieve:hl({method:"GET",fullPath:"/v1/balance"})});var Ai=n.method,Ci=n.extend({retrieve:Ai({method:"GET",fullPath:"/v1/balance_transactions/{id}"}),list:Ai({method:"GET",fullPath:"/v1/balance_transactions",methodType:"list"})});var Ce=n.method,Ii=n.extend({create:Ce({method:"POST",fullPath:"/v1/charges"}),retrieve:Ce({method:"GET",fullPath:"/v1/charges/{charge}"}),update:Ce({method:"POST",fullPath:"/v1/charges/{charge}"}),list:Ce({method:"GET",fullPath:"/v1/charges",methodType:"list"}),capture:Ce({method:"POST",fullPath:"/v1/charges/{charge}/capture"}),search:Ce({method:"GET",fullPath:"/v1/charges/search",methodType:"search"})});var pl=n.method,Mi=n.extend({retrieve:pl({method:"GET",fullPath:"/v1/confirmation_tokens/{confirmation_token}"})});var ki=n.method,Ni=n.extend({retrieve:ki({method:"GET",fullPath:"/v1/country_specs/{country}"}),list:ki({method:"GET",fullPath:"/v1/country_specs",methodType:"list"})});var it=n.method,Di=n.extend({create:it({method:"POST",fullPath:"/v1/coupons"}),retrieve:it({method:"GET",fullPath:"/v1/coupons/{coupon}"}),update:it({method:"POST",fullPath:"/v1/coupons/{coupon}"}),list:it({method:"GET",fullPath:"/v1/coupons",methodType:"list"}),del:it({method:"DELETE",fullPath:"/v1/coupons/{coupon}"})});var ie=n.method,Gi=n.extend({create:ie({method:"POST",fullPath:"/v1/credit_notes"}),retrieve:ie({method:"GET",fullPath:"/v1/credit_notes/{id}"}),update:ie({method:"POST",fullPath:"/v1/credit_notes/{id}"}),list:ie({method:"GET",fullPath:"/v1/credit_notes",methodType:"list"}),listLineItems:ie({method:"GET",fullPath:"/v1/credit_notes/{credit_note}/lines",methodType:"list"}),listPreviewLineItems:ie({method:"GET",fullPath:"/v1/credit_notes/preview/lines",methodType:"list"}),preview:ie({method:"GET",fullPath:"/v1/credit_notes/preview"}),voidCreditNote:ie({method:"POST",fullPath:"/v1/credit_notes/{id}/void"})});var fl=n.method,Hi=n.extend({create:fl({method:"POST",fullPath:"/v1/customer_sessions"})});var w=n.method,Li=n.extend({create:w({method:"POST",fullPath:"/v1/customers"}),retrieve:w({method:"GET",fullPath:"/v1/customers/{customer}"}),update:w({method:"POST",fullPath:"/v1/customers/{customer}"}),list:w({method:"GET",fullPath:"/v1/customers",methodType:"list"}),del:w({method:"DELETE",fullPath:"/v1/customers/{customer}"}),createBalanceTransaction:w({method:"POST",fullPath:"/v1/customers/{customer}/balance_transactions"}),createFundingInstructions:w({method:"POST",fullPath:"/v1/customers/{customer}/funding_instructions"}),createSource:w({method:"POST",fullPath:"/v1/customers/{customer}/sources"}),createTaxId:w({method:"POST",fullPath:"/v1/customers/{customer}/tax_ids"}),deleteDiscount:w({method:"DELETE",fullPath:"/v1/customers/{customer}/discount"}),deleteSource:w({method:"DELETE",fullPath:"/v1/customers/{customer}/sources/{id}"}),deleteTaxId:w({method:"DELETE",fullPath:"/v1/customers/{customer}/tax_ids/{id}"}),listBalanceTransactions:w({method:"GET",fullPath:"/v1/customers/{customer}/balance_transactions",methodType:"list"}),listCashBalanceTransactions:w({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance_transactions",methodType:"list"}),listPaymentMethods:w({method:"GET",fullPath:"/v1/customers/{customer}/payment_methods",methodType:"list"}),listSources:w({method:"GET",fullPath:"/v1/customers/{customer}/sources",methodType:"list"}),listTaxIds:w({method:"GET",fullPath:"/v1/customers/{customer}/tax_ids",methodType:"list"}),retrieveBalanceTransaction:w({method:"GET",fullPath:"/v1/customers/{customer}/balance_transactions/{transaction}"}),retrieveCashBalance:w({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance"}),retrieveCashBalanceTransaction:w({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance_transactions/{transaction}"}),retrievePaymentMethod:w({method:"GET",fullPath:"/v1/customers/{customer}/payment_methods/{payment_method}"}),retrieveSource:w({method:"GET",fullPath:"/v1/customers/{customer}/sources/{id}"}),retrieveTaxId:w({method:"GET",fullPath:"/v1/customers/{customer}/tax_ids/{id}"}),search:w({method:"GET",fullPath:"/v1/customers/search",methodType:"search"}),updateBalanceTransaction:w({method:"POST",fullPath:"/v1/customers/{customer}/balance_transactions/{transaction}"}),updateCashBalance:w({method:"POST",fullPath:"/v1/customers/{customer}/cash_balance"}),updateSource:w({method:"POST",fullPath:"/v1/customers/{customer}/sources/{id}"}),verifySource:w({method:"POST",fullPath:"/v1/customers/{customer}/sources/{id}/verify"})});var _r=n.method,qi=n.extend({retrieve:_r({method:"GET",fullPath:"/v1/disputes/{dispute}"}),update:_r({method:"POST",fullPath:"/v1/disputes/{dispute}"}),list:_r({method:"GET",fullPath:"/v1/disputes",methodType:"list"}),close:_r({method:"POST",fullPath:"/v1/disputes/{dispute}/close"})});var ji=n.method,Ui=n.extend({create:ji({method:"POST",fullPath:"/v1/ephemeral_keys",validator:(t,e)=>{if(!e.headers||!e.headers["Stripe-Version"])throw new Error("Passing apiVersion in a separate options hash is required to create an ephemeral key. See https://stripe.com/docs/api/versioning?lang=node")}}),del:ji({method:"DELETE",fullPath:"/v1/ephemeral_keys/{key}"})});var Fi=n.method,$i=n.extend({retrieve:Fi({method:"GET",fullPath:"/v1/events/{id}"}),list:Fi({method:"GET",fullPath:"/v1/events",methodType:"list"})});var Vi=n.method,Ki=n.extend({retrieve:Vi({method:"GET",fullPath:"/v1/exchange_rates/{rate_id}"}),list:Vi({method:"GET",fullPath:"/v1/exchange_rates",methodType:"list"})});var Sr=n.method,Bi=n.extend({create:Sr({method:"POST",fullPath:"/v1/file_links"}),retrieve:Sr({method:"GET",fullPath:"/v1/file_links/{link}"}),update:Sr({method:"POST",fullPath:"/v1/file_links/{link}"}),list:Sr({method:"GET",fullPath:"/v1/file_links",methodType:"list"})});var vl=(t,e,r)=>{let o=(Math.round(Math.random()*1e16)+Math.round(Math.random()*1e16)).toString();r["Content-Type"]=`multipart/form-data; boundary=${o}`;let s=new TextEncoder,i=new Uint8Array(0),a=s.encode(`\r
`);function l(d){let m=i,h=d instanceof Uint8Array?d:new Uint8Array(s.encode(d));i=new Uint8Array(m.length+h.length+2),i.set(m),i.set(h,m.length),i.set(a,i.length-2)}function c(d){return`"${d.replace(/"|"/g,"%22").replace(/\r\n|\r|\n/g," ")}"`}let u=Cs(e);for(let d in u){if(!Object.prototype.hasOwnProperty.call(u,d))continue;let m=u[d];if(l(`--${o}`),Object.prototype.hasOwnProperty.call(m,"data")){let h=m;l(`Content-Disposition: form-data; name=${c(d)}; filename=${c(h.name||"blob")}`),l(`Content-Type: ${h.type||"application/octet-stream"}`),l(""),l(h.data)}else l(`Content-Disposition: form-data; name=${c(d)}`),l(""),l(m)}return l(`--${o}--`),i};function zi(t,e,r,o){if(e=e||{},t!=="POST")return o(null,se(e));this._stripe._platformFunctions.tryBufferData(e).then(s=>{let i=vl(t,s,r);return o(null,i)}).catch(s=>o(s,null))}var No=n.method,Wi=n.extend({create:No({method:"POST",fullPath:"/v1/files",headers:{"Content-Type":"multipart/form-data"},host:"files.stripe.com"}),retrieve:No({method:"GET",fullPath:"/v1/files/{file}"}),list:No({method:"GET",fullPath:"/v1/files",methodType:"list"}),requestDataProcessor:zi});var at=n.method,Ji=n.extend({create:at({method:"POST",fullPath:"/v1/invoiceitems"}),retrieve:at({method:"GET",fullPath:"/v1/invoiceitems/{invoiceitem}"}),update:at({method:"POST",fullPath:"/v1/invoiceitems/{invoiceitem}"}),list:at({method:"GET",fullPath:"/v1/invoiceitems",methodType:"list"}),del:at({method:"DELETE",fullPath:"/v1/invoiceitems/{invoiceitem}"})});var Yi=n.method,Xi=n.extend({retrieve:Yi({method:"GET",fullPath:"/v1/invoice_payments/{invoice_payment}"}),list:Yi({method:"GET",fullPath:"/v1/invoice_payments",methodType:"list"})});var Er=n.method,Qi=n.extend({retrieve:Er({method:"GET",fullPath:"/v1/invoice_rendering_templates/{template}"}),list:Er({method:"GET",fullPath:"/v1/invoice_rendering_templates",methodType:"list"}),archive:Er({method:"POST",fullPath:"/v1/invoice_rendering_templates/{template}/archive"}),unarchive:Er({method:"POST",fullPath:"/v1/invoice_rendering_templates/{template}/unarchive"})});var k=n.method,Zi=n.extend({create:k({method:"POST",fullPath:"/v1/invoices"}),retrieve:k({method:"GET",fullPath:"/v1/invoices/{invoice}"}),update:k({method:"POST",fullPath:"/v1/invoices/{invoice}"}),list:k({method:"GET",fullPath:"/v1/invoices",methodType:"list"}),del:k({method:"DELETE",fullPath:"/v1/invoices/{invoice}"}),addLines:k({method:"POST",fullPath:"/v1/invoices/{invoice}/add_lines"}),attachPayment:k({method:"POST",fullPath:"/v1/invoices/{invoice}/attach_payment"}),createPreview:k({method:"POST",fullPath:"/v1/invoices/create_preview"}),finalizeInvoice:k({method:"POST",fullPath:"/v1/invoices/{invoice}/finalize"}),listLineItems:k({method:"GET",fullPath:"/v1/invoices/{invoice}/lines",methodType:"list"}),markUncollectible:k({method:"POST",fullPath:"/v1/invoices/{invoice}/mark_uncollectible"}),pay:k({method:"POST",fullPath:"/v1/invoices/{invoice}/pay"}),removeLines:k({method:"POST",fullPath:"/v1/invoices/{invoice}/remove_lines"}),search:k({method:"GET",fullPath:"/v1/invoices/search",methodType:"search"}),sendInvoice:k({method:"POST",fullPath:"/v1/invoices/{invoice}/send"}),updateLines:k({method:"POST",fullPath:"/v1/invoices/{invoice}/update_lines"}),updateLineItem:k({method:"POST",fullPath:"/v1/invoices/{invoice}/lines/{line_item_id}"}),voidInvoice:k({method:"POST",fullPath:"/v1/invoices/{invoice}/void"})});var gl=n.method,ea=n.extend({retrieve:gl({method:"GET",fullPath:"/v1/mandates/{mandate}"})});var ta=n.method,Do="connect.stripe.com",ra=n.extend({basePath:"/",authorizeUrl(t,e){t=t||{},e=e||{};let r="oauth/authorize";return e.express&&(r=`express/${r}`),t.response_type||(t.response_type="code"),t.client_id||(t.client_id=this._stripe.getClientId()),t.scope||(t.scope="read_write"),`https://${Do}/${r}?${se(t)}`},token:ta({method:"POST",path:"oauth/token",host:Do}),deauthorize(t,...e){return t.client_id||(t.client_id=this._stripe.getClientId()),ta({method:"POST",path:"oauth/deauthorize",host:Do}).apply(this,[t,...e])}});var B=n.method,oa=n.extend({create:B({method:"POST",fullPath:"/v1/payment_intents"}),retrieve:B({method:"GET",fullPath:"/v1/payment_intents/{intent}"}),update:B({method:"POST",fullPath:"/v1/payment_intents/{intent}"}),list:B({method:"GET",fullPath:"/v1/payment_intents",methodType:"list"}),applyCustomerBalance:B({method:"POST",fullPath:"/v1/payment_intents/{intent}/apply_customer_balance"}),cancel:B({method:"POST",fullPath:"/v1/payment_intents/{intent}/cancel"}),capture:B({method:"POST",fullPath:"/v1/payment_intents/{intent}/capture"}),confirm:B({method:"POST",fullPath:"/v1/payment_intents/{intent}/confirm"}),incrementAuthorization:B({method:"POST",fullPath:"/v1/payment_intents/{intent}/increment_authorization"}),search:B({method:"GET",fullPath:"/v1/payment_intents/search",methodType:"search"}),verifyMicrodeposits:B({method:"POST",fullPath:"/v1/payment_intents/{intent}/verify_microdeposits"})});var ct=n.method,sa=n.extend({create:ct({method:"POST",fullPath:"/v1/payment_links"}),retrieve:ct({method:"GET",fullPath:"/v1/payment_links/{payment_link}"}),update:ct({method:"POST",fullPath:"/v1/payment_links/{payment_link}"}),list:ct({method:"GET",fullPath:"/v1/payment_links",methodType:"list"}),listLineItems:ct({method:"GET",fullPath:"/v1/payment_links/{payment_link}/line_items",methodType:"list"})});var xr=n.method,na=n.extend({create:xr({method:"POST",fullPath:"/v1/payment_method_configurations"}),retrieve:xr({method:"GET",fullPath:"/v1/payment_method_configurations/{configuration}"}),update:xr({method:"POST",fullPath:"/v1/payment_method_configurations/{configuration}"}),list:xr({method:"GET",fullPath:"/v1/payment_method_configurations",methodType:"list"})});var lt=n.method,ia=n.extend({create:lt({method:"POST",fullPath:"/v1/payment_method_domains"}),retrieve:lt({method:"GET",fullPath:"/v1/payment_method_domains/{payment_method_domain}"}),update:lt({method:"POST",fullPath:"/v1/payment_method_domains/{payment_method_domain}"}),list:lt({method:"GET",fullPath:"/v1/payment_method_domains",methodType:"list"}),validate:lt({method:"POST",fullPath:"/v1/payment_method_domains/{payment_method_domain}/validate"})});var Ie=n.method,aa=n.extend({create:Ie({method:"POST",fullPath:"/v1/payment_methods"}),retrieve:Ie({method:"GET",fullPath:"/v1/payment_methods/{payment_method}"}),update:Ie({method:"POST",fullPath:"/v1/payment_methods/{payment_method}"}),list:Ie({method:"GET",fullPath:"/v1/payment_methods",methodType:"list"}),attach:Ie({method:"POST",fullPath:"/v1/payment_methods/{payment_method}/attach"}),detach:Ie({method:"POST",fullPath:"/v1/payment_methods/{payment_method}/detach"})});var Me=n.method,ca=n.extend({create:Me({method:"POST",fullPath:"/v1/payouts"}),retrieve:Me({method:"GET",fullPath:"/v1/payouts/{payout}"}),update:Me({method:"POST",fullPath:"/v1/payouts/{payout}"}),list:Me({method:"GET",fullPath:"/v1/payouts",methodType:"list"}),cancel:Me({method:"POST",fullPath:"/v1/payouts/{payout}/cancel"}),reverse:Me({method:"POST",fullPath:"/v1/payouts/{payout}/reverse"})});var ut=n.method,la=n.extend({create:ut({method:"POST",fullPath:"/v1/plans"}),retrieve:ut({method:"GET",fullPath:"/v1/plans/{plan}"}),update:ut({method:"POST",fullPath:"/v1/plans/{plan}"}),list:ut({method:"GET",fullPath:"/v1/plans",methodType:"list"}),del:ut({method:"DELETE",fullPath:"/v1/plans/{plan}"})});var dt=n.method,ua=n.extend({create:dt({method:"POST",fullPath:"/v1/prices"}),retrieve:dt({method:"GET",fullPath:"/v1/prices/{price}"}),update:dt({method:"POST",fullPath:"/v1/prices/{price}"}),list:dt({method:"GET",fullPath:"/v1/prices",methodType:"list"}),search:dt({method:"GET",fullPath:"/v1/prices/search",methodType:"search"})});var Y=n.method,da=n.extend({create:Y({method:"POST",fullPath:"/v1/products"}),retrieve:Y({method:"GET",fullPath:"/v1/products/{id}"}),update:Y({method:"POST",fullPath:"/v1/products/{id}"}),list:Y({method:"GET",fullPath:"/v1/products",methodType:"list"}),del:Y({method:"DELETE",fullPath:"/v1/products/{id}"}),createFeature:Y({method:"POST",fullPath:"/v1/products/{product}/features"}),deleteFeature:Y({method:"DELETE",fullPath:"/v1/products/{product}/features/{id}"}),listFeatures:Y({method:"GET",fullPath:"/v1/products/{product}/features",methodType:"list"}),retrieveFeature:Y({method:"GET",fullPath:"/v1/products/{product}/features/{id}"}),search:Y({method:"GET",fullPath:"/v1/products/search",methodType:"search"})});var wr=n.method,ma=n.extend({create:wr({method:"POST",fullPath:"/v1/promotion_codes"}),retrieve:wr({method:"GET",fullPath:"/v1/promotion_codes/{promotion_code}"}),update:wr({method:"POST",fullPath:"/v1/promotion_codes/{promotion_code}"}),list:wr({method:"GET",fullPath:"/v1/promotion_codes",methodType:"list"})});var X=n.method,ha=n.extend({create:X({method:"POST",fullPath:"/v1/quotes"}),retrieve:X({method:"GET",fullPath:"/v1/quotes/{quote}"}),update:X({method:"POST",fullPath:"/v1/quotes/{quote}"}),list:X({method:"GET",fullPath:"/v1/quotes",methodType:"list"}),accept:X({method:"POST",fullPath:"/v1/quotes/{quote}/accept"}),cancel:X({method:"POST",fullPath:"/v1/quotes/{quote}/cancel"}),finalizeQuote:X({method:"POST",fullPath:"/v1/quotes/{quote}/finalize"}),listComputedUpfrontLineItems:X({method:"GET",fullPath:"/v1/quotes/{quote}/computed_upfront_line_items",methodType:"list"}),listLineItems:X({method:"GET",fullPath:"/v1/quotes/{quote}/line_items",methodType:"list"}),pdf:X({method:"GET",fullPath:"/v1/quotes/{quote}/pdf",host:"files.stripe.com",streaming:!0})});var mt=n.method,pa=n.extend({create:mt({method:"POST",fullPath:"/v1/refunds"}),retrieve:mt({method:"GET",fullPath:"/v1/refunds/{refund}"}),update:mt({method:"POST",fullPath:"/v1/refunds/{refund}"}),list:mt({method:"GET",fullPath:"/v1/refunds",methodType:"list"}),cancel:mt({method:"POST",fullPath:"/v1/refunds/{refund}/cancel"})});var Go=n.method,fa=n.extend({retrieve:Go({method:"GET",fullPath:"/v1/reviews/{review}"}),list:Go({method:"GET",fullPath:"/v1/reviews",methodType:"list"}),approve:Go({method:"POST",fullPath:"/v1/reviews/{review}/approve"})});var yl=n.method,va=n.extend({list:yl({method:"GET",fullPath:"/v1/setup_attempts",methodType:"list"})});var fe=n.method,ga=n.extend({create:fe({method:"POST",fullPath:"/v1/setup_intents"}),retrieve:fe({method:"GET",fullPath:"/v1/setup_intents/{intent}"}),update:fe({method:"POST",fullPath:"/v1/setup_intents/{intent}"}),list:fe({method:"GET",fullPath:"/v1/setup_intents",methodType:"list"}),cancel:fe({method:"POST",fullPath:"/v1/setup_intents/{intent}/cancel"}),confirm:fe({method:"POST",fullPath:"/v1/setup_intents/{intent}/confirm"}),verifyMicrodeposits:fe({method:"POST",fullPath:"/v1/setup_intents/{intent}/verify_microdeposits"})});var Or=n.method,ya=n.extend({create:Or({method:"POST",fullPath:"/v1/shipping_rates"}),retrieve:Or({method:"GET",fullPath:"/v1/shipping_rates/{shipping_rate_token}"}),update:Or({method:"POST",fullPath:"/v1/shipping_rates/{shipping_rate_token}"}),list:Or({method:"GET",fullPath:"/v1/shipping_rates",methodType:"list"})});var ht=n.method,Pa=n.extend({create:ht({method:"POST",fullPath:"/v1/sources"}),retrieve:ht({method:"GET",fullPath:"/v1/sources/{source}"}),update:ht({method:"POST",fullPath:"/v1/sources/{source}"}),listSourceTransactions:ht({method:"GET",fullPath:"/v1/sources/{source}/source_transactions",methodType:"list"}),verify:ht({method:"POST",fullPath:"/v1/sources/{source}/verify"})});var pt=n.method,Ta=n.extend({create:pt({method:"POST",fullPath:"/v1/subscription_items"}),retrieve:pt({method:"GET",fullPath:"/v1/subscription_items/{item}"}),update:pt({method:"POST",fullPath:"/v1/subscription_items/{item}"}),list:pt({method:"GET",fullPath:"/v1/subscription_items",methodType:"list"}),del:pt({method:"DELETE",fullPath:"/v1/subscription_items/{item}"})});var ke=n.method,_a=n.extend({create:ke({method:"POST",fullPath:"/v1/subscription_schedules"}),retrieve:ke({method:"GET",fullPath:"/v1/subscription_schedules/{schedule}"}),update:ke({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}"}),list:ke({method:"GET",fullPath:"/v1/subscription_schedules",methodType:"list"}),cancel:ke({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}/cancel"}),release:ke({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}/release"})});var Z=n.method,Sa=n.extend({create:Z({method:"POST",fullPath:"/v1/subscriptions"}),retrieve:Z({method:"GET",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),update:Z({method:"POST",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),list:Z({method:"GET",fullPath:"/v1/subscriptions",methodType:"list"}),cancel:Z({method:"DELETE",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),deleteDiscount:Z({method:"DELETE",fullPath:"/v1/subscriptions/{subscription_exposed_id}/discount"}),migrate:Z({method:"POST",fullPath:"/v1/subscriptions/{subscription}/migrate"}),resume:Z({method:"POST",fullPath:"/v1/subscriptions/{subscription}/resume"}),search:Z({method:"GET",fullPath:"/v1/subscriptions/search",methodType:"search"})});var Ea=n.method,xa=n.extend({retrieve:Ea({method:"GET",fullPath:"/v1/tax_codes/{id}"}),list:Ea({method:"GET",fullPath:"/v1/tax_codes",methodType:"list"})});var br=n.method,wa=n.extend({create:br({method:"POST",fullPath:"/v1/tax_ids"}),retrieve:br({method:"GET",fullPath:"/v1/tax_ids/{id}"}),list:br({method:"GET",fullPath:"/v1/tax_ids",methodType:"list"}),del:br({method:"DELETE",fullPath:"/v1/tax_ids/{id}"})});var Rr=n.method,Oa=n.extend({create:Rr({method:"POST",fullPath:"/v1/tax_rates"}),retrieve:Rr({method:"GET",fullPath:"/v1/tax_rates/{tax_rate}"}),update:Rr({method:"POST",fullPath:"/v1/tax_rates/{tax_rate}"}),list:Rr({method:"GET",fullPath:"/v1/tax_rates",methodType:"list"})});var ba=n.method,Ra=n.extend({create:ba({method:"POST",fullPath:"/v1/tokens"}),retrieve:ba({method:"GET",fullPath:"/v1/tokens/{token}"})});var ft=n.method,Aa=n.extend({create:ft({method:"POST",fullPath:"/v1/topups"}),retrieve:ft({method:"GET",fullPath:"/v1/topups/{topup}"}),update:ft({method:"POST",fullPath:"/v1/topups/{topup}"}),list:ft({method:"GET",fullPath:"/v1/topups",methodType:"list"}),cancel:ft({method:"POST",fullPath:"/v1/topups/{topup}/cancel"})});var ae=n.method,Ca=n.extend({create:ae({method:"POST",fullPath:"/v1/transfers"}),retrieve:ae({method:"GET",fullPath:"/v1/transfers/{transfer}"}),update:ae({method:"POST",fullPath:"/v1/transfers/{transfer}"}),list:ae({method:"GET",fullPath:"/v1/transfers",methodType:"list"}),createReversal:ae({method:"POST",fullPath:"/v1/transfers/{id}/reversals"}),listReversals:ae({method:"GET",fullPath:"/v1/transfers/{id}/reversals",methodType:"list"}),retrieveReversal:ae({method:"GET",fullPath:"/v1/transfers/{transfer}/reversals/{id}"}),updateReversal:ae({method:"POST",fullPath:"/v1/transfers/{transfer}/reversals/{id}"})});var vt=n.method,Ia=n.extend({create:vt({method:"POST",fullPath:"/v1/webhook_endpoints"}),retrieve:vt({method:"GET",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"}),update:vt({method:"POST",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"}),list:vt({method:"GET",fullPath:"/v1/webhook_endpoints",methodType:"list"}),del:vt({method:"DELETE",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"})});var Pl=b("apps",{Secrets:Zn}),Tl=b("billing",{Alerts:Vs,CreditBalanceSummary:tn,CreditBalanceTransactions:on,CreditGrants:sn,MeterEventAdjustments:Pn,MeterEvents:En,Meters:wn}),_l=b("billingPortal",{Configurations:Xs,Sessions:ei}),Sl=b("checkout",{Sessions:ti}),El=b("climate",{Orders:On,Products:Gn,Suppliers:ai}),xl=b("entitlements",{ActiveEntitlements:$s,Features:pn}),wl=b("financialConnections",{Accounts:Us,Sessions:oi,Transactions:hi}),Ol=b("forwarding",{Requests:Yn}),bl=b("identity",{VerificationReports:Si,VerificationSessions:Ei}),Rl=b("issuing",{Authorizations:Ks,Cardholders:Ws,Cards:Js,Disputes:ln,PersonalizationDesigns:In,PhysicalBundles:Nn,Tokens:li,Transactions:pi}),Al=b("radar",{EarlyFraudWarnings:dn,ValueListItems:Pi,ValueLists:Ti}),Cl=b("reporting",{ReportRuns:zn,ReportTypes:Jn}),Il=b("sigma",{ScheduledQueryRuns:Qn}),Ml=b("tax",{Calculations:zs,Registrations:Bn,Settings:ni,Transactions:fi}),kl=b("terminal",{Configurations:Qs,ConnectionTokens:en,Locations:yn,Readers:Hn}),Nl=b("testHelpers",{ConfirmationTokens:Zs,Customers:an,Refunds:Kn,TestClocks:ci,Issuing:b("issuing",{Authorizations:Bs,Cards:Ys,PersonalizationDesigns:Mn,Transactions:vi}),Terminal:b("terminal",{Readers:Ln}),Treasury:b("treasury",{InboundTransfers:vn,OutboundPayments:bn,OutboundTransfers:An,ReceivedCredits:qn,ReceivedDebits:Fn})}),Dl=b("treasury",{CreditReversals:nn,DebitReversals:cn,FinancialAccounts:fn,InboundTransfers:gn,OutboundPayments:Rn,OutboundTransfers:Cn,ReceivedCredits:Un,ReceivedDebits:Vn,TransactionEntries:di,Transactions:yi}),Gl=b("v2",{Billing:b("billing",{MeterEventAdjustments:Tn,MeterEventSession:_n,MeterEventStream:Sn,MeterEvents:xn}),Core:b("core",{EventDestinations:mn,Events:hn})});var Ma="api.stripe.com",ka="443",Na="/v1/",Da=To,Ga=8e4,Ha=5,La=.5,Hl=["name","version","url","partner_id"],qa=["authenticator","apiVersion","typescript","maxNetworkRetries","httpAgent","httpClient","timeout","host","port","protocol","telemetry","appInfo","stripeAccount","stripeContext"],Ll=t=>new sr(t,n.MAX_BUFFERED_REQUEST_METRICS);function ja(t,e=Ll){r.PACKAGE_VERSION="18.5.0",r.API_VERSION=To,r.USER_AGENT=Object.assign({bindings_version:r.PACKAGE_VERSION,lang:"node",publisher:"stripe",uname:null,typescript:!1},Is()),r.StripeResource=n,r.resources=Ne,r.HttpClient=D,r.HttpClientResponse=oe,r.CryptoProvider=re,r.webhooks=js(t);function r(o,s={}){if(!(this instanceof r))return new r(o,s);let i=this._getPropsFromConfig(s);this._platformFunctions=t,Object.defineProperty(this,"_emitter",{value:this._platformFunctions.createEmitter(),enumerable:!1,configurable:!1,writable:!1}),this.VERSION=r.PACKAGE_VERSION,this.on=this._emitter.on.bind(this._emitter),this.once=this._emitter.once.bind(this._emitter),this.off=this._emitter.removeListener.bind(this._emitter);let a=i.httpAgent||null;this._api={host:i.host||Ma,port:i.port||ka,protocol:i.protocol||"https",basePath:Na,version:i.apiVersion||Da,timeout:Bt("timeout",i.timeout,Ga),maxNetworkRetries:Bt("maxNetworkRetries",i.maxNetworkRetries,2),agent:a,httpClient:i.httpClient||(a?this._platformFunctions.createNodeHttpClient(a):this._platformFunctions.createDefaultHttpClient()),dev:!1,stripeAccount:i.stripeAccount||null,stripeContext:i.stripeContext||null};let l=i.typescript||!1;l!==r.USER_AGENT.typescript&&(r.USER_AGENT.typescript=l),i.appInfo&&this._setAppInfo(i.appInfo),this._prepResources(),this._setAuthenticator(o,i.authenticator),this.errors=rr,this.webhooks=r.webhooks,this._prevRequestMetrics=[],this._enableTelemetry=i.telemetry!==!1,this._requestSender=e(this),this.StripeResource=r.StripeResource}return r.errors=rr,r.createNodeHttpClient=t.createNodeHttpClient,r.createFetchHttpClient=t.createFetchHttpClient,r.createNodeCryptoProvider=t.createNodeCryptoProvider,r.createSubtleCryptoProvider=t.createSubtleCryptoProvider,r.prototype={_appInfo:void 0,on:null,off:null,once:null,VERSION:null,StripeResource:null,webhooks:null,errors:null,_api:null,_prevRequestMetrics:null,_emitter:null,_enableTelemetry:null,_requestSender:null,_platformFunctions:null,rawRequest(o,s,i,a){return this._requestSender._rawRequest(o,s,i,a)},_setAuthenticator(o,s){if(o&&s)throw new Error("Can't specify both apiKey and authenticator");if(!o&&!s)throw new Error("Neither apiKey nor config.authenticator provided");this._authenticator=o?Ft(o):s},_setAppInfo(o){if(o&&typeof o!="object")throw new Error("AppInfo must be an object.");if(o&&!o.name)throw new Error("AppInfo.name is required");o=o||{},this._appInfo=Hl.reduce((s,i)=>(typeof o[i]=="string"&&(s=s||{},s[i]=o[i]),s),{})},_setApiField(o,s){this._api[o]=s},getApiField(o){return this._api[o]},setClientId(o){this._clientId=o},getClientId(){return this._clientId},getConstant:o=>{switch(o){case"DEFAULT_HOST":return Ma;case"DEFAULT_PORT":return ka;case"DEFAULT_BASE_PATH":return Na;case"DEFAULT_API_VERSION":return Da;case"DEFAULT_TIMEOUT":return Ga;case"MAX_NETWORK_RETRY_DELAY_SEC":return Ha;case"INITIAL_NETWORK_RETRY_DELAY_SEC":return La}return r[o]},getMaxNetworkRetries(){return this.getApiField("maxNetworkRetries")},_setApiNumberField(o,s,i){let a=Bt(o,s,i);this._setApiField(o,a)},getMaxNetworkRetryDelay(){return Ha},getInitialNetworkRetryDelay(){return La},getClientUserAgent(o){return this.getClientUserAgentSeeded(r.USER_AGENT,o)},getClientUserAgentSeeded(o,s){this._platformFunctions.getUname().then(i=>{var a;let l={};for(let u in o)Object.prototype.hasOwnProperty.call(o,u)&&(l[u]=encodeURIComponent((a=o[u])!==null&&a!==void 0?a:"null"));l.uname=encodeURIComponent(i||"UNKNOWN");let c=this.getApiField("httpClient");c&&(l.httplib=encodeURIComponent(c.getClientName())),this._appInfo&&(l.application=this._appInfo),s(JSON.stringify(l))})},getAppInfoAsString(){if(!this._appInfo)return"";let o=this._appInfo.name;return this._appInfo.version&&(o+=`/${this._appInfo.version}`),this._appInfo.url&&(o+=` (${this._appInfo.url})`),o},getTelemetryEnabled(){return this._enableTelemetry},_prepResources(){for(let o in Ne)Object.prototype.hasOwnProperty.call(Ne,o)&&(this[As(o)]=new Ne[o](this))},_getPropsFromConfig(o){if(!o)return{};let s=typeof o=="string";if(!(o===Object(o)&&!Array.isArray(o))&&!s)throw new Error("Config must either be an object or a string");if(s)return{apiVersion:o};if(Object.keys(o).filter(l=>!qa.includes(l)).length>0)throw new Error(`Config object may only contain the following: ${qa.join(", ")}`);return o},parseThinEvent(o,s,i,a,l,c){return this.webhooks.constructEvent(o,s,i,a,l,c)}},r}var ql=ja(new or),Ua=ql;var j=class{constructor(e,r){this.stripe=new Ua(e),this.siteUrl=r}async createProduct(e){let r=Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:[],o={name:e.name,images:r.slice(0,8),type:"good",tax_code:"txcd_99999999"};return e.description&&String(e.description).trim()!==""&&(o.description=String(e.description)),await this.stripe.products.create(o)}async updateProduct(e,r){let o={name:r.name,images:r.images?.slice(0,8)||[]};if(typeof r.description=="string"){let s=r.description.trim();s&&(o.description=s)}return await this.stripe.products.update(e,o)}async archiveProduct(e){return await this.stripe.products.update(e,{active:!1})}async createPrice(e){return await this.stripe.prices.create({unit_amount:Math.round(e.amount*100),currency:e.currency,product:e.productId,nickname:e.nickname,metadata:e.metadata||{}})}async archivePrice(e){return await this.stripe.prices.update(e,{active:!1})}async createCheckoutSession(e){return await this.stripe.checkout.sessions.create({payment_method_types:["card"],line_items:[{price:e,quantity:1}],mode:"payment",shipping_address_collection:{allowed_countries:Rt},billing_address_collection:"required",success_url:`${this.siteUrl}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${this.siteUrl}/`})}async createCartCheckoutSession(e){let r=e.map(s=>({price:s.stripePriceId,quantity:s.quantity||1})),o={order_type:"cart_checkout",item_count:e.length.toString(),total_quantity:e.reduce((s,i)=>s+i.quantity,0).toString()};return e.forEach((s,i)=>{let a=s.name||`Item ${i+1}`;o[`item_${i}_name`]=a,s.selectedVariant?.name&&(o[`item_${i}_variant1`]=s.selectedVariant.name),s.selectedVariant2?.name&&(o[`item_${i}_variant2`]=s.selectedVariant2.name)}),await this.stripe.checkout.sessions.create({payment_method_types:["card"],line_items:r,mode:"payment",shipping_address_collection:{allowed_countries:Rt},billing_address_collection:"required",success_url:`${this.siteUrl}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${this.siteUrl}/`,metadata:o})}async getCheckoutSession(e){let r=await this.stripe.checkout.sessions.retrieve(e);return{id:r.id,amount_total:r.amount_total,currency:r.currency,customer_email:r.customer_details?.email,payment_status:r.payment_status,created:r.created}}async listCheckoutSessions(e={}){let r={limit:Math.min(e.limit||25,50)};return e.cursor&&(e.direction==="prev"?r.ending_before=e.cursor:r.starting_after=e.cursor),await this.stripe.checkout.sessions.list(r)}async getCheckoutSessionLineItems(e){return await this.stripe.checkout.sessions.listLineItems(e,{limit:100,expand:["data.price"]})}async getPaymentIntent(e){return await this.stripe.paymentIntents.retrieve(e,{expand:["shipping"]})}async listPaymentIntents(e){return await this.stripe.paymentIntents.list({created:{gte:Math.floor(e.getTime()/1e3)},limit:100})}};var Ar=new E;Ar.post("/create-checkout-session",T(async t=>{let{priceId:e}=await t.req.json();if(!e||typeof e!="string")throw new x("Valid price ID is required");let r=e.trim();if(r.length===0)throw new x("Valid price ID is required");if(!r.startsWith("price_"))throw new x("Invalid price ID format");if(r.length>255)throw new x("Price ID is too long");let s=await new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL).createCheckoutSession(r);return t.json({sessionId:s.id})}));Ar.post("/create-cart-checkout-session",T(async t=>{let{items:e}=await t.req.json();if(!e||!Array.isArray(e)||e.length===0)throw new x("Cart items are required");if(e.length>100)throw new x("Cart size exceeds maximum allowed items");let r=e.map((i,a)=>{if(!i||typeof i!="object")throw new x(`Invalid cart item format at index ${a}`);let l=i.stripePriceId||i.priceId;if(!l||typeof l!="string"||!l.startsWith("price_"))throw new x(`Invalid price ID in cart item at index ${a}`);let c=i.quantity;if(c==null&&(c=1),c=Number.parseInt(c,10),!Number.isInteger(c)||c<1||c>100)throw new x(`Invalid quantity in cart item at index ${a} (must be 1-100, got ${c})`);return{...i,stripePriceId:l.trim(),quantity:c}}),s=await new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL).createCartCheckoutSession(r);return t.json({sessionId:s.id})}));Ar.get("/checkout-session/:sessionId",T(async t=>{let e=t.req.param("sessionId");if(!e||typeof e!="string")throw new x("Invalid session ID format");let r=e.trim();if(!r.startsWith("cs_"))throw new x("Invalid session ID format");if(r.length>255)throw new x("Session ID is too long");let s=await new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL).getCheckoutSession(r);return t.json(s)}));var Fa=Ar;var $a=new E;$a.get("/",T(async t=>{let e=t.req.query("src");if(!e)throw new x("Missing src");let r;try{let a=new URL(e);if(!zr.some(c=>a.hostname===c||a.hostname.endsWith("."+c)))throw new x("Host not allowed");if(a.hostname.endsWith("drive.google.com")){let c=a.pathname.match(/\/file\/d\/([a-zA-Z0-9_-]+)/),u=a.searchParams.get("id"),d=c&&c[1]||u;if(!d)throw new x("Missing Google Drive file id");r=`https://drive.usercontent.google.com/download?id=${d}&export=view`}else if(a.hostname.endsWith("drive.usercontent.google.com")){let c=a.searchParams.get("id");if(!c)throw new x("Missing Google Drive file id");let u=new URL("https://drive.usercontent.google.com/download");u.searchParams.set("id",c),u.searchParams.set("export","view"),r=u.toString()}else r=a.toString()}catch(a){throw a instanceof x?a:new x("Invalid src url")}let o=await fetch(r,{redirect:"follow",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123 Safari/537.36",Accept:"image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9",Referer:"https://drive.google.com/"},cf:{cacheEverything:!0}});if(!o.ok)throw new Error(`Upstream error: ${o.status}`);let s=new Headers,i=o.headers.get("content-type")||"image/jpeg";return s.set("Content-Type",i),s.set("Cache-Control","public, max-age=86400"),s.set("Access-Control-Allow-Origin","*"),s.set("Cross-Origin-Resource-Policy","cross-origin"),new Response(o.body,{headers:s})}));var Va=$a;var Ka=new E;Ka.get("/",T(async t=>{let e=_(t.env),o=await new W(e).getSettings();return t.json(o)}));var Ba=Ka,Ho=new E;Ho.get("/",T(async t=>{let e=_(t.env),o=await new W(e).getContactEmail();return t.json(o)}));var De=class{constructor(e){this.env=e,this.bucket=e.IMAGES}async uploadFile(e,r,o){if(!this.bucket)throw new Error("R2 bucket not configured");let s=atob(r),i=new Uint8Array(s.length);for(let u=0;u<s.length;u++)i[u]=s.charCodeAt(u);let a=o.replace(/[^a-zA-Z0-9.-]/g,"_"),l=`${Date.now()}-${Dt()}-${a}`;await this.bucket.put(l,i.buffer,{httpMetadata:{contentType:e}});let c=`/api/images/${l}`;return{id:l,viewUrl:c,downloadUrl:c,webViewLink:c,folder:{id:"r2",name:"R2 Bucket"}}}async getFile(e){if(!this.bucket)throw new Error("R2 bucket not configured");return await this.bucket.get(e)}};var za=new E;za.get("/:key",async t=>{let e=t.req.param("key"),r=new De(t.env);try{let o=await r.getFile(e);if(!o)return t.notFound();let s=new Headers;return o.writeHttpMetadata(s),s.set("etag",o.httpEtag),s.set("Cache-Control","public, max-age=31536000, immutable"),new Response(o.body,{headers:s})}catch(o){return console.error("Error fetching image:",o),t.notFound()}});var Wa=za;var Ja=new E;Ja.post("/login",T(async t=>{let{password:e}=await t.req.json();if(!e||typeof e!="string")throw new x("Password is required");let r=_(t.env),s=`rate_limit:login:${t.req.header("CF-Connecting-IP")||t.req.header("X-Forwarded-For")||"unknown"}`,i=await r.get(s),a=i?parseInt(i,10):0;if(a>=5)throw new Mt("Too many login attempts. Please try again later.");let l=`${Q.ADMIN_TOKEN_PREFIX}password_hash`,c=await r.get(l),u=t.env.ADMIN_PASSWORD||"admin123";if(c||(c=await ls(u),await r.put(l,c)),!await cs(e,c))throw await r.put(s,(a+1).toString(),{expirationTtl:900}),new It("Invalid password");await r.delete(s);let m=Dt(),h=await Gt(m);return await r.put(`${Q.ADMIN_TOKEN_PREFIX}${h}`,Date.now().toString(),{expirationTtl:Wr}),t.json({token:m})}));var Ya=Ja;var gt=class{constructor(e){this.stripe=e}async createProductWithPrices(e){let r=await this.stripe.createProduct({name:e.name,description:e.description,images:Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:[]}),o=Array.isArray(e.variants)?e.variants:[],s=Array.isArray(e.variants2)?e.variants2:[],i=null,a={};if(o.length===0&&s.length===0)i=await this.stripe.createPrice({amount:e.price,currency:e.currency,productId:r.id,nickname:`${e.name} - Base`,metadata:{price_type:"base",product_name:e.name}});else{let l=[];if(o.length>0&&s.length>0)for(let c of o)for(let u of s){let d=`${e.name} - ${c.name} - ${u.name}`,m=c.hasCustomPrice&&c.price?c.price:u.hasCustomPrice&&u.price?u.price:e.price;l.push({name:d,price:m,variant1:c,variant2:u,description:d,variantCombo:`${c.id||c.name}-${u.id||u.name}`})}else if(o.length>0)for(let c of o){let u=`${e.name} - ${c.name}`,d=c.hasCustomPrice&&c.price?c.price:e.price;l.push({name:u,price:d,variant1:c,description:u,variantCombo:`${c.id||c.name}`})}else if(s.length>0)for(let c of s){let u=`${e.name} - ${c.name}`,d=c.hasCustomPrice&&c.price?c.price:e.price;l.push({name:u,price:d,variant2:c,description:u,variantCombo:`${c.id||c.name}`})}for(let c of l){let u=await this.stripe.createPrice({amount:c.price,currency:e.currency,productId:r.id,nickname:c.name,metadata:{price_type:"variant_combo",product_name:e.name,variant1_name:c.variant1?.name||"",variant2_name:c.variant2?.name||"",variant1_id:c.variant1?.id||"",variant2_id:c.variant2?.id||"",variant1_style:e.variantStyle||"Variant",variant2_style:e.variantStyle2||"Variant",variant_combo:c.variantCombo}});c.variant1&&c.variant2?a[`${c.variant1.id}-${c.variant2.id}`]=u.id:c.variant1?a[c.variant1.id]=u.id:c.variant2&&(a[c.variant2.id]=u.id)}i=await this.stripe.createPrice({amount:e.price,currency:e.currency,productId:r.id,nickname:`${e.name} - Base`,metadata:{price_type:"base",product_name:e.name}})}return{stripeProduct:r,basePrice:i,variantPrices:a}}async updateProductVariants(e,r,o){let s=r.stripePriceId||e.stripePriceId,i=[],a=[];if(Array.isArray(r.variants)){let l=r.variants,c=Array.isArray(e.variants)?e.variants:[];for(let u of l){let d=u.id?c.find(h=>h.id===u.id):void 0;if(!!u.hasCustomPrice&&typeof u.price=="number"&&u.price>0){let h=Math.round(u.price*100),p=d?.stripePriceId,f=!!d?.hasCustomPrice&&typeof d?.price=="number",v=f?Math.round(d.price*100):null;if(!p||!f||v!==h){let g=await o.createPrice({amount:u.price,currency:r.currency||e.currency,productId:e.stripeProductId,nickname:`${r.name||e.name} - ${u.name}`,metadata:{price_type:"variant_primary",variant_id:u.id||"",variant_name:u.name||""}});if(d?.stripePriceId&&f)try{await o.archivePrice(d.stripePriceId)}catch{}p=g.id}i.push({...u,stripePriceId:p,hasCustomPrice:!0})}else{if(d?.stripePriceId&&d?.hasCustomPrice)try{await o.archivePrice(d.stripePriceId)}catch{}i.push({...u,stripePriceId:s,hasCustomPrice:!1,price:void 0})}}}if(Array.isArray(r.variants2)){let l=r.variants2,c=Array.isArray(e.variants2)?e.variants2:[];for(let u of l){let d=u.id?c.find(h=>h.id===u.id):void 0;if(!!u.hasCustomPrice&&typeof u.price=="number"&&u.price>0){let h=Math.round(u.price*100),p=d?.stripePriceId,f=!!d?.hasCustomPrice&&typeof d?.price=="number",v=f?Math.round(d.price*100):null;if(!p||!f||v!==h){let g=await o.createPrice({amount:u.price,currency:r.currency||e.currency,productId:e.stripeProductId,nickname:`${r.name||e.name}${r.variantStyle2||e.variantStyle2?` - ${r.variantStyle2||e.variantStyle2}: ${u.name}`:` - ${u.name}`}`,metadata:{price_type:"variant_secondary",variant_id:u.id||"",variant_name:u.name||"",variant2_name:u.name||""}});if(d?.stripePriceId&&f)try{await o.archivePrice(d.stripePriceId)}catch{}p=g.id}a.push({...u,stripePriceId:p,hasCustomPrice:!0})}else{if(d?.stripePriceId&&d?.hasCustomPrice)try{await o.archivePrice(d.stripePriceId)}catch{}a.push({...u,stripePriceId:s,hasCustomPrice:!1,price:void 0})}}}return{variants:i.length>0?i:e.variants,variants2:a.length>0?a:e.variants2}}};var Ge=new E;Ge.get("/",T(async t=>{let e=_(t.env),o=await new L(e).getAllProductsAdmin();return t.json(o)}));Ge.post("/",T(async t=>{let e=await t.req.json(),r=_(t.env),o=new L(r),s=new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL),i=new gt(s),{stripeProduct:a,basePrice:l,variantPrices:c}=await i.createProductWithPrices(e),u={...e,stripePriceId:l?.id||Object.values(c)[0]||"",stripeProductId:a.id,variantPrices:c,variants:Array.isArray(e.variants)?e.variants:[],variants2:Array.isArray(e.variants2)?e.variants2:[]},d=await o.createProduct(u);return t.json(d,201)}));Ge.get("/:id",T(async t=>{let e=_(t.env),o=await new L(e).getProduct(t.req.param("id"));return t.json(o)}));Ge.put("/:id",T(async t=>{let e=await t.req.json(),r=_(t.env),o=new L(r),s=new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL),i=new gt(s),a=await o.getProduct(t.req.param("id"));if(e.name||e.description!==void 0||e.images||e.imageUrl){let c=Array.isArray(e.images)?e.images:e.imageUrl?[e.imageUrl]:Array.isArray(a.images)?a.images:a.imageUrl?[a.imageUrl]:[];await s.updateProduct(a.stripeProductId,{name:e.name||a.name,description:e.description,images:c.slice(0,8)})}if(typeof e.price<"u"&&e.price!==a.price){let c=typeof e.price=="number"?e.price:parseFloat(String(e.price)),u=await s.createPrice({amount:c,currency:e.currency||a.currency,productId:a.stripeProductId,nickname:`${e.name||a.name} - Base`,metadata:{}});a.stripePriceId&&await s.archivePrice(a.stripePriceId),e.stripePriceId=u.id,e.price=c}if(Array.isArray(e.variants)||Array.isArray(e.variants2)){let c=await i.updateProductVariants(a,e,s);e.variants=c.variants,e.variants2=c.variants2}let l=await o.updateProduct(t.req.param("id"),e);return t.json(l)}));Ge.delete("/:id",T(async t=>{let e=_(t.env),r=new L(e),o=new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL),s=await r.getProduct(t.req.param("id"));return s.stripePriceId&&await o.archivePrice(s.stripePriceId),s.stripeProductId&&await o.archiveProduct(s.stripeProductId),await r.deleteProduct(t.req.param("id")),t.json({success:!0})}));var Xa=Ge;var He=new E;He.get("/",T(async t=>{let e=_(t.env),o=await new F(e).getAllCollectionsAdmin();return t.json(o)}));He.post("/",T(async t=>{let e=await t.req.json(),r=_(t.env),s=await new F(r).createCollection(e);return t.json(s,201)}));He.get("/:id",T(async t=>{let e=_(t.env),o=await new F(e).getCollection(t.req.param("id"));return t.json(o)}));He.put("/:id",T(async t=>{let e=await t.req.json(),r=_(t.env),s=await new F(r).updateCollection(t.req.param("id"),e);return t.json(s)}));He.delete("/:id",T(async t=>{let e=_(t.env);return await new F(e).deleteCollection(t.req.param("id")),t.json({success:!0})}));var Qa=He;var yt=class{constructor(e){this.stripe=e}async getAnalytics(e="30d"){let o={"1d":1,"7d":7,"30d":30,"90d":90,"1y":365}[e]||30,s=new Date,i=new Date(s.getTime()-o*24*60*60*1e3),l=(await this.stripe.listPaymentIntents(i)).data.filter(h=>h.status==="succeeded"),c=l.reduce((h,p)=>h+p.amount,0)/100,u=l.length,d=u>0?c/u:0,m=[];if(e==="1d"){let h={},p={};l.forEach(y=>{let O=new Date(y.created*1e3),P=new Date(O);P.setMinutes(0,0,0);let S=P.toISOString();h[S]=(h[S]||0)+1,p[S]=(p[S]||0)+y.amount/100});let f=new Date(s);f.setMinutes(0,0,0);let v=new Date(f.getTime()-23*60*60*1e3),g=new Date(v);for(;g<=f;){let y=new Date(g).toISOString();m.push({date:y,orders:h[y]||0,revenue:Math.round(((p[y]||0)+Number.EPSILON)*100)/100,formattedDate:new Date(g).toLocaleTimeString("en-US",{hour:"numeric"})}),g.setHours(g.getHours()+1)}}else{let h={},p={};l.forEach(v=>{let g=new Date(v.created*1e3).toISOString().split("T")[0];h[g]=(h[g]||0)+1,p[g]=(p[g]||0)+v.amount/100});let f=new Date(i);for(;f<=s;){let v=f.toISOString().split("T")[0];m.push({date:v,orders:h[v]||0,revenue:p[v]||0,formattedDate:f.toLocaleDateString("en-US",{month:"short",day:"numeric"})}),f.setDate(f.getDate()+1)}}return{period:e,totalRevenue:Math.round(c*100)/100,totalOrders:u,averageOrderValue:Math.round(d*100)/100,chartData:m,recentOrders:[],dateRange:{start:i.toISOString(),end:s.toISOString()}}}async getOrders(e={}){let r=Math.min(e.limit||25,50),o=e.direction||"next",s=e.cursor,i=e.showFulfilled===!0,a={limit:r};s&&(o==="prev"?a.ending_before=s:a.starting_after=s);let l=await this.stripe.listCheckoutSessions(a),c=[];for(let p of l.data)if(p.payment_status==="paid"||p.status==="complete"||p.status==="completed"){let f=!0;if(e.kvNamespace){let v=`order_fulfillment:${p.id}`,g=await e.kvNamespace.get(v),y=g?JSON.parse(g):{fulfilled:!1};i?y.fulfilled||(f=!1):y.fulfilled&&(f=!1)}f&&c.push(p)}let u=c.reverse(),d=[];for(let p of u)try{let f=await this.stripe.getCheckoutSessionLineItems(p.id),v=null;if(p.shipping_details)v=p.shipping_details;else if(p.payment_intent)try{let P=await this.stripe.getPaymentIntent(p.payment_intent);P.shipping&&(v={address:P.shipping.address,name:P.shipping.name})}catch(P){console.log("Error fetching payment intent shipping:",P.message)}let g=`order_fulfillment:${p.id}`,y=e.kvNamespace?await e.kvNamespace.get(g):null,O=y?JSON.parse(y):{fulfilled:!1,fulfilledAt:null,fulfilledBy:null};d.push({id:p.id,created:p.created,amount_total:p.amount_total,currency:p.currency,customer_email:p.customer_details?.email||p.customer_email||null,customer_name:p.customer_details?.name||null,shipping:v,payment_intent:p.payment_intent||null,billing:{name:p.customer_details?.name||null,email:p.customer_details?.email||null,address:p.customer_details?.address||null},fulfillment:O,items:f.data.map(P=>{let S=P.price?.nickname||"",N="Unknown Product",$="",R="";if(S.includes(" - ")){let G=S.split(" - ");N=G[0],G.length>=2&&($=G[1]),G.length>=3&&(R=G[2])}else N=S;return{id:P.id,description:N,quantity:P.quantity,amount_total:P.amount_total,currency:P.currency,price_nickname:S,variant1_name:$||P.price?.metadata?.variant1_name||null,variant1_style:P.price?.metadata?.variant1_style||"Variant",variant2_name:R||P.price?.metadata?.variant2_name||null,variant2_style:P.price?.metadata?.variant2_style||"Variant"}})})}catch(f){console.error("Error fetching line items for session",p.id,f);let v={fulfilled:!1,fulfilledAt:null,fulfilledBy:null};if(e.kvNamespace){let g=`order_fulfillment:${p.id}`,y=await e.kvNamespace.get(g);v=y?JSON.parse(y):{fulfilled:!1,fulfilledAt:null,fulfilledBy:null}}d.push({id:p.id,created:p.created,amount_total:p.amount_total,currency:p.currency,customer_email:p.customer_details?.email||p.customer_email||null,customer_name:p.customer_details?.name||null,shipping:p.shipping_details||null,billing:{name:p.customer_details?.name||null,email:p.customer_details?.email||null,address:p.customer_details?.address||null},fulfillment:v,items:[]})}let m=u.length>0?u[0].id:null,h=u.length>0?u[u.length-1].id:null;return{limit:r,orders:d,cursors:{next:m,prev:h},has_more:l.has_more}}};var Cr=new E;Cr.get("/",T(async t=>{let e=t.req.query("period")||"30d",r=new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL),s=await new yt(r).getAnalytics(e);return t.json(s)}));Cr.get("/orders",T(async t=>{let e=Math.min(parseInt(t.req.query("limit")||"25",10),50),r=t.req.query("direction")||"next",o=t.req.query("cursor")||void 0,s=t.req.query("showFulfilled")==="true",i=new j(t.env.STRIPE_SECRET_KEY,t.env.SITE_URL),a=new yt(i),l=_(t.env),c=await a.getOrders({limit:e,direction:r,cursor:o,showFulfilled:s,kvNamespace:l});return t.json(c)}));Cr.post("/orders/:orderId/fulfill",T(async t=>{let e=t.req.param("orderId"),r=_(t.env);if(!r)throw new Error("KV namespace not available");let o=`order_fulfillment:${e}`,s={fulfilled:!0,fulfilledAt:new Date().toISOString(),fulfilledBy:"admin"};return await r.put(o,JSON.stringify(s)),t.json({success:!0,fulfillment:s})}));var Za=Cr;var Le=class{constructor(e){this.kv=new z(e)}generateServerId(){let e=Nt(4);return`${Date.now().toString(36)}-${e}`}async getAllMediaItems(){return[...await this.kv.getAllMediaItems()].sort((r,o)=>(o.createdAt||0)-(r.createdAt||0))}async createMediaItem(e){let r={id:e.id||this.generateServerId(),url:String(e.url||""),source:e.source||"link",filename:e.filename||"",mimeType:e.mimeType||"",driveFileId:e.driveFileId||"",createdAt:typeof e.createdAt=="number"?e.createdAt:Date.now()};return await this.kv.createMediaItem(r)}async deleteMediaItem(e){await this.kv.deleteMediaItem(e)}};var Ir=new E;Ir.get("/",T(async t=>{let e=_(t.env),o=await new Le(e).getAllMediaItems();return t.json(o)}));Ir.post("/",T(async t=>{let e=await t.req.json(),r=e?.url;if(!r||typeof r!="string"||r.trim()==="")throw new x("url is required");let o=_(t.env),i=await new Le(o).createMediaItem(e);return t.json(i,201)}));Ir.delete("/:id",T(async t=>{let e=t.req.param("id");if(!e)throw new x("Missing id");let r=_(t.env);return await new Le(r).deleteMediaItem(e),t.json({success:!0})}));var ec=Ir;var tc=new E;tc.post("/upload",T(async t=>{let{mimeType:e,dataBase64:r,filename:o}=await t.req.json();if(!e||!r)throw new x("Missing mimeType or dataBase64");let i=await new De(t.env).uploadFile(e,r,o||"image");return t.json(i)}));var rc=tc;function oc(t){return typeof t!="string"?!1:/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(t.trim())}function sc(t,e,r){let o=Number(t);return Number.isFinite(o)&&o>=e&&o<=r}function Lo(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}var jl=new Set(oo.map(t=>t.id));function nc(t){if(!Lo(t))return{valid:!1,message:"Invalid theme payload"};let e=t.colors;if(!Lo(e))return{valid:!1,message:"Missing colors object"};for(let o of Yr){let s=typeof e[o]=="string"?e[o].trim():"";if(!oc(s))return{valid:!1,message:`Invalid ${o} color`}}let r=t.typography?.fontId??t.typography?.font??t.fontId??t.font;if(r&&!jl.has(r))return{valid:!1,message:"Invalid font selection"};if(t.corners){if(t.corners.radiusMultiplier!==void 0&&!sc(t.corners.radiusMultiplier,At,Ct))return{valid:!1,message:`Radius multiplier must be between ${At} and ${Ct}`};if(t.corners.enabled!==void 0&&typeof t.corners.enabled!="boolean")return{valid:!1,message:"Corners enabled must be a boolean"}}return{valid:!0}}var qe=new E;qe.get("/storefront/theme",T(async t=>{let r=await new te(t.env).getTheme();return t.json(r)}));qe.put("/storefront/theme",T(async t=>{let e=await t.req.json(),r=nc(e);if(!r.valid)throw new x(r.message);let s=await new te(t.env).updateTheme(e);return t.json(s)}));qe.delete("/storefront/theme",T(async t=>{let r=await new te(t.env).resetTheme();return t.json(r)}));qe.get("/store-settings",T(async t=>{let e=_(t.env),o=await new W(e).getSettings();return(o.productLimit===null||o.productLimit===void 0||o.productLimit==="")&&t.env.PRODUCT_LIMIT&&(o.productLimit=t.env.PRODUCT_LIMIT),t.json(o)}));qe.put("/store-settings",T(async t=>{let e=await t.req.json(),r=_(t.env),s=await new W(r).updateSettings(e);return t.json(s)}));var ic=qe;var ac=new E;ac.post("/generate-image",T(async t=>{let{prompt:e,inputs:r}=await t.req.json();if(!e||typeof e!="string")throw new x("Missing prompt");let o=t.env.GEMINI_API_KEY;if(!o)throw new Error("GEMINI_API_KEY not configured");let s=[];if(s.push({text:e}),Array.isArray(r))for(let m of r.slice(0,4))m&&m.dataBase64&&m.mimeType&&s.push({inline_data:{mime_type:m.mimeType,data:m.dataBase64}});let a=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent",{method:"POST",headers:{"x-goog-api-key":o,"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:s}]})});if(!a.ok){let m=await a.text();throw console.error("Gemini API error",a.status,m),new Error(`Gemini API failed: ${m}`)}let c=(await a.json())?.candidates||[],u=null,d="image/png";for(let m of c){let h=m?.content?.parts||[];for(let p of h){let f=p?.inlineData||p?.inline_data;if(f&&f.data){u=f.data,d=f.mimeType||f.mime_type||d;break}}if(u)break}if(!u)throw new Error("No image returned from Gemini");return t.json({mimeType:d,dataBase64:u})}));var cc=ac;function lc(t){t.get("/api/health",e=>e.json({status:"healthy",timestamp:new Date().toISOString()})),t.route("/api/products",ms),t.route("/api/collections",hs),t.route("/api/storefront",Ts),t.route("/api",Fa),t.route("/api/image-proxy",Va),t.route("/api/store-settings",Ba),t.route("/api/contact-email",Ho),t.route("/api/images",Wa),t.route("/api/admin",Ya),t.route("/api/admin/products",Xa),t.route("/api/admin/collections",Qa),t.route("/api/admin/analytics",Za),t.route("/api/admin/media",ec),t.route("/api/admin/storage",rc),t.route("/api/admin",ic),t.route("/api/admin/ai",cc)}var ce=new E;ce.use("*",async(t,e)=>{await e(),t.header("X-Content-Type-Options","nosniff"),t.header("X-Frame-Options","DENY"),t.header("X-XSS-Protection","1; mode=block"),t.header("Referrer-Policy","strict-origin-when-cross-origin"),t.header("Permissions-Policy","geolocation=(), microphone=(), camera=()");let r=["default-src 'self'","script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com","style-src 'self' 'unsafe-inline'","img-src 'self' data: https: blob:","font-src 'self' data:","connect-src 'self' https://api.stripe.com https://*.stripe.com https://oauth2.googleapis.com https://www.googleapis.com","frame-src https://js.stripe.com https://hooks.stripe.com","frame-ancestors 'none'","base-uri 'self'","form-action 'self'","upgrade-insecure-requests"].join("; ");t.header("Content-Security-Policy",r),new URL(t.req.url).protocol==="https:"&&t.header("Strict-Transport-Security","max-age=31536000; includeSubDomains; preload")});ce.use("*",async(t,e)=>await is(t.env)(t,e));ce.use("/api/admin/*",async(t,e)=>{if(new Set(["/api/admin/login","/api/admin/drive/oauth/start","/api/admin/drive/oauth/callback"]).has(t.req.path))return e();try{let o=await us(t.req,t.env);return o.isValid?e():(console.error("Auth failed:",o.error),t.json({error:o.error,status:o.status},o.status))}catch(o){return console.error("Auth middleware error:",o),t.json({error:"Authentication middleware failed",status:500},500)}});ce.use("/api/admin/*",ds);lc(ce);ce.onError(Xr);ce.get("*",async t=>{let r=new URL(t.req.url).pathname;if(r.startsWith("/api/"))return t.notFound();try{if(r!=="/"&&!r.startsWith("/admin")&&!r.startsWith("/collections")&&!r.startsWith("/products")&&!r.startsWith("/success")){let a=await t.env.ASSETS.fetch(t.req);if(a.ok)return a}let o=new URL(t.req.url);o.pathname="/index.html";let s=new Request(o,t.req),i=await t.env.ASSETS.fetch(s);if(i.ok)return i;throw new Error("index.html not found")}catch(o){return console.error("Error serving static asset:",o,"for path:",r),t.html(`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>OpenShop - Loading Error</title>
          <style>
            body { 
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              text-align: center; 
              padding: 50px 20px; 
              background: linear-gradient(135deg, #9333ea 0%, #2563eb 100%);
              color: white;
              margin: 0;
              min-height: 100vh;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
            }
            .container { max-width: 500px; }
            h1 { font-size: 3rem; margin-bottom: 1rem; }
            .error { font-size: 1.2rem; margin: 20px 0; opacity: 0.9; }
            .help { font-size: 1rem; margin-top: 30px; opacity: 0.8; }
            a { color: white; text-decoration: underline; }
          </style>
        </head>
        <body>
          <div class="container">
            <h1>OpenShop</h1>
            <div class="error">Application loading error</div>
            <p>The application assets could not be loaded.</p>
            <div class="help">
              <p>Try:</p>
              <ul style="text-align: left; display: inline-block;">
                <li>Refreshing the page</li>
                <li>Checking your internet connection</li>
                <li>Contacting support if the issue persists</li>
              </ul>
            </div>
          </div>
        </body>
      </html>
    `,500)}});var fS=ce;export{fS as default};
